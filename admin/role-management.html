<!DOCTYPE html>
<html>
<head>
    <title>TEMPORARY Role Management - ROFLFaucet</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; margin-bottom: 20px; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, button { padding: 10px; border: 1px solid #ddd; border-radius: 4px; width: 100%; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; cursor: pointer; margin-top: 10px; }
        button:hover { background: #0056b3; }
        .result { margin: 20px 0; padding: 15px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>TEMPORARY Role Management</h1>

        <div class="warning">
            <strong>Important:</strong> This page is TEMPORARY and currently hosted on ROFLFaucet. 
            The goal is to move it to the auth server when a proper admin interface and locked-down access layer are ready.
            All changes still propagate via Syncthing (profiles live in auth server storage).
            Only use this interface if you understand the risks, and keep its URL private.
        </div>

        <form id="roleForm">
            <div class="form-group">
                <label for="userId">User ID (format: id-username)</label>
                <input type="text" id="userId" placeholder="e.g., 2-andytest2" required>
            </div>

            <div class="form-group">
                <label for="role">Role</label>
                <select id="role">
                    <option value="member">Member</option>
                    <option value="admin">Admin</option>
                    <option value="moderator">Moderator</option>
                    <option value="recipient">Recipient</option>
                </select>
            </div>

            <div class="form-group">
                <label for="action">Action</label>
                <select id="action">
                    <option value="add">Add Role</option>
                    <option value="remove">Remove Role</option>
                </select>
            </div>

            <button type="submit">Update Role</button>
        </form>

        <div id="result"></div>
    </div>

    <script>
        document.getElementById('roleForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const userId = document.getElementById('userId').value.trim();
            const role = document.getElementById('role').value;
            const action = document.getElementById('action').value;
            const resultDiv = document.getElementById('result');

            if (!userId) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>Error</h3><p>User ID is required.</p>';
                return;
            }

            try {
                const response = await fetch('/admin/manage-roles.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: `action=${encodeURIComponent(action)}&user_id=${encodeURIComponent(userId)}&role=${encodeURIComponent(role)}`
                });

                const result = await response.json();

                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>Success!</h3>
                        <p>${result.message}</p>
                        <p><strong>User ID:</strong> ${result.user_id}</p>
                        <p><strong>Role:</strong> ${result.role}</p>
                        <p><strong>Action:</strong> ${result.action}</p>
                        ${result.new_roles ? `<p><strong>Current Roles:</strong> ${result.new_roles.join(', ')}</p>` : ''}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h3>Error</h3><p>${result.error || 'Unknown error'}</p>`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>Error</h3><p>${error.message}</p>`;
            }
        });
    </script>
</body>
</html>
