<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Original Dice Game Replica</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
        }
        
        .stats-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background: #333;
            padding: 15px;
            border-radius: 5px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-title {
            font-size: 12px;
            color: #ccc;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            min-width: 60px;
            display: inline-block;
        }
        
        .controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 20px 0;
            background: #333;
            padding: 20px;
            border-radius: 5px;
        }
        
        .control-group {
            text-align: center;
            position: relative;
        }
        
        .control-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .spin-btn {
            width: 30px;
            height: 30px;
            background: #555;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 3px;
            font-size: 18px;
        }
        
        .spin-btn:hover {
            background: #666;
        }
        
        .roll-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .roll-button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .roll-button:hover:not(:disabled) {
            background: #218838;
        }
        
        .result-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #333;
            border-radius: 5px;
        }
        
        .roll-result {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .roll-status {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .win {
            color: #28a745;
        }
        
        .lose {
            color: #dc3545;
        }
        
        .hilo-toggle {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .hilo-toggle:hover {
            background: #0056b3;
        }
        
        .recent-rolls {
            margin-top: 20px;
            background: #333;
            padding: 15px;
            border-radius: 5px;
        }
        
        .roll-log {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .roll-entry {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #555;
        }
        
        .roll-entry:last-child {
            border-bottom: none;
        }
        
        .debug-info {
            margin-top: 20px;
            background: #444;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Original Faucetgame Dice Replica</h1>
        <p><strong>Purpose:</strong> Testing how the original handled decimal calculations and integer wins</p>
        
        <!-- Balance Display -->
        <div class="stats-container">
            <div class="stat">
                <div class="stat-title">CREDITS</div>
                <div class="stat-value" id="credits">1000</div>
            </div>
            <div class="stat">
                <div class="stat-title">LAST WIN</div>
                <div class="stat-value" id="lastWin">0</div>
            </div>
        </div>
        
        <!-- Game Controls -->
        <div class="controls">
            <div class="control-group">
                <div class="stat-title">BET</div>
                <div class="control-buttons">
                    <button class="spin-btn" id="betSpinDown">-</button>
                    <div class="stat-value" id="bet">1</div>
                    <button class="spin-btn" id="betSpinUp">+</button>
                </div>
            </div>
            
            <div class="control-group">
                <div class="stat-title">PAYOUT</div>
                <div class="control-buttons">
                    <button class="spin-btn" id="payoutDown">-</button>
                    <div class="stat-value" id="payoutMul">2</div>
                    <button class="spin-btn" id="payoutUp">+</button>
                </div>
                <span>X</span>
            </div>
            
            <div class="control-group">
                <div class="stat-title rollunder">ROLL UNDER TO WIN</div>
                <div class="stat-value" id="rollunder">49.9</div>
                <button class="hilo-toggle" id="rollHi">HIGH</button>
            </div>
        </div>
        
        <div style="text-align: center;">
            <button class="roll-button" id="rollButton">ROLL DICE</button>
        </div>
        
        <!-- Roll Result -->
        <div class="result-container">
            <div class="roll-result" id="rollResulVal">0</div>
            <div class="roll-status" id="rollStatus">Ready to roll</div>
        </div>
        
        <!-- Debug Info -->
        <div class="debug-info">
            <h4>Debug Info (Original Algorithm)</h4>
            <div id="debugInfo">
                <div>House Edge: 1%</div>
                <div>Current Calculation: rollUnder = Math.floor((1/(payout/100)*((100-1)/100))*100)/100</div>
            </div>
        </div>
        
        <!-- Recent Rolls -->
        <div class="recent-rolls">
            <h4>Recent Rolls (Your rolls only)</h4>
            <div class="roll-log" id="rollLog">
                <div style="text-align: center; color: #666;">No rolls yet</div>
            </div>
        </div>
    </div>

    <script>
        // Original dice game variables
        var dice = {
            curBet: 1,
            curPayout: 2,
            houseEdge: 1, // 1% house edge like original
            rollLo: true, // true = roll under to win
            rolling: false,
            recentRolls: []
        };
        
        // Minimum and maximum values
        var minBet = 1;
        var maxBet = 100;
        var minPayout = 2;
        var maxPayout = 1000;
        
        // Initialize the game
        function init() {
            $('#betSpinUp').click(function() { dice.change_bet(+1); });
            $('#betSpinDown').click(function() { dice.change_bet(-1); });
            $('#payoutUp').click(function() { dice.change_payout(+1); });
            $('#payoutDown').click(function() { dice.change_payout(-1); });
            $('#rollHi').click(function() { dice.hilo_toggle(); });
            $('#rollButton').click(function() { dice.roll(); });
            
            dice.update_roll_under();
        }
        
        // EXACT copy of original change_bet function
        dice.change_bet = function(delta) {
            if (dice.rolling) { return; }
            
            dice.curBet += delta;
            
            // Check limits
            if (dice.curBet > maxBet) {
                dice.curBet = Math.min(dice.curBet, maxBet);
            }
            
            dice.curBet = Math.min(dice.curBet, dice.get_balance());
            dice.curBet = Math.max(minBet, dice.curBet);
            
            $('#bet').html(parseInt(dice.curBet));
            dice.update_display();
        };
        
        // EXACT copy of original change_payout function
        dice.change_payout = function(delta) {
            if (dice.rolling) { return; }
            
            dice.curPayout += delta;
            
            // Check limits
            if (dice.curPayout > maxPayout) {
                dice.curPayout = Math.min(dice.curPayout, maxPayout);
            }
            
            dice.curPayout = Math.min(dice.curPayout, maxPayout);
            dice.curPayout = Math.max(minPayout, dice.curPayout);
            
            dice.curPayout = Math.floor(dice.curPayout); // Original forces integer!
            
            $('#payoutMul').html(parseInt(dice.curPayout));
            
            // Calculate roll under
            dice.update_roll_under();
            
            if (dice.curPayout >= 1000) {
                // Hide suffix at very high multipliers
            }
        };
        
        // EXACT copy of original update_roll_under function
        dice.update_roll_under = function() {
            var rollUnder = Math.floor((1/(dice.curPayout/100)*((100-dice.houseEdge)/100))*100)/100;
            rollUnder = rollUnder.toFixed(2);
            
            if (dice.rollLo == false) {
                rollUnder = 100 - rollUnder;
            }
            
            dice.set_roll_under_value(rollUnder);
            dice.update_debug();
        };
        
        dice.set_roll_under_value = function(value) {
            $('#rollunder').html(parseFloat(value));
        };
        
        // EXACT copy of original hilo_toggle function
        dice.hilo_toggle = function() {
            if (dice.rollLo) {
                $('#rollHi').html("LOW");
                $('.rollunder').html('ROLL OVER TO WIN');
            }
            else {
                $('#rollHi').html("HIGH");
                $('.rollunder').html('ROLL UNDER TO WIN');
            }
            
            dice.rollLo = !dice.rollLo;
            dice.update_roll_under();
        };
        
        dice.get_balance = function() {
            return parseInt($('#credits').text());
        };
        
        dice.update_display = function() {
            // Update button state
            if (dice.get_balance() >= dice.curBet && !dice.rolling) {
                $('#rollButton').prop('disabled', false);
            } else {
                $('#rollButton').prop('disabled', true);
            }
        };
        
        dice.update_debug = function() {
            var rollUnder = Math.floor((1/(dice.curPayout/100)*((100-dice.houseEdge)/100))*100)/100;
            var winChance = (100 - dice.houseEdge) / dice.curPayout;
            var potentialWin = dice.curBet * dice.curPayout;
            
            $('#debugInfo').html(`
                <div>House Edge: ${dice.houseEdge}%</div>
                <div>Bet: ${dice.curBet} credits</div>
                <div>Multiplier: ${dice.curPayout}x</div>
                <div>Win Chance: ${winChance.toFixed(4)}% (${(100-dice.houseEdge)/dice.curPayout})</div>
                <div>Roll Threshold: ${rollUnder.toFixed(2)}</div>
                <div>Potential Win: ${potentialWin} credits (always integer: bet Ã— multiplier)</div>
                <div>Mode: ${dice.rollLo ? 'LOW (roll under)' : 'HIGH (roll over)'}</div>
                <div><strong>Original Calculation:</strong> Math.floor((1/(${dice.curPayout}/100)*((100-${dice.houseEdge})/100))*100)/100</div>
            `);
        };
        
        // Simulate a dice roll using original logic
        dice.roll = function() {
            if (dice.rolling || dice.get_balance() < dice.curBet) {
                return;
            }
            
            dice.rolling = true;
            $('#rollButton').prop('disabled', true);
            $('#rollStatus').text('Rolling...');
            
            // Deduct bet
            var newBalance = dice.get_balance() - dice.curBet;
            $('#credits').text(newBalance);
            
            // Simulate server delay
            setTimeout(function() {
                // Generate roll result (1-100, with decimals)
                var rollResult = Math.random() * 99 + 1; // 1.00 to 99.99
                
                // Calculate win threshold (using original formula)
                var rollUnder = Math.floor((1/(dice.curPayout/100)*((100-dice.houseEdge)/100))*100)/100;
                
                var isWin = false;
                if (dice.rollLo) {
                    // Roll under to win
                    isWin = rollResult <= rollUnder;
                } else {
                    // Roll over to win
                    isWin = rollResult >= (100 - rollUnder);
                }
                
                // Calculate win amount (ALWAYS INTEGER like original)
                var winAmount = isWin ? dice.curBet * dice.curPayout : 0;
                
                // Update display
                $('#rollResulVal').text(rollResult.toFixed(2));
                
                if (isWin) {
                    $('#rollStatus').html('<span class="win">YOU WIN! ðŸŽ‰</span>');
                    $('#credits').text(dice.get_balance() + winAmount);
                    $('#lastWin').text(winAmount);
                } else {
                    $('#rollStatus').html('<span class="lose">YOU LOSE ðŸ˜¢</span>');
                    $('#lastWin').text(0);
                }
                
                // Add to recent rolls
                dice.recentRolls.unshift({
                    roll: rollResult.toFixed(2),
                    bet: dice.curBet,
                    multiplier: dice.curPayout,
                    win: isWin,
                    winAmount: winAmount,
                    threshold: rollUnder.toFixed(2),
                    mode: dice.rollLo ? 'UNDER' : 'OVER'
                });
                
                if (dice.recentRolls.length > 10) {
                    dice.recentRolls = dice.recentRolls.slice(0, 10);
                }
                
                dice.update_recent_rolls();
                dice.rolling = false;
                dice.update_display();
                
            }, 1500);
        };
        
        dice.update_recent_rolls = function() {
            if (dice.recentRolls.length === 0) {
                $('#rollLog').html('<div style="text-align: center; color: #666;">No rolls yet</div>');
                return;
            }
            
            var html = '';
            dice.recentRolls.forEach(function(roll) {
                var resultClass = roll.win ? 'win' : 'lose';
                var resultText = roll.win ? `+${roll.winAmount}` : `-${roll.bet}`;
                html += `
                    <div class="roll-entry">
                        <div>
                            <strong>${roll.roll}</strong> 
                            (${roll.mode} ${roll.threshold}) 
                            ${roll.bet} Ã— ${roll.multiplier}x
                        </div>
                        <div class="${resultClass}"><strong>${resultText}</strong></div>
                    </div>
                `;
            });
            $('#rollLog').html(html);
        };
        
        // Initialize when page loads
        $(document).ready(function() {
            init();
            dice.update_display();
            dice.update_debug();
        });
    </script>
</body>
</html>
