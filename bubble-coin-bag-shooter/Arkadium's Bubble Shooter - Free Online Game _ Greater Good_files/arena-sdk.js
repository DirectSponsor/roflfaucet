(function(Ge,He){typeof exports=="object"&&typeof module<"u"?He(exports):typeof define=="function"&&define.amd?define(["exports"],He):(Ge=typeof globalThis<"u"?globalThis:Ge||self,He(Ge.ArenaSDK={}))})(this,function(Ge){"use strict";var He=function(t,e){return He=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i])},He(t,e)};function Gi(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");He(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var G=function(){return G=Object.assign||function(e){for(var r,s=1,i=arguments.length;s<i;s++){r=arguments[s];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},G.apply(this,arguments)};function ya(t,e,r,s){function i(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function u(l){try{c(s.next(l))}catch(d){a(d)}}function o(l){try{c(s.throw(l))}catch(d){a(d)}}function c(l){l.done?n(l.value):i(l.value).then(u,o)}c((s=s.apply(t,[])).next())})}function _a(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,i,n,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(c){return function(l){return o([c,l])}}function o(c){if(s)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(r=0)),r;)try{if(s=1,i&&(n=c[0]&2?i.return:c[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,c[1])).done)return n;switch(i=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){r.label=c[1];break}if(c[0]===6&&r.label<n[1]){r.label=n[1],n=c;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(c);break}n[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(l){c=[6,l],i=0}finally{s=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var va=["POST","PATCH"],ut=function(t,e){return e=e||{},e.headers=e.headers||{"Content-Type":"application/json"},!e.headers["Content-Type"]&&va.indexOf(e.method.toUpperCase())!==-1&&(e.headers["Content-Type"]="application/json"),fetch(t,e).then(function(r){return r.text().then(function(s){var i;try{i=JSON.parse(s)}catch{}if(r.status>=200&&r.status<300)return i||s;var n=new wa(r);throw i&&(i=Array.isArray(i)?i[0]:i),n.body=i||s,n})})},wa=function(t){Gi(e,t);function e(r){var s=t.call(this,"".concat(r.status," - ").concat(r.statusText," for ").concat(r.url))||this;return s.name="HttpError",s.response=r,s}return e}(Error),kt;(function(t){t.ACCESS_TOKEN="eagle-access-token",t.REFRESH_TOKEN="eagle-refresh-token",t.EXPIRES_IN="eagle-expires_in"})(kt||(kt={}));var Li=function(){function t(){}return t.prototype.getAccessTokenKey=function(){return kt.ACCESS_TOKEN},t.prototype.getRefreshTokenKey=function(){return kt.REFRESH_TOKEN},t.prototype.getExpiresInKey=function(){return kt.EXPIRES_IN},t}(),ba=function(){function t(){this.storage={},this.storage={}}return t.prototype.getItem=function(e){return this.storage[e]},t.prototype.setItem=function(e,r){this.storage[e]=r},t.prototype.removeItem=function(e){delete this.storage[e]},t}(),Sa=function(){function t(){try{this.lsRef=window.localStorage}catch{try{this.lsRef=window.sessionStorage}catch{this.lsRef=new ba}}}return t.prototype.getItem=function(e){return Promise.resolve(this.lsRef.getItem(e))},t.prototype.setItem=function(e,r){return this.lsRef.setItem(e,r),Promise.resolve()},t.prototype.removeItem=function(e){return this.lsRef.removeItem(e),Promise.resolve()},t}(),Ne=function(){function t(){this.AccessToken="",this.RefreshToken="",this.ExpiresIn=0}return t.prototype.update=function(e){this.AccessToken=e.AccessToken,this.RefreshToken=e.RefreshToken,this.ExpiresIn=e.ExpiresIn},t.fromV1=function(e){var r=new t;return r.AccessToken=e.access_token,r.RefreshToken=e.refresh_token,r.ExpiresIn=e.expires_in,r},t.fromV2=function(e){var r=new t;return r.AccessToken=e.access_toOOOOOOKEN,r.RefreshToken=e.refresh_tOOOOOOOoken,r.ExpiresIn=e.expires_inOOOOOOOOOO,r},t.fromStorage=function(e,r){return ya(this,void 0,void 0,function(){var s,i,n,a,u;return _a(this,function(o){switch(o.label){case 0:return r=r||new Li,s=new t,i=s,[4,e.getItem(r.getAccessTokenKey())];case 1:return i.AccessToken=o.sent()||"",n=s,[4,e.getItem(r.getRefreshTokenKey())];case 2:return n.RefreshToken=o.sent()||"",a=s,u=parseInt,[4,e.getItem(r.getExpiresInKey())];case 3:return a.ExpiresIn=u.apply(void 0,[o.sent()||"0",10]),[2,s]}})})},t}(),Pa=function(){function t(){var e=this;this.resolve=function(){return null},this.reject=function(){return null},this.promise=new Promise(function(r,s){e.resolve=r,e.reject=s})}return t}(),zi=function(){function t(e,r){var s=this;this.data=new Ne,this.updateCb=[],this.tokenDeffered=null,this.broadcastToIframe=!1,this.receiveInIframe=!1,this.iframe=void 0,this.handleMessageFromIframe=function(i){var n=s.parseMessageEvent(i);n&&(s.iframe=n,s.triggerUpdate())},this.parseMessageEvent=function(i){var n=null;if(i&&i.data&&typeof i.data=="string"){var a="";if(i.data.startsWith("subscribe")&&(a=i.data.replace("subscribe: ","")),a.length>0){var u=a;try{var o=new URL(a);a=o.toString()}catch{a=u}var c='iframe[src="'.concat(a,'"]');n=document.querySelector(c)}}return n},this.handleMessageInIframe=function(i){if(i&&i.data)try{var n=JSON.parse(i.data);n&&n.type==="token-exchange"&&(console.log("client-lib token exchange",n.data),s.update(Ne.fromV1({access_token:n.data.AccessToken,refresh_token:n.data.RefreshToken,expires_in:n.data.ExpiresIn})))}catch{}},this.server=e,this.tokenStorage=r.storage||new Sa,this.broadcastToIframe=r.broadcastToIframe,this.receiveInIframe=r.receiveInIframe,this.sessionToken=r.sessionToken||new Li,this.initIframeConnection(),this.restoreState()}return t.prototype.checkAuthStatus=function(){this.triggerUpdate()},t.prototype.restoreState=function(){var e=this;return Ne.fromStorage(this.tokenStorage,this.sessionToken).then(function(r){e.update(r)})},t.prototype.triggerUpdate=function(){var e,r;this.broadcastToIframe&&((r=(e=this.iframe)===null||e===void 0?void 0:e.contentWindow)===null||r===void 0||r.postMessage(JSON.stringify({type:"token-exchange",data:this.data}),"*")),this.updateCb.forEach(function(s){return s()})},t.prototype.onUpdate=function(e){this.updateCb.push(e)},t.prototype.getToken=function(){if(this.tokenDeffered)return this.tokenDeffered.promise;var e=this.data.ExpiresIn*1e3,r=e>=Date.now()&&e<=Date.now()+18e5;return r?(this.tokenDeffered=this.refreshToken(),this.tokenDeffered.promise):(this.data.ExpiresIn-10)*1e3>Date.now()?Promise.resolve(this.data.AccessToken):this.data.AccessToken===""||this.data.RefreshToken===""?Promise.reject("Refresh token is empty!"):(this.tokenDeffered=this.refreshToken(),this.tokenDeffered.promise)},t.prototype.update=function(e){this.data=e,this.saveToStorage(),this.triggerUpdate()},t.prototype.saveToStorage=function(){this.tokenStorage.setItem(this.sessionToken.getAccessTokenKey(),this.data.AccessToken),this.tokenStorage.setItem(this.sessionToken.getRefreshTokenKey(),this.data.RefreshToken),this.tokenStorage.setItem(this.sessionToken.getExpiresInKey(),String(this.data.ExpiresIn))},t.prototype.initIframeConnection=function(){this.receiveInIframe&&window.top&&(window.removeEventListener("message",this.handleMessageInIframe),window.addEventListener("message",this.handleMessageInIframe),window.top.postMessage("subscribe: "+window.location.href,"*")),this.broadcastToIframe&&window.addEventListener("message",this.handleMessageFromIframe)},t.prototype.refreshToken=function(){var e=this;return this.tokenDeffered=new Pa,ut(this.server.toString()+"auth/refresh-token",{method:"POST",headers:{Authorization:"Bearer ".concat(this.data.AccessToken)},body:JSON.stringify({refreshToken:this.data.RefreshToken})}).then(function(r){var s;e.update(Ne.fromV1(r)),(s=e.tokenDeffered)===null||s===void 0||s.resolve(e.data.AccessToken),e.tokenDeffered=null}).catch(function(r){var s;(s=e.tokenDeffered)===null||s===void 0||s.reject(r),e.tokenDeffered=null}),this.tokenDeffered},t.prototype.isAuthorised=function(){return!!this.data.AccessToken&&!!this.data.RefreshToken&&this.data.ExpiresIn*1e3>Date.now()},t.prototype.logout=function(){this.tokenStorage.removeItem(this.sessionToken.getAccessTokenKey()),this.tokenStorage.removeItem(this.sessionToken.getRefreshTokenKey()),this.tokenStorage.removeItem(this.sessionToken.getExpiresInKey()),this.data=new Ne,this.triggerUpdate()},t}(),Ea=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(Ne.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i,n,a){if(i===void 0&&(i=""),n===void 0&&(n=""),!this.server)throw new Error("No server url provided");var u=new Headers({"Content-Type":"application/json"});return i&&u.append("Authorization","Bearer ".concat(i)),n&&u.append("recaptcha",n),a&&u.append("recaptcha-mode",a),ut(this.server.toString()+r,{method:e,headers:u,body:JSON.stringify(G({},s))})},t.prototype.doPost=function(e,r,s){s===void 0&&(s="");var i=r.captchaToken||"",n=r.captchaMode||void 0;return delete r.captchaToken,delete r.captchaMode,this.makeRequest("POST",e,r,s,i,n)},t.prototype.registerViaEmail=function(e){return this.doPost("auth/register",G(G({},e),{registrationPlaceUrl:e.registrationPlaceUrl?e.registrationPlaceUrl.toString():void 0}))},t.prototype.loginViaEmail=function(e){var r=this;return this.doPost("auth/login",G(G({},e),{registrationPlaceUrl:e.registrationPlaceUrl?e.registrationPlaceUrl.toString():void 0})).then(function(s){return r.saveCredential(s)})},t.prototype.loginViaApple=function(e){var r=this;return this.doPost("auth/login/apple",G(G({},e),{registrationPlaceUrl:e.registrationPlaceUrl?e.registrationPlaceUrl.toString():void 0})).then(function(s){return r.saveCredential(s),s.payload})},t.prototype.loginViaFacebook=function(e){var r=this;return this.doPost("auth/login/facebook",G(G({},e),{registrationPlaceUrl:e.registrationPlaceUrl?e.registrationPlaceUrl.toString():void 0})).then(function(s){return r.saveCredential(s),s.payload})},t.prototype.loginViaGoogle=function(e){var r=this;return this.doPost("auth/login/google",G(G({},e),{registrationPlaceUrl:e.registrationPlaceUrl?e.registrationPlaceUrl.toString():void 0})).then(function(s){return r.saveCredential(s),s.payload})},t.prototype.loginViaUsat=function(e){var r=this;return this.doPost("auth/login/usat",G(G({},e),{registrationPlaceUrl:e.registrationPlaceUrl?e.registrationPlaceUrl.toString():void 0})).then(function(s){return r.saveCredential(s),s.payload})},t.prototype.loginViaHsn=function(e){var r=this;return this.doPost("auth/login/hsn",G(G({},e),{registrationPlaceUrl:e.registrationPlaceUrl?e.registrationPlaceUrl.toString():void 0})).then(function(s){return r.saveCredential(s),s.payload})},t.prototype.resendConfirmation=function(e){return this.doPost("auth/email/resend-confirmation",G({},e))},t.prototype.confirmUser=function(e){return this.doPost("auth/email/confirm",G({},e))},t.prototype.checkPasswordComplexity=function(e){return this.doPost("auth/password/check-complexity",G({},e))},t.prototype.changePassword=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("auth/password/change",G({},e),s)}):Promise.reject("Please, provide session storage")},t.prototype.requestResetPassword=function(e){return this.doPost("auth/password/reset/request",G(G({},e),{resetPasswordConfirmationFormUrl:e.resetPasswordConfirmationFormUrl?e.resetPasswordConfirmationFormUrl.toString():void 0,registrationPlaceUrl:e.registrationPlaceUrl?e.registrationPlaceUrl.toString():void 0}))},t.prototype.confirmResetPassword=function(e){return this.doPost("auth/password/reset/confirm",G({},e))},t.prototype.getFacebookButton=function(){return"https://login.arkadium.com/arenax-connect/azure.facebook.next.index.html"},t.prototype.getGoogleButton=function(){return"https://login.arkadium.com/arenax-connect/azure.google.next.index.html"},t}(),Ta=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(Ne.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i,n,a){if(s===void 0&&(s=null),i===void 0&&(i=""),n===void 0&&(n=""),!this.server)throw new Error("No server url provided");var u=new Headers({"Content-Type":"application/json"});return i&&u.append("Authorization","Bearer ".concat(i)),n&&u.append("recaptcha",n),a&&u.append("recaptcha-mode",a),ut(this.server.toString()+r,G({method:e,headers:u},s?{body:JSON.stringify(G({},s))}:{}))},t.prototype.doPost=function(e,r,s){s===void 0&&(s="");var i=r.captchaToken||"",n=r.captchaMode||void 0;return delete r.captchaToken,delete r.captchaMode,this.makeRequest("POST",e,r,s,i,n)},t.prototype.doPatch=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("PATCH",e,r,s)},t.prototype.doDelete=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("DELETE",e,r,s)},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.getUserProfile=function(){var e=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(r){return e.doGet("user",r)}):Promise.reject("Please, provide session storage")},t.prototype.getPublicUserProfile=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doGet("user/".concat(e),s)}):Promise.reject("Please, provide session storage")},t.prototype.updateUser=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPatch("user",G({},e),s)}):Promise.reject("Please, provide session storage")},t.prototype.getUserByEmail=function(e){return this.sessionStorage?this.doGet("user/email/".concat(e)):Promise.reject("Please, provide session storage")},t.prototype.generateUserName=function(){return this.sessionStorage?this.doGet("user/generate"):Promise.reject("Please, provide session storage")},t.prototype.checkUserEmail=function(e){return this.sessionStorage?this.doPost("user/check-email",G({},e)):Promise.reject("Please, provide session storage")},t.prototype.checkUserName=function(e){return this.sessionStorage?this.doPost("user/check-name",G({},e)):Promise.reject("Please, provide session storage")},t.prototype.changeEmailRequest=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("user/email/request",G(G({},e),{changeEmailFormUrl:e.changeEmailFormUrl?e.changeEmailFormUrl.toString():void 0}),s)}):Promise.reject("Please, provide session storage")},t.prototype.changeEmailConfirm=function(e){return this.sessionStorage?this.doPost("user/email/confirm",G({},e)):Promise.reject("Please, provide session storage")},t.prototype.softDelete=function(){var e=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(r){return e.doDelete("user",null,r)}):Promise.reject("Please, provide session storage")},t.prototype.gdprDelete=function(){var e=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(r){return e.doDelete("user/gdpr",null,r)}):Promise.reject("Please, provide session storage")},t}(),ka=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(Ne.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i){if(s===void 0&&(s=null),i===void 0&&(i=""),!this.server)throw new Error("No server url provided");return ut(this.server.toString()+r,G(G({method:e},i?{headers:{Authorization:"Bearer ".concat(i)}}:{}),s?{body:JSON.stringify(G({},s))}:{}))},t.prototype.doPost=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("POST",e,r,s)},t.prototype.doPatch=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("PATCH",e,r,s)},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.getCountries=function(){var e=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(r){return e.doGet("dictionary/country",r)}):Promise.reject("Please, provide session storage")},t.prototype.getLanguages=function(){var e=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(r){return e.doGet("dictionary/language",r)}):Promise.reject("Please, provide session storage")},t}(),$a=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(Ne.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i){if(s===void 0&&(s=null),i===void 0&&(i=""),!this.server)throw new Error("No server url provided");return ut(this.server.toString()+r,G(G({method:e},i?{headers:{Authorization:"Bearer ".concat(i)}}:{}),s?{body:JSON.stringify(G({},s))}:{}))},t.prototype.doPost=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("POST",e,r,s)},t.prototype.doPatch=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("PATCH",e,r,s)},t.prototype.doDelete=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("DELETE",e,r,s)},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.getUserFavoriteGames=function(){var e=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(r){return e.doGet("user-favorite-game",r)}):Promise.reject("Please, provide session storage")},t.prototype.addFavoriteGame=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("user-favorite-game",G({},e),s)}):Promise.reject("Please, provide session storage")},t.prototype.deleteFavoriteGame=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doDelete("user-favorite-game/".concat(e),null,s)}):Promise.reject("Please, provide session storage")},t}(),ct;(function(t){t[t.Opened=0]="Opened",t[t.Closed=1]="Closed"})(ct||(ct={}));var Ra=function(){function t(){}return t.prototype.onStateChange=function(e){this.cb=e},t.prototype.setState=function(e){this.cb&&this.cb(e)},t}(),$t;(function(t){t[t.onWidgetStateChanged=1]="onWidgetStateChanged",t[t.onAuthStateChanged=2]="onAuthStateChanged"})($t||($t={}));var Vi=function(){function t(e){this.isOpened=!1,this.isOpened=e}return t}(),Aa=function(){function t(e){this.isAuthorised=!1,this.isAuthorised=e}return t}(),Ia=function(){function t(){this.events={}}return t.prototype.addEventListener=function(e,r){if(this.events[e]){this.events[e].push(r);return}this.events[e]=[r]},t.prototype.removeEventListener=function(e,r){this.events[e]&&(this.events[e]=this.events[e].filter(function(s){return s!==r}))},t.prototype.fire=function(e,r){r===void 0&&(r=void 0),(this.events[e]||[]).forEach(function(s){return s(r)})},t}(),Oa="https://arenacloud.cdn.arkadiumhosted.com/uup-api-user-data-dev/api/v1",Ca=function(){function t(e,r){this.sessionStorage=null,this.apiRoot=e.apiRoot||Oa,this.sessionStorage=r}return t.prototype.makeRequest=function(e,r,s,i){return i===void 0&&(i=""),ut(r,G(G({method:e},i?{headers:{Authorization:"Bearer ".concat(i)}}:{}),s?{body:JSON.stringify(G({},s))}:{}))},t.prototype.get=function(e,r){var s=this,i,n="".concat(this.apiRoot,"/user-data/game/").concat(e,"/").concat(r);return(i=this.sessionStorage)===null||i===void 0?void 0:i.getToken().then(function(a){return s.makeRequest("GET",n,null,a)})},t.prototype.save=function(e,r,s){var i=this,n,a="".concat(this.apiRoot,"/user-data/game/").concat(e,"/").concat(r);return s&&!s.etag&&delete s.etag,(n=this.sessionStorage)===null||n===void 0?void 0:n.getToken().then(function(u){return i.makeRequest("POST",a,s,u)})},t.prototype.delete=function(e,r,s){var i=this,n,a="".concat(this.apiRoot,"/user-data/game/").concat(e,"/").concat(r,"?etag=").concat(s);return(n=this.sessionStorage)===null||n===void 0?void 0:n.getToken().then(function(u){return i.makeRequest("DELETE",a,null,u)})},t.prototype.getKeys=function(e){var r=this,s,i="".concat(this.apiRoot,"/user-data-key/game/").concat(e);return(s=this.sessionStorage)===null||s===void 0?void 0:s.getToken().then(function(n){return r.makeRequest("GET",i,null,n)})},t}(),Ji;(function(t){t[t.InvalidRequestData=1e3]="InvalidRequestData",t[t.UserNotFound=1001]="UserNotFound",t[t.UserAlreadyExist=1002]="UserAlreadyExist",t[t.UserIsNotActive=1003]="UserIsNotActive",t[t.UserIsBanned=1004]="UserIsBanned",t[t.UserIsSoftDeleted=1005]="UserIsSoftDeleted",t[t.UserRemovedViaGDPR=1006]="UserRemovedViaGDPR",t[t.EmailDoesNotSpecified=1007]="EmailDoesNotSpecified",t[t.EmailAlreadyUsed=1008]="EmailAlreadyUsed",t[t.UserNameAlreadyUsed=1009]="UserNameAlreadyUsed",t[t.RefreshTokenIsInvalid=1010]="RefreshTokenIsInvalid",t[t.EmailOrPasswordIsIncorrect=1011]="EmailOrPasswordIsIncorrect",t[t.PasswordTooEasy=1012]="PasswordTooEasy",t[t.CountryIsInvalid=1013]="CountryIsInvalid",t[t.LanguageIsInvalid=1014]="LanguageIsInvalid",t[t.UserOldPasswordIsIncorrect=1015]="UserOldPasswordIsIncorrect",t[t.NewAndOldPasswordAreEquals=1016]="NewAndOldPasswordAreEquals",t[t.UserPasswordsAreNotEqual=1017]="UserPasswordsAreNotEqual",t[t.UserNotConfirmedError=1018]="UserNotConfirmedError",t[t.UserEmailConfirmationCodeIsInvalid=1019]="UserEmailConfirmationCodeIsInvalid",t[t.UserPasswordResetCodeIsInvalid=1020]="UserPasswordResetCodeIsInvalid",t[t.TooManyFailedLoginAttempts=1021]="TooManyFailedLoginAttempts",t[t.CaptchaValidationFailed=1022]="CaptchaValidationFailed",t[t.CaptchaScoreIsTooLow=1023]="CaptchaScoreIsTooLow",t[t.EmailSenderGeneralError=2e3]="EmailSenderGeneralError",t[t.EmailSenderEmailContentIsEmpty=2001]="EmailSenderEmailContentIsEmpty",t[t.ExternalProviderError=2002]="ExternalProviderError",t[t.NoEmailChangeRequest=2003]="NoEmailChangeRequest",t[t.EmailChangeRequestCodeIsInvalid=2004]="EmailChangeRequestCodeIsInvalid",t[t.UserHasNoActiveSubscriptions=2005]="UserHasNoActiveSubscriptions",t[t.SocialPasswordAlreadyExists=2006]="SocialPasswordAlreadyExists",t[t.EmailsShouldMatch=2007]="EmailsShouldMatch",t[t.ApplicationNotFound=2008]="ApplicationNotFound",t[t.ExternalAuthApplicationIsNotAllowed=2009]="ExternalAuthApplicationIsNotAllowed",t[t.ExternalAuthTokenIsInvalid=2010]="ExternalAuthTokenIsInvalid"})(Ji||(Ji={}));var Qr,or;(function(t){t[t.v1=1]="v1"})(or||(or={}));var ar=(Qr={},Qr[or.v1]={auth:new Ea,managment:new Ta,dictionary:new ka,userFavoriteGame:new $a},Qr),Na=function(t){Gi(e,t);function e(r){var s=this,i,n;if(s=t.call(this)||this,!r.server)throw new Error("Please, provide server Url");return s.server=r.server,s.uiManager=new Ra,s.uiManager.onStateChange(function(a){switch(a){case ct.Opened:{s.fire($t.onWidgetStateChanged,new Vi(!0));break}case ct.Closed:{s.fire($t.onWidgetStateChanged,new Vi(!1));break}}}),s.sessionStorage=r.sessionStorage?r.sessionStorage:new zi(r.server,{storage:r.tokenStorage,receiveInIframe:(i=r.sessionStorageInitParams)===null||i===void 0?void 0:i.receiveInIframe,broadcastToIframe:(n=r.sessionStorageInitParams)===null||n===void 0?void 0:n.broadcastToIframe}),s.sessionStorage.onUpdate(function(){s.fire($t.onAuthStateChanged,new Aa(s.sessionStorage.isAuthorised()))}),s}return e.prototype.getAuthApi=function(r){var s=this;return Object.keys(ar[r]).forEach(function(i){ar[r][i].setServer(s.server),ar[r][i].setSessionStorage(s.sessionStorage)}),Promise.resolve(ar[r])},e.prototype.getUserGameDataApi=function(r){return new Ca(r,this.sessionStorage)},e.prototype.getToken=function(){return this.sessionStorage.getToken()},e.prototype.restoreState=function(){return this.sessionStorage.restoreState()},e.prototype.checkAuthorization=function(){this.sessionStorage.checkAuthStatus()},e.prototype.openWidget=function(){this.uiManager.setState(ct.Opened)},e.prototype.closeWidget=function(){this.uiManager.setState(ct.Closed)},e.prototype.getSessionStorage=function(){return this.sessionStorage},e.prototype.logout=function(){this.sessionStorage.logout()},e}(Ia);class Ma{constructor(e){this.lastValue=void 0,this.observers=[],this.lastValue=e}subscribe(e){return this.observers.push(e),this.lastValue!==void 0&&e(this.lastValue),()=>{this.observers=this.observers.filter(r=>r!==e)}}update(e){this.lastValue=e,this.observers.forEach(r=>r(e))}}function lt(t){return new Ma(t)}var Yr=(t=>(t.DEV="https://aarpcloud.cdn.arkadiumhosted.com/arenax-api-user-dev/api/v1/",t.PROD="https://aarpcloud.cdn.arkadiumhosted.com/arenax-api-user/api/v1/",t))(Yr||{}),Bi=(t=>(t.DEV="https://aarpcloud.cdn.arkadiumhosted.com/aarp-api-user-data-dev/api/v1",t.PROD="https://aarpcloud.cdn.arkadiumhosted.com/aarp-api-user-data-live/api/v1",t))(Bi||{});class Da{getUserEndpoint(e){return Yr[e]}getPaymentsEndpoint(e){return""}getCloudSaveEndpoint(e){return Bi[e]}}let Ua=class{getAccessTokenKey(){return"ark_arenax_token"}getRefreshTokenKey(){return"ark_arenax_token_refresh"}getExpiresInKey(){return"ark_arenax_token_expires_in"}};class ja extends zi{constructor(e,r){super(new URL(Yr[e]),{...r,sessionToken:new Ua})}getToken(){return this.data.ExpiresIn-10>Date.now()?Promise.resolve(this.data.AccessToken):this.data.AccessToken===""||this.data.RefreshToken===""?Promise.reject(new Error("Refresh token is empty!")):Promise.reject(new Error("Token expired!"))}isAuthorised(){return!!this.data.AccessToken&&this.data.ExpiresIn>Date.now()}}var se=(t=>(t.DEV="DEV",t.PROD="PROD",t.STAGING="STAGING",t))(se||{}),Ki=(t=>(t.DEV="https://eagle-user-api-dev.arkadiumhosted.com/",t.PROD="https://eagle-user-api-prod.arkadiumhosted.com/",t))(Ki||{}),Hi=(t=>(t.DEV="https://arenacloud.cdn.arkadiumhosted.com/eagle-payment-api-dev/",t.PROD="https://arenacloud.cdn.arkadiumhosted.com/eagle-payment-api-prod/",t))(Hi||{}),Wi=(t=>(t.DEV="https://arenacloud.cdn.arkadiumhosted.com/uup-api-user-data-dev/api/v1",t.PROD="https://arenacloud.cdn.arkadiumhosted.com/uup-api-user-data-prod/api/v1",t))(Wi||{}),Zr=(t=>(t.EAGLE="EAGLE",t.AARP="AARP",t))(Zr||{});let Xi="PROD";function xa(){return Xi}class Qi{getUserEndpoint(e){return Ki[e]}getPaymentsEndpoint(e){return Hi[e]}getCloudSaveEndpoint(e){return Wi[e]}}class qa{constructor(e){this.host=e,this.user=null,this.userGateway=null,this.userGameData=null,this.uiOpenRequest=lt(!1),this.authStatus=lt(!1),this.backendEndpoints=new Qi,this.backendType="EAGLE",this.env="DEV"}addEventListener(e,r){var s;(s=this.userGateway)==null||s.addEventListener(e,r)}async init(e,r,s=null){e==="STAGING"&&(e="PROD"),this.env=e,Xi=e,await this.setBackendEndpoints(),this.userGateway=new Na({server:this.getUserEndpoint(),sessionStorage:this.backendType==="AARP"?new ja(e,{broadcastToIframe:!r,receiveInIframe:r}):s,sessionStorageInitParams:{broadcastToIframe:!r,receiveInIframe:r}}),this.userGameData=this.userGateway.getUserGameDataApi({apiRoot:this.getCloudSaveEndpoint().toString()}),this.user=await this.userGateway.getAuthApi(or.v1);const i=1,n=2;this.userGateway.addEventListener(i,a=>{this.uiOpenRequest.update(a?a.isOpened:!1)}),this.userGateway.addEventListener(n,a=>{this.authStatus.update(a?a.isAuthorised:!1)})}async setBackendEndpoints(){const e=await this.host.getArenaName(),r={matches:["AARP"],contains:["aarp"]},s=r.contains.filter(n=>e.includes(n)),i=r.matches.includes(e)||s.length>0;this.backendEndpoints=i?new Da:new Qi,this.backendType=i?"AARP":"EAGLE"}getUserEndpoint(){return new URL(this.backendEndpoints.getUserEndpoint(this.env))}getPaymentsEndpoint(){try{return new URL(this.backendEndpoints.getPaymentsEndpoint(this.env))}catch{return null}}getCloudSaveEndpoint(){return new URL(this.backendEndpoints.getCloudSaveEndpoint(this.env))}getBackendType(){return this.backendType}getAuthToken(){var e;return(e=this.userGateway)==null?void 0:e.getToken()}getSessionStorage(){var e;return(e=this.userGateway)==null?void 0:e.getSessionStorage()}checkAuth(){var e;(e=this.userGateway)==null||e.checkAuthorization()}isUserAuthorized(){var e;return!!((e=this.userGateway)!=null&&e.getSessionStorage().isAuthorised())}openAuthForm(){var e;(e=this.userGateway)==null||e.openWidget()}closeAuthForm(){var e;(e=this.userGateway)==null||e.closeWidget()}logout(){var e;(e=this.userGateway)==null||e.logout()}getUserGameData(){if(this.userGameData&&this.isUserAuthorized())return this.userGameData}}function es(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ts={exports:{}},Yi={},be={},dt={},Rt={},V={},At={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.regexpCode=t.getEsmExportName=t.getProperty=t.safeStringify=t.stringify=t.strConcat=t.addCodeArg=t.str=t._=t.nil=t._Code=t.Name=t.IDENTIFIER=t._CodeOrName=void 0;class e{}t._CodeOrName=e,t.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class r extends e{constructor(v){if(super(),!t.IDENTIFIER.test(v))throw new Error("CodeGen: name must be a valid identifier");this.str=v}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}t.Name=r;class s extends e{constructor(v){super(),this._items=typeof v=="string"?[v]:v}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const v=this._items[0];return v===""||v==='""'}get str(){var v;return(v=this._str)!==null&&v!==void 0?v:this._str=this._items.reduce((E,$)=>`${E}${$}`,"")}get names(){var v;return(v=this._names)!==null&&v!==void 0?v:this._names=this._items.reduce((E,$)=>($ instanceof r&&(E[$.str]=(E[$.str]||0)+1),E),{})}}t._Code=s,t.nil=new s("");function i(f,...v){const E=[f[0]];let $=0;for(;$<v.length;)u(E,v[$]),E.push(f[++$]);return new s(E)}t._=i;const n=new s("+");function a(f,...v){const E=[g(f[0])];let $=0;for(;$<v.length;)E.push(n),u(E,v[$]),E.push(n,g(f[++$]));return o(E),new s(E)}t.str=a;function u(f,v){v instanceof s?f.push(...v._items):v instanceof r?f.push(v):f.push(d(v))}t.addCodeArg=u;function o(f){let v=1;for(;v<f.length-1;){if(f[v]===n){const E=c(f[v-1],f[v+1]);if(E!==void 0){f.splice(v-1,3,E);continue}f[v++]="+"}v++}}function c(f,v){if(v==='""')return f;if(f==='""')return v;if(typeof f=="string")return v instanceof r||f[f.length-1]!=='"'?void 0:typeof v!="string"?`${f.slice(0,-1)}${v}"`:v[0]==='"'?f.slice(0,-1)+v.slice(1):void 0;if(typeof v=="string"&&v[0]==='"'&&!(f instanceof r))return`"${f}${v.slice(1)}`}function l(f,v){return v.emptyStr()?f:f.emptyStr()?v:a`${f}${v}`}t.strConcat=l;function d(f){return typeof f=="number"||typeof f=="boolean"||f===null?f:g(Array.isArray(f)?f.join(","):f)}function m(f){return new s(g(f))}t.stringify=m;function g(f){return JSON.stringify(f).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}t.safeStringify=g;function _(f){return typeof f=="string"&&t.IDENTIFIER.test(f)?new s(`.${f}`):i`[${f}]`}t.getProperty=_;function w(f){if(typeof f=="string"&&t.IDENTIFIER.test(f))return new s(`${f}`);throw new Error(`CodeGen: invalid export name: ${f}, use explicit $id name mapping`)}t.getEsmExportName=w;function y(f){return new s(f.toString())}t.regexpCode=y})(At);var rs={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ValueScope=t.ValueScopeName=t.Scope=t.varKinds=t.UsedValueState=void 0;const e=At;class r extends Error{constructor(c){super(`CodeGen: "code" for ${c} not defined`),this.value=c.value}}var s;(function(o){o[o.Started=0]="Started",o[o.Completed=1]="Completed"})(s||(t.UsedValueState=s={})),t.varKinds={const:new e.Name("const"),let:new e.Name("let"),var:new e.Name("var")};class i{constructor({prefixes:c,parent:l}={}){this._names={},this._prefixes=c,this._parent=l}toName(c){return c instanceof e.Name?c:this.name(c)}name(c){return new e.Name(this._newName(c))}_newName(c){const l=this._names[c]||this._nameGroup(c);return`${c}${l.index++}`}_nameGroup(c){var l,d;if(!((d=(l=this._parent)===null||l===void 0?void 0:l._prefixes)===null||d===void 0)&&d.has(c)||this._prefixes&&!this._prefixes.has(c))throw new Error(`CodeGen: prefix "${c}" is not allowed in this scope`);return this._names[c]={prefix:c,index:0}}}t.Scope=i;class n extends e.Name{constructor(c,l){super(l),this.prefix=c}setValue(c,{property:l,itemIndex:d}){this.value=c,this.scopePath=(0,e._)`.${new e.Name(l)}[${d}]`}}t.ValueScopeName=n;const a=(0,e._)`\n`;class u extends i{constructor(c){super(c),this._values={},this._scope=c.scope,this.opts={...c,_n:c.lines?a:e.nil}}get(){return this._scope}name(c){return new n(c,this._newName(c))}value(c,l){var d;if(l.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const m=this.toName(c),{prefix:g}=m,_=(d=l.key)!==null&&d!==void 0?d:l.ref;let w=this._values[g];if(w){const v=w.get(_);if(v)return v}else w=this._values[g]=new Map;w.set(_,m);const y=this._scope[g]||(this._scope[g]=[]),f=y.length;return y[f]=l.ref,m.setValue(l,{property:g,itemIndex:f}),m}getValue(c,l){const d=this._values[c];if(d)return d.get(l)}scopeRefs(c,l=this._values){return this._reduceValues(l,d=>{if(d.scopePath===void 0)throw new Error(`CodeGen: name "${d}" has no value`);return(0,e._)`${c}${d.scopePath}`})}scopeCode(c=this._values,l,d){return this._reduceValues(c,m=>{if(m.value===void 0)throw new Error(`CodeGen: name "${m}" has no value`);return m.value.code},l,d)}_reduceValues(c,l,d={},m){let g=e.nil;for(const _ in c){const w=c[_];if(!w)continue;const y=d[_]=d[_]||new Map;w.forEach(f=>{if(y.has(f))return;y.set(f,s.Started);let v=l(f);if(v){const E=this.opts.es5?t.varKinds.var:t.varKinds.const;g=(0,e._)`${g}${E} ${f} = ${v};${this.opts._n}`}else if(v=m==null?void 0:m(f))g=(0,e._)`${g}${v}${this.opts._n}`;else throw new r(f);y.set(f,s.Completed)})}return g}}t.ValueScope=u})(rs),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.or=t.and=t.not=t.CodeGen=t.operators=t.varKinds=t.ValueScopeName=t.ValueScope=t.Scope=t.Name=t.regexpCode=t.stringify=t.getProperty=t.nil=t.strConcat=t.str=t._=void 0;const e=At,r=rs;var s=At;Object.defineProperty(t,"_",{enumerable:!0,get:function(){return s._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return s.str}}),Object.defineProperty(t,"strConcat",{enumerable:!0,get:function(){return s.strConcat}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return s.nil}}),Object.defineProperty(t,"getProperty",{enumerable:!0,get:function(){return s.getProperty}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return s.stringify}}),Object.defineProperty(t,"regexpCode",{enumerable:!0,get:function(){return s.regexpCode}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return s.Name}});var i=rs;Object.defineProperty(t,"Scope",{enumerable:!0,get:function(){return i.Scope}}),Object.defineProperty(t,"ValueScope",{enumerable:!0,get:function(){return i.ValueScope}}),Object.defineProperty(t,"ValueScopeName",{enumerable:!0,get:function(){return i.ValueScopeName}}),Object.defineProperty(t,"varKinds",{enumerable:!0,get:function(){return i.varKinds}}),t.operators={GT:new e._Code(">"),GTE:new e._Code(">="),LT:new e._Code("<"),LTE:new e._Code("<="),EQ:new e._Code("==="),NEQ:new e._Code("!=="),NOT:new e._Code("!"),OR:new e._Code("||"),AND:new e._Code("&&"),ADD:new e._Code("+")};class n{optimizeNodes(){return this}optimizeNames(h,p){return this}}class a extends n{constructor(h,p,P){super(),this.varKind=h,this.name=p,this.rhs=P}render({es5:h,_n:p}){const P=h?r.varKinds.var:this.varKind,M=this.rhs===void 0?"":` = ${this.rhs}`;return`${P} ${this.name}${M};`+p}optimizeNames(h,p){if(h[this.name.str])return this.rhs&&(this.rhs=x(this.rhs,h,p)),this}get names(){return this.rhs instanceof e._CodeOrName?this.rhs.names:{}}}class u extends n{constructor(h,p,P){super(),this.lhs=h,this.rhs=p,this.sideEffects=P}render({_n:h}){return`${this.lhs} = ${this.rhs};`+h}optimizeNames(h,p){if(!(this.lhs instanceof e.Name&&!h[this.lhs.str]&&!this.sideEffects))return this.rhs=x(this.rhs,h,p),this}get names(){const h=this.lhs instanceof e.Name?{}:{...this.lhs.names};return F(h,this.rhs)}}class o extends u{constructor(h,p,P,M){super(h,P,M),this.op=p}render({_n:h}){return`${this.lhs} ${this.op}= ${this.rhs};`+h}}class c extends n{constructor(h){super(),this.label=h,this.names={}}render({_n:h}){return`${this.label}:`+h}}class l extends n{constructor(h){super(),this.label=h,this.names={}}render({_n:h}){return`break${this.label?` ${this.label}`:""};`+h}}class d extends n{constructor(h){super(),this.error=h}render({_n:h}){return`throw ${this.error};`+h}get names(){return this.error.names}}class m extends n{constructor(h){super(),this.code=h}render({_n:h}){return`${this.code};`+h}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(h,p){return this.code=x(this.code,h,p),this}get names(){return this.code instanceof e._CodeOrName?this.code.names:{}}}class g extends n{constructor(h=[]){super(),this.nodes=h}render(h){return this.nodes.reduce((p,P)=>p+P.render(h),"")}optimizeNodes(){const{nodes:h}=this;let p=h.length;for(;p--;){const P=h[p].optimizeNodes();Array.isArray(P)?h.splice(p,1,...P):P?h[p]=P:h.splice(p,1)}return h.length>0?this:void 0}optimizeNames(h,p){const{nodes:P}=this;let M=P.length;for(;M--;){const j=P[M];j.optimizeNames(h,p)||(H(h,j.names),P.splice(M,1))}return P.length>0?this:void 0}get names(){return this.nodes.reduce((h,p)=>D(h,p.names),{})}}class _ extends g{render(h){return"{"+h._n+super.render(h)+"}"+h._n}}class w extends g{}class y extends _{}y.kind="else";class f extends _{constructor(h,p){super(p),this.condition=h}render(h){let p=`if(${this.condition})`+super.render(h);return this.else&&(p+="else "+this.else.render(h)),p}optimizeNodes(){super.optimizeNodes();const h=this.condition;if(h===!0)return this.nodes;let p=this.else;if(p){const P=p.optimizeNodes();p=this.else=Array.isArray(P)?new y(P):P}if(p)return h===!1?p instanceof f?p:p.nodes:this.nodes.length?this:new f(qe(h),p instanceof f?[p]:p.nodes);if(!(h===!1||!this.nodes.length))return this}optimizeNames(h,p){var P;if(this.else=(P=this.else)===null||P===void 0?void 0:P.optimizeNames(h,p),!!(super.optimizeNames(h,p)||this.else))return this.condition=x(this.condition,h,p),this}get names(){const h=super.names;return F(h,this.condition),this.else&&D(h,this.else.names),h}}f.kind="if";class v extends _{}v.kind="for";class E extends v{constructor(h){super(),this.iteration=h}render(h){return`for(${this.iteration})`+super.render(h)}optimizeNames(h,p){if(super.optimizeNames(h,p))return this.iteration=x(this.iteration,h,p),this}get names(){return D(super.names,this.iteration.names)}}class $ extends v{constructor(h,p,P,M){super(),this.varKind=h,this.name=p,this.from=P,this.to=M}render(h){const p=h.es5?r.varKinds.var:this.varKind,{name:P,from:M,to:j}=this;return`for(${p} ${P}=${M}; ${P}<${j}; ${P}++)`+super.render(h)}get names(){const h=F(super.names,this.from);return F(h,this.to)}}class I extends v{constructor(h,p,P,M){super(),this.loop=h,this.varKind=p,this.name=P,this.iterable=M}render(h){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(h)}optimizeNames(h,p){if(super.optimizeNames(h,p))return this.iterable=x(this.iterable,h,p),this}get names(){return D(super.names,this.iterable.names)}}class L extends _{constructor(h,p,P){super(),this.name=h,this.args=p,this.async=P}render(h){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(h)}}L.kind="func";class U extends g{render(h){return"return "+super.render(h)}}U.kind="return";class B extends _{render(h){let p="try"+super.render(h);return this.catch&&(p+=this.catch.render(h)),this.finally&&(p+=this.finally.render(h)),p}optimizeNodes(){var h,p;return super.optimizeNodes(),(h=this.catch)===null||h===void 0||h.optimizeNodes(),(p=this.finally)===null||p===void 0||p.optimizeNodes(),this}optimizeNames(h,p){var P,M;return super.optimizeNames(h,p),(P=this.catch)===null||P===void 0||P.optimizeNames(h,p),(M=this.finally)===null||M===void 0||M.optimizeNames(h,p),this}get names(){const h=super.names;return this.catch&&D(h,this.catch.names),this.finally&&D(h,this.finally.names),h}}class te extends _{constructor(h){super(),this.error=h}render(h){return`catch(${this.error})`+super.render(h)}}te.kind="catch";class W extends _{render(h){return"finally"+super.render(h)}}W.kind="finally";class C{constructor(h,p={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...p,_n:p.lines?`
`:""},this._extScope=h,this._scope=new r.Scope({parent:h}),this._nodes=[new w]}toString(){return this._root.render(this.opts)}name(h){return this._scope.name(h)}scopeName(h){return this._extScope.name(h)}scopeValue(h,p){const P=this._extScope.value(h,p);return(this._values[P.prefix]||(this._values[P.prefix]=new Set)).add(P),P}getScopeValue(h,p){return this._extScope.getValue(h,p)}scopeRefs(h){return this._extScope.scopeRefs(h,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(h,p,P,M){const j=this._scope.toName(p);return P!==void 0&&M&&(this._constants[j.str]=P),this._leafNode(new a(h,j,P)),j}const(h,p,P){return this._def(r.varKinds.const,h,p,P)}let(h,p,P){return this._def(r.varKinds.let,h,p,P)}var(h,p,P){return this._def(r.varKinds.var,h,p,P)}assign(h,p,P){return this._leafNode(new u(h,p,P))}add(h,p){return this._leafNode(new o(h,t.operators.ADD,p))}code(h){return typeof h=="function"?h():h!==e.nil&&this._leafNode(new m(h)),this}object(...h){const p=["{"];for(const[P,M]of h)p.length>1&&p.push(","),p.push(P),(P!==M||this.opts.es5)&&(p.push(":"),(0,e.addCodeArg)(p,M));return p.push("}"),new e._Code(p)}if(h,p,P){if(this._blockNode(new f(h)),p&&P)this.code(p).else().code(P).endIf();else if(p)this.code(p).endIf();else if(P)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(h){return this._elseNode(new f(h))}else(){return this._elseNode(new y)}endIf(){return this._endBlockNode(f,y)}_for(h,p){return this._blockNode(h),p&&this.code(p).endFor(),this}for(h,p){return this._for(new E(h),p)}forRange(h,p,P,M,j=this.opts.es5?r.varKinds.var:r.varKinds.let){const X=this._scope.toName(h);return this._for(new $(j,X,p,P),()=>M(X))}forOf(h,p,P,M=r.varKinds.const){const j=this._scope.toName(h);if(this.opts.es5){const X=p instanceof e.Name?p:this.var("_arr",p);return this.forRange("_i",0,(0,e._)`${X}.length`,K=>{this.var(j,(0,e._)`${X}[${K}]`),P(j)})}return this._for(new I("of",M,j,p),()=>P(j))}forIn(h,p,P,M=this.opts.es5?r.varKinds.var:r.varKinds.const){if(this.opts.ownProperties)return this.forOf(h,(0,e._)`Object.keys(${p})`,P);const j=this._scope.toName(h);return this._for(new I("in",M,j,p),()=>P(j))}endFor(){return this._endBlockNode(v)}label(h){return this._leafNode(new c(h))}break(h){return this._leafNode(new l(h))}return(h){const p=new U;if(this._blockNode(p),this.code(h),p.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(U)}try(h,p,P){if(!p&&!P)throw new Error('CodeGen: "try" without "catch" and "finally"');const M=new B;if(this._blockNode(M),this.code(h),p){const j=this.name("e");this._currNode=M.catch=new te(j),p(j)}return P&&(this._currNode=M.finally=new W,this.code(P)),this._endBlockNode(te,W)}throw(h){return this._leafNode(new d(h))}block(h,p){return this._blockStarts.push(this._nodes.length),h&&this.code(h).endBlock(p),this}endBlock(h){const p=this._blockStarts.pop();if(p===void 0)throw new Error("CodeGen: not in self-balancing block");const P=this._nodes.length-p;if(P<0||h!==void 0&&P!==h)throw new Error(`CodeGen: wrong number of nodes: ${P} vs ${h} expected`);return this._nodes.length=p,this}func(h,p=e.nil,P,M){return this._blockNode(new L(h,p,P)),M&&this.code(M).endFunc(),this}endFunc(){return this._endBlockNode(L)}optimize(h=1){for(;h-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(h){return this._currNode.nodes.push(h),this}_blockNode(h){this._currNode.nodes.push(h),this._nodes.push(h)}_endBlockNode(h,p){const P=this._currNode;if(P instanceof h||p&&P instanceof p)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${p?`${h.kind}/${p.kind}`:h.kind}"`)}_elseNode(h){const p=this._currNode;if(!(p instanceof f))throw new Error('CodeGen: "else" without "if"');return this._currNode=p.else=h,this}get _root(){return this._nodes[0]}get _currNode(){const h=this._nodes;return h[h.length-1]}set _currNode(h){const p=this._nodes;p[p.length-1]=h}}t.CodeGen=C;function D(S,h){for(const p in h)S[p]=(S[p]||0)+(h[p]||0);return S}function F(S,h){return h instanceof e._CodeOrName?D(S,h.names):S}function x(S,h,p){if(S instanceof e.Name)return P(S);if(!M(S))return S;return new e._Code(S._items.reduce((j,X)=>(X instanceof e.Name&&(X=P(X)),X instanceof e._Code?j.push(...X._items):j.push(X),j),[]));function P(j){const X=p[j.str];return X===void 0||h[j.str]!==1?j:(delete h[j.str],X)}function M(j){return j instanceof e._Code&&j._items.some(X=>X instanceof e.Name&&h[X.str]===1&&p[X.str]!==void 0)}}function H(S,h){for(const p in h)S[p]=(S[p]||0)-(h[p]||0)}function qe(S){return typeof S=="boolean"||typeof S=="number"||S===null?!S:(0,e._)`!${T(S)}`}t.not=qe;const Fe=b(t.operators.AND);function ir(...S){return S.reduce(Fe)}t.and=ir;const at=b(t.operators.OR);function A(...S){return S.reduce(at)}t.or=A;function b(S){return(h,p)=>h===e.nil?p:p===e.nil?h:(0,e._)`${T(h)} ${S} ${T(p)}`}function T(S){return S instanceof e.Name?S:(0,e._)`(${S})`}}(V);var O={};Object.defineProperty(O,"__esModule",{value:!0}),O.checkStrictMode=O.getErrorPath=O.Type=O.useFunc=O.setEvaluated=O.evaluatedPropsToName=O.mergeEvaluated=O.eachItem=O.unescapeJsonPointer=O.escapeJsonPointer=O.escapeFragment=O.unescapeFragment=O.schemaRefOrVal=O.schemaHasRulesButRef=O.schemaHasRules=O.checkUnknownRules=O.alwaysValidSchema=O.toHash=void 0;const Q=V,Fa=At;function Ga(t){const e={};for(const r of t)e[r]=!0;return e}O.toHash=Ga;function La(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(Zi(t,e),!en(e,t.self.RULES.all))}O.alwaysValidSchema=La;function Zi(t,e=t.schema){const{opts:r,self:s}=t;if(!r.strictSchema||typeof e=="boolean")return;const i=s.RULES.keywords;for(const n in e)i[n]||on(t,`unknown keyword: "${n}"`)}O.checkUnknownRules=Zi;function en(t,e){if(typeof t=="boolean")return!t;for(const r in t)if(e[r])return!0;return!1}O.schemaHasRules=en;function za(t,e){if(typeof t=="boolean")return!t;for(const r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}O.schemaHasRulesButRef=za;function Va({topSchemaRef:t,schemaPath:e},r,s,i){if(!i){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,Q._)`${r}`}return(0,Q._)`${t}${e}${(0,Q.getProperty)(s)}`}O.schemaRefOrVal=Va;function Ja(t){return tn(decodeURIComponent(t))}O.unescapeFragment=Ja;function Ba(t){return encodeURIComponent(ss(t))}O.escapeFragment=Ba;function ss(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}O.escapeJsonPointer=ss;function tn(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}O.unescapeJsonPointer=tn;function Ka(t,e){if(Array.isArray(t))for(const r of t)e(r);else e(t)}O.eachItem=Ka;function rn({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:s}){return(i,n,a,u)=>{const o=a===void 0?n:a instanceof Q.Name?(n instanceof Q.Name?t(i,n,a):e(i,n,a),a):n instanceof Q.Name?(e(i,a,n),n):r(n,a);return u===Q.Name&&!(o instanceof Q.Name)?s(i,o):o}}O.mergeEvaluated={props:rn({mergeNames:(t,e,r)=>t.if((0,Q._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,Q._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,Q._)`${r} || {}`).code((0,Q._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,Q._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,Q._)`${r} || {}`),is(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:sn}),items:rn({mergeNames:(t,e,r)=>t.if((0,Q._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,Q._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,Q._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,Q._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function sn(t,e){if(e===!0)return t.var("props",!0);const r=t.var("props",(0,Q._)`{}`);return e!==void 0&&is(t,r,e),r}O.evaluatedPropsToName=sn;function is(t,e,r){Object.keys(r).forEach(s=>t.assign((0,Q._)`${e}${(0,Q.getProperty)(s)}`,!0))}O.setEvaluated=is;const nn={};function Ha(t,e){return t.scopeValue("func",{ref:e,code:nn[e.code]||(nn[e.code]=new Fa._Code(e.code))})}O.useFunc=Ha;var ns;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(ns||(O.Type=ns={}));function Wa(t,e,r){if(t instanceof Q.Name){const s=e===ns.Num;return r?s?(0,Q._)`"[" + ${t} + "]"`:(0,Q._)`"['" + ${t} + "']"`:s?(0,Q._)`"/" + ${t}`:(0,Q._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,Q.getProperty)(t).toString():"/"+ss(t)}O.getErrorPath=Wa;function on(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}O.checkStrictMode=on;var ke={};Object.defineProperty(ke,"__esModule",{value:!0});const he=V,Xa={data:new he.Name("data"),valCxt:new he.Name("valCxt"),instancePath:new he.Name("instancePath"),parentData:new he.Name("parentData"),parentDataProperty:new he.Name("parentDataProperty"),rootData:new he.Name("rootData"),dynamicAnchors:new he.Name("dynamicAnchors"),vErrors:new he.Name("vErrors"),errors:new he.Name("errors"),this:new he.Name("this"),self:new he.Name("self"),scope:new he.Name("scope"),json:new he.Name("json"),jsonPos:new he.Name("jsonPos"),jsonLen:new he.Name("jsonLen"),jsonPart:new he.Name("jsonPart")};ke.default=Xa,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.extendErrors=t.resetErrorsCount=t.reportExtraError=t.reportError=t.keyword$DataError=t.keywordError=void 0;const e=V,r=O,s=ke;t.keywordError={message:({keyword:y})=>(0,e.str)`must pass "${y}" keyword validation`},t.keyword$DataError={message:({keyword:y,schemaType:f})=>f?(0,e.str)`"${y}" keyword must be ${f} ($data)`:(0,e.str)`"${y}" keyword is invalid ($data)`};function i(y,f=t.keywordError,v,E){const{it:$}=y,{gen:I,compositeRule:L,allErrors:U}=$,B=d(y,f,v);E??(L||U)?o(I,B):c($,(0,e._)`[${B}]`)}t.reportError=i;function n(y,f=t.keywordError,v){const{it:E}=y,{gen:$,compositeRule:I,allErrors:L}=E,U=d(y,f,v);o($,U),I||L||c(E,s.default.vErrors)}t.reportExtraError=n;function a(y,f){y.assign(s.default.errors,f),y.if((0,e._)`${s.default.vErrors} !== null`,()=>y.if(f,()=>y.assign((0,e._)`${s.default.vErrors}.length`,f),()=>y.assign(s.default.vErrors,null)))}t.resetErrorsCount=a;function u({gen:y,keyword:f,schemaValue:v,data:E,errsCount:$,it:I}){if($===void 0)throw new Error("ajv implementation error");const L=y.name("err");y.forRange("i",$,s.default.errors,U=>{y.const(L,(0,e._)`${s.default.vErrors}[${U}]`),y.if((0,e._)`${L}.instancePath === undefined`,()=>y.assign((0,e._)`${L}.instancePath`,(0,e.strConcat)(s.default.instancePath,I.errorPath))),y.assign((0,e._)`${L}.schemaPath`,(0,e.str)`${I.errSchemaPath}/${f}`),I.opts.verbose&&(y.assign((0,e._)`${L}.schema`,v),y.assign((0,e._)`${L}.data`,E))})}t.extendErrors=u;function o(y,f){const v=y.const("err",f);y.if((0,e._)`${s.default.vErrors} === null`,()=>y.assign(s.default.vErrors,(0,e._)`[${v}]`),(0,e._)`${s.default.vErrors}.push(${v})`),y.code((0,e._)`${s.default.errors}++`)}function c(y,f){const{gen:v,validateName:E,schemaEnv:$}=y;$.$async?v.throw((0,e._)`new ${y.ValidationError}(${f})`):(v.assign((0,e._)`${E}.errors`,f),v.return(!1))}const l={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function d(y,f,v){const{createErrors:E}=y.it;return E===!1?(0,e._)`{}`:m(y,f,v)}function m(y,f,v={}){const{gen:E,it:$}=y,I=[g($,v),_(y,v)];return w(y,f,I),E.object(...I)}function g({errorPath:y},{instancePath:f}){const v=f?(0,e.str)`${y}${(0,r.getErrorPath)(f,r.Type.Str)}`:y;return[s.default.instancePath,(0,e.strConcat)(s.default.instancePath,v)]}function _({keyword:y,it:{errSchemaPath:f}},{schemaPath:v,parentSchema:E}){let $=E?f:(0,e.str)`${f}/${y}`;return v&&($=(0,e.str)`${$}${(0,r.getErrorPath)(v,r.Type.Str)}`),[l.schemaPath,$]}function w(y,{params:f,message:v},E){const{keyword:$,data:I,schemaValue:L,it:U}=y,{opts:B,propertyName:te,topSchemaRef:W,schemaPath:C}=U;E.push([l.keyword,$],[l.params,typeof f=="function"?f(y):f||(0,e._)`{}`]),B.messages&&E.push([l.message,typeof v=="function"?v(y):v]),B.verbose&&E.push([l.schema,L],[l.parentSchema,(0,e._)`${W}${C}`],[s.default.data,I]),te&&E.push([l.propertyName,te])}}(Rt),Object.defineProperty(dt,"__esModule",{value:!0}),dt.boolOrEmptySchema=dt.topBoolOrEmptySchema=void 0;const Qa=Rt,Ya=V,Za=ke,eu={message:"boolean schema is false"};function tu(t){const{gen:e,schema:r,validateName:s}=t;r===!1?an(t,!1):typeof r=="object"&&r.$async===!0?e.return(Za.default.data):(e.assign((0,Ya._)`${s}.errors`,null),e.return(!0))}dt.topBoolOrEmptySchema=tu;function ru(t,e){const{gen:r,schema:s}=t;s===!1?(r.var(e,!1),an(t)):r.var(e,!0)}dt.boolOrEmptySchema=ru;function an(t,e){const{gen:r,data:s}=t,i={gen:r,keyword:"false schema",data:s,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,Qa.reportError)(i,eu,void 0,e)}var ie={},We={};Object.defineProperty(We,"__esModule",{value:!0}),We.getRules=We.isJSONType=void 0;const su=["string","number","integer","boolean","null","object","array"],iu=new Set(su);function nu(t){return typeof t=="string"&&iu.has(t)}We.isJSONType=nu;function ou(){const t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}We.getRules=ou;var Me={};Object.defineProperty(Me,"__esModule",{value:!0}),Me.shouldUseRule=Me.shouldUseGroup=Me.schemaHasRulesForType=void 0;function au({schema:t,self:e},r){const s=e.RULES.types[r];return s&&s!==!0&&un(t,s)}Me.schemaHasRulesForType=au;function un(t,e){return e.rules.some(r=>cn(t,r))}Me.shouldUseGroup=un;function cn(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(s=>t[s]!==void 0))}Me.shouldUseRule=cn,Object.defineProperty(ie,"__esModule",{value:!0}),ie.reportTypeError=ie.checkDataTypes=ie.checkDataType=ie.coerceAndCheckDataType=ie.getJSONTypes=ie.getSchemaTypes=ie.DataType=void 0;const uu=We,cu=Me,lu=Rt,z=V,ln=O;var ht;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(ht||(ie.DataType=ht={}));function du(t){const e=dn(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}ie.getSchemaTypes=du;function dn(t){const e=Array.isArray(t)?t:t?[t]:[];if(e.every(uu.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}ie.getJSONTypes=dn;function hu(t,e){const{gen:r,data:s,opts:i}=t,n=fu(e,i.coerceTypes),a=e.length>0&&!(n.length===0&&e.length===1&&(0,cu.schemaHasRulesForType)(t,e[0]));if(a){const u=as(e,s,i.strictNumbers,ht.Wrong);r.if(u,()=>{n.length?mu(t,e,n):us(t)})}return a}ie.coerceAndCheckDataType=hu;const hn=new Set(["string","number","integer","boolean","null"]);function fu(t,e){return e?t.filter(r=>hn.has(r)||e==="array"&&r==="array"):[]}function mu(t,e,r){const{gen:s,data:i,opts:n}=t,a=s.let("dataType",(0,z._)`typeof ${i}`),u=s.let("coerced",(0,z._)`undefined`);n.coerceTypes==="array"&&s.if((0,z._)`${a} == 'object' && Array.isArray(${i}) && ${i}.length == 1`,()=>s.assign(i,(0,z._)`${i}[0]`).assign(a,(0,z._)`typeof ${i}`).if(as(e,i,n.strictNumbers),()=>s.assign(u,i))),s.if((0,z._)`${u} !== undefined`);for(const c of r)(hn.has(c)||c==="array"&&n.coerceTypes==="array")&&o(c);s.else(),us(t),s.endIf(),s.if((0,z._)`${u} !== undefined`,()=>{s.assign(i,u),pu(t,u)});function o(c){switch(c){case"string":s.elseIf((0,z._)`${a} == "number" || ${a} == "boolean"`).assign(u,(0,z._)`"" + ${i}`).elseIf((0,z._)`${i} === null`).assign(u,(0,z._)`""`);return;case"number":s.elseIf((0,z._)`${a} == "boolean" || ${i} === null
              || (${a} == "string" && ${i} && ${i} == +${i})`).assign(u,(0,z._)`+${i}`);return;case"integer":s.elseIf((0,z._)`${a} === "boolean" || ${i} === null
              || (${a} === "string" && ${i} && ${i} == +${i} && !(${i} % 1))`).assign(u,(0,z._)`+${i}`);return;case"boolean":s.elseIf((0,z._)`${i} === "false" || ${i} === 0 || ${i} === null`).assign(u,!1).elseIf((0,z._)`${i} === "true" || ${i} === 1`).assign(u,!0);return;case"null":s.elseIf((0,z._)`${i} === "" || ${i} === 0 || ${i} === false`),s.assign(u,null);return;case"array":s.elseIf((0,z._)`${a} === "string" || ${a} === "number"
              || ${a} === "boolean" || ${i} === null`).assign(u,(0,z._)`[${i}]`)}}}function pu({gen:t,parentData:e,parentDataProperty:r},s){t.if((0,z._)`${e} !== undefined`,()=>t.assign((0,z._)`${e}[${r}]`,s))}function os(t,e,r,s=ht.Correct){const i=s===ht.Correct?z.operators.EQ:z.operators.NEQ;let n;switch(t){case"null":return(0,z._)`${e} ${i} null`;case"array":n=(0,z._)`Array.isArray(${e})`;break;case"object":n=(0,z._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":n=a((0,z._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":n=a();break;default:return(0,z._)`typeof ${e} ${i} ${t}`}return s===ht.Correct?n:(0,z.not)(n);function a(u=z.nil){return(0,z.and)((0,z._)`typeof ${e} == "number"`,u,r?(0,z._)`isFinite(${e})`:z.nil)}}ie.checkDataType=os;function as(t,e,r,s){if(t.length===1)return os(t[0],e,r,s);let i;const n=(0,ln.toHash)(t);if(n.array&&n.object){const a=(0,z._)`typeof ${e} != "object"`;i=n.null?a:(0,z._)`!${e} || ${a}`,delete n.null,delete n.array,delete n.object}else i=z.nil;n.number&&delete n.integer;for(const a in n)i=(0,z.and)(i,os(a,e,r,s));return i}ie.checkDataTypes=as;const gu={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,z._)`{type: ${t}}`:(0,z._)`{type: ${e}}`};function us(t){const e=yu(t);(0,lu.reportError)(e,gu)}ie.reportTypeError=us;function yu(t){const{gen:e,data:r,schema:s}=t,i=(0,ln.schemaRefOrVal)(t,s,"type");return{gen:e,keyword:"type",data:r,schema:s.type,schemaCode:i,schemaValue:i,parentSchema:s,params:{},it:t}}var ur={};Object.defineProperty(ur,"__esModule",{value:!0}),ur.assignDefaults=void 0;const ft=V,_u=O;function vu(t,e){const{properties:r,items:s}=t.schema;if(e==="object"&&r)for(const i in r)fn(t,i,r[i].default);else e==="array"&&Array.isArray(s)&&s.forEach((i,n)=>fn(t,n,i.default))}ur.assignDefaults=vu;function fn(t,e,r){const{gen:s,compositeRule:i,data:n,opts:a}=t;if(r===void 0)return;const u=(0,ft._)`${n}${(0,ft.getProperty)(e)}`;if(i){(0,_u.checkStrictMode)(t,`default is ignored for: ${u}`);return}let o=(0,ft._)`${u} === undefined`;a.useDefaults==="empty"&&(o=(0,ft._)`${o} || ${u} === null || ${u} === ""`),s.if(o,(0,ft._)`${u} = ${(0,ft.stringify)(r)}`)}var $e={},J={};Object.defineProperty(J,"__esModule",{value:!0}),J.validateUnion=J.validateArray=J.usePattern=J.callValidateCode=J.schemaProperties=J.allSchemaProperties=J.noPropertyInData=J.propertyInData=J.isOwnProperty=J.hasPropFunc=J.reportMissingProp=J.checkMissingProp=J.checkReportMissingProp=void 0;const Y=V,cs=O,Le=ke,wu=O;function bu(t,e){const{gen:r,data:s,it:i}=t;r.if(ds(r,s,e,i.opts.ownProperties),()=>{t.setParams({missingProperty:(0,Y._)`${e}`},!0),t.error()})}J.checkReportMissingProp=bu;function Su({gen:t,data:e,it:{opts:r}},s,i){return(0,Y.or)(...s.map(n=>(0,Y.and)(ds(t,e,n,r.ownProperties),(0,Y._)`${i} = ${n}`)))}J.checkMissingProp=Su;function Pu(t,e){t.setParams({missingProperty:e},!0),t.error()}J.reportMissingProp=Pu;function mn(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,Y._)`Object.prototype.hasOwnProperty`})}J.hasPropFunc=mn;function ls(t,e,r){return(0,Y._)`${mn(t)}.call(${e}, ${r})`}J.isOwnProperty=ls;function Eu(t,e,r,s){const i=(0,Y._)`${e}${(0,Y.getProperty)(r)} !== undefined`;return s?(0,Y._)`${i} && ${ls(t,e,r)}`:i}J.propertyInData=Eu;function ds(t,e,r,s){const i=(0,Y._)`${e}${(0,Y.getProperty)(r)} === undefined`;return s?(0,Y.or)(i,(0,Y.not)(ls(t,e,r))):i}J.noPropertyInData=ds;function pn(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}J.allSchemaProperties=pn;function Tu(t,e){return pn(e).filter(r=>!(0,cs.alwaysValidSchema)(t,e[r]))}J.schemaProperties=Tu;function ku({schemaCode:t,data:e,it:{gen:r,topSchemaRef:s,schemaPath:i,errorPath:n},it:a},u,o,c){const l=c?(0,Y._)`${t}, ${e}, ${s}${i}`:e,d=[[Le.default.instancePath,(0,Y.strConcat)(Le.default.instancePath,n)],[Le.default.parentData,a.parentData],[Le.default.parentDataProperty,a.parentDataProperty],[Le.default.rootData,Le.default.rootData]];a.opts.dynamicRef&&d.push([Le.default.dynamicAnchors,Le.default.dynamicAnchors]);const m=(0,Y._)`${l}, ${r.object(...d)}`;return o!==Y.nil?(0,Y._)`${u}.call(${o}, ${m})`:(0,Y._)`${u}(${m})`}J.callValidateCode=ku;const $u=(0,Y._)`new RegExp`;function Ru({gen:t,it:{opts:e}},r){const s=e.unicodeRegExp?"u":"",{regExp:i}=e.code,n=i(r,s);return t.scopeValue("pattern",{key:n.toString(),ref:n,code:(0,Y._)`${i.code==="new RegExp"?$u:(0,wu.useFunc)(t,i)}(${r}, ${s})`})}J.usePattern=Ru;function Au(t){const{gen:e,data:r,keyword:s,it:i}=t,n=e.name("valid");if(i.allErrors){const u=e.let("valid",!0);return a(()=>e.assign(u,!1)),u}return e.var(n,!0),a(()=>e.break()),n;function a(u){const o=e.const("len",(0,Y._)`${r}.length`);e.forRange("i",0,o,c=>{t.subschema({keyword:s,dataProp:c,dataPropType:cs.Type.Num},n),e.if((0,Y.not)(n),u)})}}J.validateArray=Au;function Iu(t){const{gen:e,schema:r,keyword:s,it:i}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(o=>(0,cs.alwaysValidSchema)(i,o))&&!i.opts.unevaluated)return;const a=e.let("valid",!1),u=e.name("_valid");e.block(()=>r.forEach((o,c)=>{const l=t.subschema({keyword:s,schemaProp:c,compositeRule:!0},u);e.assign(a,(0,Y._)`${a} || ${u}`),t.mergeValidEvaluated(l,u)||e.if((0,Y.not)(a))})),t.result(a,()=>t.reset(),()=>t.error(!0))}J.validateUnion=Iu,Object.defineProperty($e,"__esModule",{value:!0}),$e.validateKeywordUsage=$e.validSchemaType=$e.funcKeywordCode=$e.macroKeywordCode=void 0;const me=V,Xe=ke,Ou=J,Cu=Rt;function Nu(t,e){const{gen:r,keyword:s,schema:i,parentSchema:n,it:a}=t,u=e.macro.call(a.self,i,n,a),o=yn(r,s,u);a.opts.validateSchema!==!1&&a.self.validateSchema(u,!0);const c=r.name("valid");t.subschema({schema:u,schemaPath:me.nil,errSchemaPath:`${a.errSchemaPath}/${s}`,topSchemaRef:o,compositeRule:!0},c),t.pass(c,()=>t.error(!0))}$e.macroKeywordCode=Nu;function Mu(t,e){var r;const{gen:s,keyword:i,schema:n,parentSchema:a,$data:u,it:o}=t;Uu(o,e);const c=!u&&e.compile?e.compile.call(o.self,n,a,o):e.validate,l=yn(s,i,c),d=s.let("valid");t.block$data(d,m),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function m(){if(e.errors===!1)w(),e.modifying&&gn(t),y(()=>t.error());else{const f=e.async?g():_();e.modifying&&gn(t),y(()=>Du(t,f))}}function g(){const f=s.let("ruleErrs",null);return s.try(()=>w((0,me._)`await `),v=>s.assign(d,!1).if((0,me._)`${v} instanceof ${o.ValidationError}`,()=>s.assign(f,(0,me._)`${v}.errors`),()=>s.throw(v))),f}function _(){const f=(0,me._)`${l}.errors`;return s.assign(f,null),w(me.nil),f}function w(f=e.async?(0,me._)`await `:me.nil){const v=o.opts.passContext?Xe.default.this:Xe.default.self,E=!("compile"in e&&!u||e.schema===!1);s.assign(d,(0,me._)`${f}${(0,Ou.callValidateCode)(t,l,v,E)}`,e.modifying)}function y(f){var v;s.if((0,me.not)((v=e.valid)!==null&&v!==void 0?v:d),f)}}$e.funcKeywordCode=Mu;function gn(t){const{gen:e,data:r,it:s}=t;e.if(s.parentData,()=>e.assign(r,(0,me._)`${s.parentData}[${s.parentDataProperty}]`))}function Du(t,e){const{gen:r}=t;r.if((0,me._)`Array.isArray(${e})`,()=>{r.assign(Xe.default.vErrors,(0,me._)`${Xe.default.vErrors} === null ? ${e} : ${Xe.default.vErrors}.concat(${e})`).assign(Xe.default.errors,(0,me._)`${Xe.default.vErrors}.length`),(0,Cu.extendErrors)(t)},()=>t.error())}function Uu({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function yn(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,me.stringify)(r)})}function ju(t,e,r=!1){return!e.length||e.some(s=>s==="array"?Array.isArray(t):s==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==s||r&&typeof t>"u")}$e.validSchemaType=ju;function xu({schema:t,opts:e,self:r,errSchemaPath:s},i,n){if(Array.isArray(i.keyword)?!i.keyword.includes(n):i.keyword!==n)throw new Error("ajv implementation error");const a=i.dependencies;if(a!=null&&a.some(u=>!Object.prototype.hasOwnProperty.call(t,u)))throw new Error(`parent schema must have dependencies of ${n}: ${a.join(",")}`);if(i.validateSchema&&!i.validateSchema(t[n])){const o=`keyword "${n}" value is invalid at path "${s}": `+r.errorsText(i.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(o);else throw new Error(o)}}$e.validateKeywordUsage=xu;var ze={};Object.defineProperty(ze,"__esModule",{value:!0}),ze.extendSubschemaMode=ze.extendSubschemaData=ze.getSubschema=void 0;const Re=V,_n=O;function qu(t,{keyword:e,schemaProp:r,schema:s,schemaPath:i,errSchemaPath:n,topSchemaRef:a}){if(e!==void 0&&s!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){const u=t.schema[e];return r===void 0?{schema:u,schemaPath:(0,Re._)`${t.schemaPath}${(0,Re.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:u[r],schemaPath:(0,Re._)`${t.schemaPath}${(0,Re.getProperty)(e)}${(0,Re.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,_n.escapeFragment)(r)}`}}if(s!==void 0){if(i===void 0||n===void 0||a===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:s,schemaPath:i,topSchemaRef:a,errSchemaPath:n}}throw new Error('either "keyword" or "schema" must be passed')}ze.getSubschema=qu;function Fu(t,e,{dataProp:r,dataPropType:s,data:i,dataTypes:n,propertyName:a}){if(i!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:u}=e;if(r!==void 0){const{errorPath:c,dataPathArr:l,opts:d}=e,m=u.let("data",(0,Re._)`${e.data}${(0,Re.getProperty)(r)}`,!0);o(m),t.errorPath=(0,Re.str)`${c}${(0,_n.getErrorPath)(r,s,d.jsPropertySyntax)}`,t.parentDataProperty=(0,Re._)`${r}`,t.dataPathArr=[...l,t.parentDataProperty]}if(i!==void 0){const c=i instanceof Re.Name?i:u.let("data",i,!0);o(c),a!==void 0&&(t.propertyName=a)}n&&(t.dataTypes=n);function o(c){t.data=c,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,c]}}ze.extendSubschemaData=Fu;function Gu(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:s,createErrors:i,allErrors:n}){s!==void 0&&(t.compositeRule=s),i!==void 0&&(t.createErrors=i),n!==void 0&&(t.allErrors=n),t.jtdDiscriminator=e,t.jtdMetadata=r}ze.extendSubschemaMode=Gu;var ue={},vn=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var s,i,n;if(Array.isArray(e)){if(s=e.length,s!=r.length)return!1;for(i=s;i--!==0;)if(!t(e[i],r[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(n=Object.keys(e),s=n.length,s!==Object.keys(r).length)return!1;for(i=s;i--!==0;)if(!Object.prototype.hasOwnProperty.call(r,n[i]))return!1;for(i=s;i--!==0;){var a=n[i];if(!t(e[a],r[a]))return!1}return!0}return e!==e&&r!==r},wn={exports:{}},Ve=wn.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var s=typeof r=="function"?r:r.pre||function(){},i=r.post||function(){};cr(e,s,i,t,"",t)};Ve.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},Ve.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},Ve.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},Ve.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function cr(t,e,r,s,i,n,a,u,o,c){if(s&&typeof s=="object"&&!Array.isArray(s)){e(s,i,n,a,u,o,c);for(var l in s){var d=s[l];if(Array.isArray(d)){if(l in Ve.arrayKeywords)for(var m=0;m<d.length;m++)cr(t,e,r,d[m],i+"/"+l+"/"+m,n,i,l,s,m)}else if(l in Ve.propsKeywords){if(d&&typeof d=="object")for(var g in d)cr(t,e,r,d[g],i+"/"+l+"/"+Lu(g),n,i,l,s,g)}else(l in Ve.keywords||t.allKeys&&!(l in Ve.skipKeywords))&&cr(t,e,r,d,i+"/"+l,n,i,l,s)}r(s,i,n,a,u,o,c)}}function Lu(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}var zu=wn.exports;Object.defineProperty(ue,"__esModule",{value:!0}),ue.getSchemaRefs=ue.resolveUrl=ue.normalizeId=ue._getFullPath=ue.getFullPath=ue.inlineRef=void 0;const Vu=O,Ju=vn,Bu=zu,Ku=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function Hu(t,e=!0){return typeof t=="boolean"?!0:e===!0?!hs(t):e?bn(t)<=e:!1}ue.inlineRef=Hu;const Wu=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function hs(t){for(const e in t){if(Wu.has(e))return!0;const r=t[e];if(Array.isArray(r)&&r.some(hs)||typeof r=="object"&&hs(r))return!0}return!1}function bn(t){let e=0;for(const r in t){if(r==="$ref")return 1/0;if(e++,!Ku.has(r)&&(typeof t[r]=="object"&&(0,Vu.eachItem)(t[r],s=>e+=bn(s)),e===1/0))return 1/0}return e}function Sn(t,e="",r){r!==!1&&(e=mt(e));const s=t.parse(e);return Pn(t,s)}ue.getFullPath=Sn;function Pn(t,e){return t.serialize(e).split("#")[0]+"#"}ue._getFullPath=Pn;const Xu=/#\/?$/;function mt(t){return t?t.replace(Xu,""):""}ue.normalizeId=mt;function Qu(t,e,r){return r=mt(r),t.resolve(e,r)}ue.resolveUrl=Qu;const Yu=/^[a-z_][-a-z0-9._]*$/i;function Zu(t,e){if(typeof t=="boolean")return{};const{schemaId:r,uriResolver:s}=this.opts,i=mt(t[r]||e),n={"":i},a=Sn(s,i,!1),u={},o=new Set;return Bu(t,{allKeys:!0},(d,m,g,_)=>{if(_===void 0)return;const w=a+m;let y=n[_];typeof d[r]=="string"&&(y=f.call(this,d[r])),v.call(this,d.$anchor),v.call(this,d.$dynamicAnchor),n[m]=y;function f(E){const $=this.opts.uriResolver.resolve;if(E=mt(y?$(y,E):E),o.has(E))throw l(E);o.add(E);let I=this.refs[E];return typeof I=="string"&&(I=this.refs[I]),typeof I=="object"?c(d,I.schema,E):E!==mt(w)&&(E[0]==="#"?(c(d,u[E],E),u[E]=d):this.refs[E]=w),E}function v(E){if(typeof E=="string"){if(!Yu.test(E))throw new Error(`invalid anchor "${E}"`);f.call(this,`#${E}`)}}}),u;function c(d,m,g){if(m!==void 0&&!Ju(d,m))throw l(g)}function l(d){return new Error(`reference "${d}" resolves to more than one schema`)}}ue.getSchemaRefs=Zu,Object.defineProperty(be,"__esModule",{value:!0}),be.getData=be.KeywordCxt=be.validateFunctionCode=void 0;const En=dt,Tn=ie,fs=Me,lr=ie,ec=ur,It=$e,ms=ze,N=V,q=ke,tc=ue,De=O,Ot=Rt;function rc(t){if(An(t)&&(In(t),Rn(t))){nc(t);return}kn(t,()=>(0,En.topBoolOrEmptySchema)(t))}be.validateFunctionCode=rc;function kn({gen:t,validateName:e,schema:r,schemaEnv:s,opts:i},n){i.code.es5?t.func(e,(0,N._)`${q.default.data}, ${q.default.valCxt}`,s.$async,()=>{t.code((0,N._)`"use strict"; ${$n(r,i)}`),ic(t,i),t.code(n)}):t.func(e,(0,N._)`${q.default.data}, ${sc(i)}`,s.$async,()=>t.code($n(r,i)).code(n))}function sc(t){return(0,N._)`{${q.default.instancePath}="", ${q.default.parentData}, ${q.default.parentDataProperty}, ${q.default.rootData}=${q.default.data}${t.dynamicRef?(0,N._)`, ${q.default.dynamicAnchors}={}`:N.nil}}={}`}function ic(t,e){t.if(q.default.valCxt,()=>{t.var(q.default.instancePath,(0,N._)`${q.default.valCxt}.${q.default.instancePath}`),t.var(q.default.parentData,(0,N._)`${q.default.valCxt}.${q.default.parentData}`),t.var(q.default.parentDataProperty,(0,N._)`${q.default.valCxt}.${q.default.parentDataProperty}`),t.var(q.default.rootData,(0,N._)`${q.default.valCxt}.${q.default.rootData}`),e.dynamicRef&&t.var(q.default.dynamicAnchors,(0,N._)`${q.default.valCxt}.${q.default.dynamicAnchors}`)},()=>{t.var(q.default.instancePath,(0,N._)`""`),t.var(q.default.parentData,(0,N._)`undefined`),t.var(q.default.parentDataProperty,(0,N._)`undefined`),t.var(q.default.rootData,q.default.data),e.dynamicRef&&t.var(q.default.dynamicAnchors,(0,N._)`{}`)})}function nc(t){const{schema:e,opts:r,gen:s}=t;kn(t,()=>{r.$comment&&e.$comment&&Cn(t),lc(t),s.let(q.default.vErrors,null),s.let(q.default.errors,0),r.unevaluated&&oc(t),On(t),fc(t)})}function oc(t){const{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,N._)`${r}.evaluated`),e.if((0,N._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,N._)`${t.evaluated}.props`,(0,N._)`undefined`)),e.if((0,N._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,N._)`${t.evaluated}.items`,(0,N._)`undefined`))}function $n(t,e){const r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,N._)`/*# sourceURL=${r} */`:N.nil}function ac(t,e){if(An(t)&&(In(t),Rn(t))){uc(t,e);return}(0,En.boolOrEmptySchema)(t,e)}function Rn({schema:t,self:e}){if(typeof t=="boolean")return!t;for(const r in t)if(e.RULES.all[r])return!0;return!1}function An(t){return typeof t.schema!="boolean"}function uc(t,e){const{schema:r,gen:s,opts:i}=t;i.$comment&&r.$comment&&Cn(t),dc(t),hc(t);const n=s.const("_errs",q.default.errors);On(t,n),s.var(e,(0,N._)`${n} === ${q.default.errors}`)}function In(t){(0,De.checkUnknownRules)(t),cc(t)}function On(t,e){if(t.opts.jtd)return Nn(t,[],!1,e);const r=(0,Tn.getSchemaTypes)(t.schema),s=(0,Tn.coerceAndCheckDataType)(t,r);Nn(t,r,!s,e)}function cc(t){const{schema:e,errSchemaPath:r,opts:s,self:i}=t;e.$ref&&s.ignoreKeywordsWithRef&&(0,De.schemaHasRulesButRef)(e,i.RULES)&&i.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function lc(t){const{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,De.checkStrictMode)(t,"default is ignored in the schema root")}function dc(t){const e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,tc.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function hc(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function Cn({gen:t,schemaEnv:e,schema:r,errSchemaPath:s,opts:i}){const n=r.$comment;if(i.$comment===!0)t.code((0,N._)`${q.default.self}.logger.log(${n})`);else if(typeof i.$comment=="function"){const a=(0,N.str)`${s}/$comment`,u=t.scopeValue("root",{ref:e.root});t.code((0,N._)`${q.default.self}.opts.$comment(${n}, ${a}, ${u}.schema)`)}}function fc(t){const{gen:e,schemaEnv:r,validateName:s,ValidationError:i,opts:n}=t;r.$async?e.if((0,N._)`${q.default.errors} === 0`,()=>e.return(q.default.data),()=>e.throw((0,N._)`new ${i}(${q.default.vErrors})`)):(e.assign((0,N._)`${s}.errors`,q.default.vErrors),n.unevaluated&&mc(t),e.return((0,N._)`${q.default.errors} === 0`))}function mc({gen:t,evaluated:e,props:r,items:s}){r instanceof N.Name&&t.assign((0,N._)`${e}.props`,r),s instanceof N.Name&&t.assign((0,N._)`${e}.items`,s)}function Nn(t,e,r,s){const{gen:i,schema:n,data:a,allErrors:u,opts:o,self:c}=t,{RULES:l}=c;if(n.$ref&&(o.ignoreKeywordsWithRef||!(0,De.schemaHasRulesButRef)(n,l))){i.block(()=>jn(t,"$ref",l.all.$ref.definition));return}o.jtd||pc(t,e),i.block(()=>{for(const m of l.rules)d(m);d(l.post)});function d(m){(0,fs.shouldUseGroup)(n,m)&&(m.type?(i.if((0,lr.checkDataType)(m.type,a,o.strictNumbers)),Mn(t,m),e.length===1&&e[0]===m.type&&r&&(i.else(),(0,lr.reportTypeError)(t)),i.endIf()):Mn(t,m),u||i.if((0,N._)`${q.default.errors} === ${s||0}`))}}function Mn(t,e){const{gen:r,schema:s,opts:{useDefaults:i}}=t;i&&(0,ec.assignDefaults)(t,e.type),r.block(()=>{for(const n of e.rules)(0,fs.shouldUseRule)(s,n)&&jn(t,n.keyword,n.definition,e.type)})}function pc(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(gc(t,e),t.opts.allowUnionTypes||yc(t,e),_c(t,t.dataTypes))}function gc(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{Dn(t.dataTypes,r)||ps(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),wc(t,e)}}function yc(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&ps(t,"use allowUnionTypes to allow union type keyword")}function _c(t,e){const r=t.self.RULES.all;for(const s in r){const i=r[s];if(typeof i=="object"&&(0,fs.shouldUseRule)(t.schema,i)){const{type:n}=i.definition;n.length&&!n.some(a=>vc(e,a))&&ps(t,`missing type "${n.join(",")}" for keyword "${s}"`)}}}function vc(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function Dn(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function wc(t,e){const r=[];for(const s of t.dataTypes)Dn(e,s)?r.push(s):e.includes("integer")&&s==="number"&&r.push("integer");t.dataTypes=r}function ps(t,e){const r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,De.checkStrictMode)(t,e,t.opts.strictTypes)}class Un{constructor(e,r,s){if((0,It.validateKeywordUsage)(e,r,s),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=s,this.data=e.data,this.schema=e.schema[s],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,De.schemaRefOrVal)(e,this.schema,s,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",xn(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,It.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${s} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",q.default.errors))}result(e,r,s){this.failResult((0,N.not)(e),r,s)}failResult(e,r,s){this.gen.if(e),s?s():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,N.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);const{schemaCode:r}=this;this.fail((0,N._)`${r} !== undefined && (${(0,N.or)(this.invalid$data(),e)})`)}error(e,r,s){if(r){this.setParams(r),this._error(e,s),this.setParams({});return}this._error(e,s)}_error(e,r){(e?Ot.reportExtraError:Ot.reportError)(this,this.def.error,r)}$dataError(){(0,Ot.reportError)(this,this.def.$dataError||Ot.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,Ot.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,s=N.nil){this.gen.block(()=>{this.check$data(e,s),r()})}check$data(e=N.nil,r=N.nil){if(!this.$data)return;const{gen:s,schemaCode:i,schemaType:n,def:a}=this;s.if((0,N.or)((0,N._)`${i} === undefined`,r)),e!==N.nil&&s.assign(e,!0),(n.length||a.validateSchema)&&(s.elseIf(this.invalid$data()),this.$dataError(),e!==N.nil&&s.assign(e,!1)),s.else()}invalid$data(){const{gen:e,schemaCode:r,schemaType:s,def:i,it:n}=this;return(0,N.or)(a(),u());function a(){if(s.length){if(!(r instanceof N.Name))throw new Error("ajv implementation error");const o=Array.isArray(s)?s:[s];return(0,N._)`${(0,lr.checkDataTypes)(o,r,n.opts.strictNumbers,lr.DataType.Wrong)}`}return N.nil}function u(){if(i.validateSchema){const o=e.scopeValue("validate$data",{ref:i.validateSchema});return(0,N._)`!${o}(${r})`}return N.nil}}subschema(e,r){const s=(0,ms.getSubschema)(this.it,e);(0,ms.extendSubschemaData)(s,this.it,e),(0,ms.extendSubschemaMode)(s,e);const i={...this.it,...s,items:void 0,props:void 0};return ac(i,r),i}mergeEvaluated(e,r){const{it:s,gen:i}=this;s.opts.unevaluated&&(s.props!==!0&&e.props!==void 0&&(s.props=De.mergeEvaluated.props(i,e.props,s.props,r)),s.items!==!0&&e.items!==void 0&&(s.items=De.mergeEvaluated.items(i,e.items,s.items,r)))}mergeValidEvaluated(e,r){const{it:s,gen:i}=this;if(s.opts.unevaluated&&(s.props!==!0||s.items!==!0))return i.if(r,()=>this.mergeEvaluated(e,N.Name)),!0}}be.KeywordCxt=Un;function jn(t,e,r,s){const i=new Un(t,r,e);"code"in r?r.code(i,s):i.$data&&r.validate?(0,It.funcKeywordCode)(i,r):"macro"in r?(0,It.macroKeywordCode)(i,r):(r.compile||r.validate)&&(0,It.funcKeywordCode)(i,r)}const bc=/^\/(?:[^~]|~0|~1)*$/,Sc=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function xn(t,{dataLevel:e,dataNames:r,dataPathArr:s}){let i,n;if(t==="")return q.default.rootData;if(t[0]==="/"){if(!bc.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);i=t,n=q.default.rootData}else{const c=Sc.exec(t);if(!c)throw new Error(`Invalid JSON-pointer: ${t}`);const l=+c[1];if(i=c[2],i==="#"){if(l>=e)throw new Error(o("property/index",l));return s[e-l]}if(l>e)throw new Error(o("data",l));if(n=r[e-l],!i)return n}let a=n;const u=i.split("/");for(const c of u)c&&(n=(0,N._)`${n}${(0,N.getProperty)((0,De.unescapeJsonPointer)(c))}`,a=(0,N._)`${a} && ${n}`);return a;function o(c,l){return`Cannot access ${c} ${l} levels up, current level is ${e}`}}be.getData=xn;var Ct={};Object.defineProperty(Ct,"__esModule",{value:!0});class Pc extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}}Ct.default=Pc;var pt={};Object.defineProperty(pt,"__esModule",{value:!0});const gs=ue;class Ec extends Error{constructor(e,r,s,i){super(i||`can't resolve reference ${s} from id ${r}`),this.missingRef=(0,gs.resolveUrl)(e,r,s),this.missingSchema=(0,gs.normalizeId)((0,gs.getFullPath)(e,this.missingRef))}}pt.default=Ec;var pe={};Object.defineProperty(pe,"__esModule",{value:!0}),pe.resolveSchema=pe.getCompilingSchema=pe.resolveRef=pe.compileSchema=pe.SchemaEnv=void 0;const Se=V,Tc=Ct,Qe=ke,Pe=ue,qn=O,kc=be;class dr{constructor(e){var r;this.refs={},this.dynamicAnchors={};let s;typeof e.schema=="object"&&(s=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,Pe.normalizeId)(s==null?void 0:s[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=s==null?void 0:s.$async,this.refs={}}}pe.SchemaEnv=dr;function ys(t){const e=Fn.call(this,t);if(e)return e;const r=(0,Pe.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:s,lines:i}=this.opts.code,{ownProperties:n}=this.opts,a=new Se.CodeGen(this.scope,{es5:s,lines:i,ownProperties:n});let u;t.$async&&(u=a.scopeValue("Error",{ref:Tc.default,code:(0,Se._)`require("ajv/dist/runtime/validation_error").default`}));const o=a.scopeName("validate");t.validateName=o;const c={gen:a,allErrors:this.opts.allErrors,data:Qe.default.data,parentData:Qe.default.parentData,parentDataProperty:Qe.default.parentDataProperty,dataNames:[Qe.default.data],dataPathArr:[Se.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:a.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,Se.stringify)(t.schema)}:{ref:t.schema}),validateName:o,ValidationError:u,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:Se.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,Se._)`""`,opts:this.opts,self:this};let l;try{this._compilations.add(t),(0,kc.validateFunctionCode)(c),a.optimize(this.opts.code.optimize);const d=a.toString();l=`${a.scopeRefs(Qe.default.scope)}return ${d}`,this.opts.code.process&&(l=this.opts.code.process(l,t));const g=new Function(`${Qe.default.self}`,`${Qe.default.scope}`,l)(this,this.scope.get());if(this.scope.value(o,{ref:g}),g.errors=null,g.schema=t.schema,g.schemaEnv=t,t.$async&&(g.$async=!0),this.opts.code.source===!0&&(g.source={validateName:o,validateCode:d,scopeValues:a._values}),this.opts.unevaluated){const{props:_,items:w}=c;g.evaluated={props:_ instanceof Se.Name?void 0:_,items:w instanceof Se.Name?void 0:w,dynamicProps:_ instanceof Se.Name,dynamicItems:w instanceof Se.Name},g.source&&(g.source.evaluated=(0,Se.stringify)(g.evaluated))}return t.validate=g,t}catch(d){throw delete t.validate,delete t.validateName,l&&this.logger.error("Error compiling schema, function code:",l),d}finally{this._compilations.delete(t)}}pe.compileSchema=ys;function $c(t,e,r){var s;r=(0,Pe.resolveUrl)(this.opts.uriResolver,e,r);const i=t.refs[r];if(i)return i;let n=Ic.call(this,t,r);if(n===void 0){const a=(s=t.localRefs)===null||s===void 0?void 0:s[r],{schemaId:u}=this.opts;a&&(n=new dr({schema:a,schemaId:u,root:t,baseId:e}))}if(n!==void 0)return t.refs[r]=Rc.call(this,n)}pe.resolveRef=$c;function Rc(t){return(0,Pe.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:ys.call(this,t)}function Fn(t){for(const e of this._compilations)if(Ac(e,t))return e}pe.getCompilingSchema=Fn;function Ac(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function Ic(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||hr.call(this,t,e)}function hr(t,e){const r=this.opts.uriResolver.parse(e),s=(0,Pe._getFullPath)(this.opts.uriResolver,r);let i=(0,Pe.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&s===i)return _s.call(this,r,t);const n=(0,Pe.normalizeId)(s),a=this.refs[n]||this.schemas[n];if(typeof a=="string"){const u=hr.call(this,t,a);return typeof(u==null?void 0:u.schema)!="object"?void 0:_s.call(this,r,u)}if(typeof(a==null?void 0:a.schema)=="object"){if(a.validate||ys.call(this,a),n===(0,Pe.normalizeId)(e)){const{schema:u}=a,{schemaId:o}=this.opts,c=u[o];return c&&(i=(0,Pe.resolveUrl)(this.opts.uriResolver,i,c)),new dr({schema:u,schemaId:o,root:t,baseId:i})}return _s.call(this,r,a)}}pe.resolveSchema=hr;const Oc=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function _s(t,{baseId:e,schema:r,root:s}){var i;if(((i=t.fragment)===null||i===void 0?void 0:i[0])!=="/")return;for(const u of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;const o=r[(0,qn.unescapeFragment)(u)];if(o===void 0)return;r=o;const c=typeof r=="object"&&r[this.opts.schemaId];!Oc.has(u)&&c&&(e=(0,Pe.resolveUrl)(this.opts.uriResolver,e,c))}let n;if(typeof r!="boolean"&&r.$ref&&!(0,qn.schemaHasRulesButRef)(r,this.RULES)){const u=(0,Pe.resolveUrl)(this.opts.uriResolver,e,r.$ref);n=hr.call(this,s,u)}const{schemaId:a}=this.opts;if(n=n||new dr({schema:r,schemaId:a,root:s,baseId:e}),n.schema!==n.root.schema)return n}const Cc={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1};var vs={},fr={exports:{}},Nc={HEX:{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15}};const{HEX:Mc}=Nc;function Gn(t){if(zn(t,".")<3)return{host:t,isIPV4:!1};const e=t.match(/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/u)||[],[r]=e;return r?{host:Uc(r,"."),isIPV4:!0}:{host:t,isIPV4:!1}}function ws(t,e=!1){let r="",s=!0;for(const i of t){if(Mc[i]===void 0)return;i!=="0"&&s===!0&&(s=!1),s||(r+=i)}return e&&r.length===0&&(r="0"),r}function Dc(t){let e=0;const r={error:!1,address:"",zone:""},s=[],i=[];let n=!1,a=!1,u=!1;function o(){if(i.length){if(n===!1){const c=ws(i);if(c!==void 0)s.push(c);else return r.error=!0,!1}i.length=0}return!0}for(let c=0;c<t.length;c++){const l=t[c];if(!(l==="["||l==="]"))if(l===":"){if(a===!0&&(u=!0),!o())break;if(e++,s.push(":"),e>7){r.error=!0;break}c-1>=0&&t[c-1]===":"&&(a=!0);continue}else if(l==="%"){if(!o())break;n=!0}else{i.push(l);continue}}return i.length&&(n?r.zone=i.join(""):u?s.push(i.join("")):s.push(ws(i))),r.address=s.join(""),r}function Ln(t,e={}){if(zn(t,":")<2)return{host:t,isIPV6:!1};const r=Dc(t);if(r.error)return{host:t,isIPV6:!1};{let s=r.address,i=r.address;return r.zone&&(s+="%"+r.zone,i+="%25"+r.zone),{host:s,escapedHost:i,isIPV6:!0}}}function Uc(t,e){let r="",s=!0;const i=t.length;for(let n=0;n<i;n++){const a=t[n];a==="0"&&s?(n+1<=i&&t[n+1]===e||n+1===i)&&(r+=a,s=!1):(a===e?s=!0:s=!1,r+=a)}return r}function zn(t,e){let r=0;for(let s=0;s<t.length;s++)t[s]===e&&r++;return r}const Vn=/^\.\.?\//u,Jn=/^\/\.(?:\/|$)/u,Bn=/^\/\.\.(?:\/|$)/u,jc=/^\/?(?:.|\n)*?(?=\/|$)/u;function xc(t){const e=[];for(;t.length;)if(t.match(Vn))t=t.replace(Vn,"");else if(t.match(Jn))t=t.replace(Jn,"/");else if(t.match(Bn))t=t.replace(Bn,"/"),e.pop();else if(t==="."||t==="..")t="";else{const r=t.match(jc);if(r){const s=r[0];t=t.slice(s.length),e.push(s)}else throw new Error("Unexpected dot segment condition")}return e.join("")}function qc(t,e){const r=e!==!0?escape:unescape;return t.scheme!==void 0&&(t.scheme=r(t.scheme)),t.userinfo!==void 0&&(t.userinfo=r(t.userinfo)),t.host!==void 0&&(t.host=r(t.host)),t.path!==void 0&&(t.path=r(t.path)),t.query!==void 0&&(t.query=r(t.query)),t.fragment!==void 0&&(t.fragment=r(t.fragment)),t}function Fc(t,e){const r=[];if(t.userinfo!==void 0&&(r.push(t.userinfo),r.push("@")),t.host!==void 0){let s=unescape(t.host);const i=Gn(s);if(i.isIPV4)s=i.host;else{const n=Ln(i.host,{isIPV4:!1});n.isIPV6===!0?s=`[${n.escapedHost}]`:s=t.host}r.push(s)}return(typeof t.port=="number"||typeof t.port=="string")&&(r.push(":"),r.push(String(t.port))),r.length?r.join(""):void 0}var Gc={recomposeAuthority:Fc,normalizeComponentEncoding:qc,removeDotSegments:xc,normalizeIPv4:Gn,normalizeIPv6:Ln,stringArrayToHexStripped:ws};const Lc=/^[\da-f]{8}\b-[\da-f]{4}\b-[\da-f]{4}\b-[\da-f]{4}\b-[\da-f]{12}$/iu,zc=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu;function Kn(t){return typeof t.secure=="boolean"?t.secure:String(t.scheme).toLowerCase()==="wss"}function Hn(t){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t}function Wn(t){const e=String(t.scheme).toLowerCase()==="https";return(t.port===(e?443:80)||t.port==="")&&(t.port=void 0),t.path||(t.path="/"),t}function Vc(t){return t.secure=Kn(t),t.resourceName=(t.path||"/")+(t.query?"?"+t.query:""),t.path=void 0,t.query=void 0,t}function Jc(t){if((t.port===(Kn(t)?443:80)||t.port==="")&&(t.port=void 0),typeof t.secure=="boolean"&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){const[e,r]=t.resourceName.split("?");t.path=e&&e!=="/"?e:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}function Bc(t,e){if(!t.path)return t.error="URN can not be parsed",t;const r=t.path.match(zc);if(r){const s=e.scheme||t.scheme||"urn";t.nid=r[1].toLowerCase(),t.nss=r[2];const i=`${s}:${e.nid||t.nid}`,n=bs[i];t.path=void 0,n&&(t=n.parse(t,e))}else t.error=t.error||"URN can not be parsed.";return t}function Kc(t,e){const r=e.scheme||t.scheme||"urn",s=t.nid.toLowerCase(),i=`${r}:${e.nid||s}`,n=bs[i];n&&(t=n.serialize(t,e));const a=t,u=t.nss;return a.path=`${s||e.nid}:${u}`,e.skipEscape=!0,a}function Hc(t,e){const r=t;return r.uuid=r.nss,r.nss=void 0,!e.tolerant&&(!r.uuid||!Lc.test(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function Wc(t){const e=t;return e.nss=(t.uuid||"").toLowerCase(),e}const Xn={scheme:"http",domainHost:!0,parse:Hn,serialize:Wn},Xc={scheme:"https",domainHost:Xn.domainHost,parse:Hn,serialize:Wn},mr={scheme:"ws",domainHost:!0,parse:Vc,serialize:Jc},Qc={scheme:"wss",domainHost:mr.domainHost,parse:mr.parse,serialize:mr.serialize},bs={http:Xn,https:Xc,ws:mr,wss:Qc,urn:{scheme:"urn",parse:Bc,serialize:Kc,skipNormalize:!0},"urn:uuid":{scheme:"urn:uuid",parse:Hc,serialize:Wc,skipNormalize:!0}};var Yc=bs;const{normalizeIPv6:Zc,normalizeIPv4:el,removeDotSegments:Nt,recomposeAuthority:tl,normalizeComponentEncoding:pr}=Gc,Ss=Yc;function rl(t,e){return typeof t=="string"?t=Ae(Ue(t,e),e):typeof t=="object"&&(t=Ue(Ae(t,e),e)),t}function sl(t,e,r){const s=Object.assign({scheme:"null"},r),i=Qn(Ue(t,s),Ue(e,s),s,!0);return Ae(i,{...s,skipEscape:!0})}function Qn(t,e,r,s){const i={};return s||(t=Ue(Ae(t,r),r),e=Ue(Ae(e,r),r)),r=r||{},!r.tolerant&&e.scheme?(i.scheme=e.scheme,i.userinfo=e.userinfo,i.host=e.host,i.port=e.port,i.path=Nt(e.path||""),i.query=e.query):(e.userinfo!==void 0||e.host!==void 0||e.port!==void 0?(i.userinfo=e.userinfo,i.host=e.host,i.port=e.port,i.path=Nt(e.path||""),i.query=e.query):(e.path?(e.path.charAt(0)==="/"?i.path=Nt(e.path):((t.userinfo!==void 0||t.host!==void 0||t.port!==void 0)&&!t.path?i.path="/"+e.path:t.path?i.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:i.path=e.path,i.path=Nt(i.path)),i.query=e.query):(i.path=t.path,e.query!==void 0?i.query=e.query:i.query=t.query),i.userinfo=t.userinfo,i.host=t.host,i.port=t.port),i.scheme=t.scheme),i.fragment=e.fragment,i}function il(t,e,r){return typeof t=="string"?(t=unescape(t),t=Ae(pr(Ue(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=Ae(pr(t,!0),{...r,skipEscape:!0})),typeof e=="string"?(e=unescape(e),e=Ae(pr(Ue(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=Ae(pr(e,!0),{...r,skipEscape:!0})),t.toLowerCase()===e.toLowerCase()}function Ae(t,e){const r={host:t.host,scheme:t.scheme,userinfo:t.userinfo,port:t.port,path:t.path,query:t.query,nid:t.nid,nss:t.nss,uuid:t.uuid,fragment:t.fragment,reference:t.reference,resourceName:t.resourceName,secure:t.secure,error:""},s=Object.assign({},e),i=[],n=Ss[(s.scheme||r.scheme||"").toLowerCase()];n&&n.serialize&&n.serialize(r,s),r.path!==void 0&&(s.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),s.reference!=="suffix"&&r.scheme&&(i.push(r.scheme),i.push(":"));const a=tl(r,s);if(a!==void 0&&(s.reference!=="suffix"&&i.push("//"),i.push(a),r.path&&r.path.charAt(0)!=="/"&&i.push("/")),r.path!==void 0){let u=r.path;!s.absolutePath&&(!n||!n.absolutePath)&&(u=Nt(u)),a===void 0&&(u=u.replace(/^\/\//u,"/%2F")),i.push(u)}return r.query!==void 0&&(i.push("?"),i.push(r.query)),r.fragment!==void 0&&(i.push("#"),i.push(r.fragment)),i.join("")}const nl=Array.from({length:127},(t,e)=>/[^!"$&'()*+,\-.;=_`a-z{}~]/u.test(String.fromCharCode(e)));function ol(t){let e=0;for(let r=0,s=t.length;r<s;++r)if(e=t.charCodeAt(r),e>126||nl[e])return!0;return!1}const al=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function Ue(t,e){const r=Object.assign({},e),s={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},i=t.indexOf("%")!==-1;let n=!1;r.reference==="suffix"&&(t=(r.scheme?r.scheme+":":"")+"//"+t);const a=t.match(al);if(a){if(s.scheme=a[1],s.userinfo=a[3],s.host=a[4],s.port=parseInt(a[5],10),s.path=a[6]||"",s.query=a[7],s.fragment=a[8],isNaN(s.port)&&(s.port=a[5]),s.host){const o=el(s.host);if(o.isIPV4===!1){const c=Zc(o.host,{isIPV4:!1});s.host=c.host.toLowerCase(),n=c.isIPV6}else s.host=o.host,n=!0}s.scheme===void 0&&s.userinfo===void 0&&s.host===void 0&&s.port===void 0&&!s.path&&s.query===void 0?s.reference="same-document":s.scheme===void 0?s.reference="relative":s.fragment===void 0?s.reference="absolute":s.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==s.reference&&(s.error=s.error||"URI is not a "+r.reference+" reference.");const u=Ss[(r.scheme||s.scheme||"").toLowerCase()];if(!r.unicodeSupport&&(!u||!u.unicodeSupport)&&s.host&&(r.domainHost||u&&u.domainHost)&&n===!1&&ol(s.host))try{s.host=URL.domainToASCII(s.host.toLowerCase())}catch(o){s.error=s.error||"Host's domain name can not be converted to ASCII: "+o}(!u||u&&!u.skipNormalize)&&(i&&s.scheme!==void 0&&(s.scheme=unescape(s.scheme)),i&&s.userinfo!==void 0&&(s.userinfo=unescape(s.userinfo)),i&&s.host!==void 0&&(s.host=unescape(s.host)),s.path!==void 0&&s.path.length&&(s.path=escape(unescape(s.path))),s.fragment!==void 0&&s.fragment.length&&(s.fragment=encodeURI(decodeURIComponent(s.fragment)))),u&&u.parse&&u.parse(s,r)}else s.error=s.error||"URI can not be parsed.";return s}const Ps={SCHEMES:Ss,normalize:rl,resolve:sl,resolveComponents:Qn,equal:il,serialize:Ae,parse:Ue};fr.exports=Ps,fr.exports.default=Ps,fr.exports.fastUri=Ps;var ul=fr.exports;Object.defineProperty(vs,"__esModule",{value:!0});const Yn=ul;Yn.code='require("ajv/dist/runtime/uri").default',vs.default=Yn,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=void 0;var e=be;Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return e.KeywordCxt}});var r=V;Object.defineProperty(t,"_",{enumerable:!0,get:function(){return r._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return r.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return r.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return r.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return r.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return r.CodeGen}});const s=Ct,i=pt,n=We,a=pe,u=V,o=ue,c=ie,l=O,d=Cc,m=vs,g=(A,b)=>new RegExp(A,b);g.code="new RegExp";const _=["removeAdditional","useDefaults","coerceTypes"],w=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),y={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},f={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},v=200;function E(A){var b,T,S,h,p,P,M,j,X,K,ae,Tt,$i,Ri,Ai,Ii,Oi,Ci,Ni,Mi,Di,Ui,ji,xi,qi;const nr=A.strict,Fi=(b=A.code)===null||b===void 0?void 0:b.optimize,pa=Fi===!0||Fi===void 0?1:Fi||0,ga=(S=(T=A.code)===null||T===void 0?void 0:T.regExp)!==null&&S!==void 0?S:g,$m=(h=A.uriResolver)!==null&&h!==void 0?h:m.default;return{strictSchema:(P=(p=A.strictSchema)!==null&&p!==void 0?p:nr)!==null&&P!==void 0?P:!0,strictNumbers:(j=(M=A.strictNumbers)!==null&&M!==void 0?M:nr)!==null&&j!==void 0?j:!0,strictTypes:(K=(X=A.strictTypes)!==null&&X!==void 0?X:nr)!==null&&K!==void 0?K:"log",strictTuples:(Tt=(ae=A.strictTuples)!==null&&ae!==void 0?ae:nr)!==null&&Tt!==void 0?Tt:"log",strictRequired:(Ri=($i=A.strictRequired)!==null&&$i!==void 0?$i:nr)!==null&&Ri!==void 0?Ri:!1,code:A.code?{...A.code,optimize:pa,regExp:ga}:{optimize:pa,regExp:ga},loopRequired:(Ai=A.loopRequired)!==null&&Ai!==void 0?Ai:v,loopEnum:(Ii=A.loopEnum)!==null&&Ii!==void 0?Ii:v,meta:(Oi=A.meta)!==null&&Oi!==void 0?Oi:!0,messages:(Ci=A.messages)!==null&&Ci!==void 0?Ci:!0,inlineRefs:(Ni=A.inlineRefs)!==null&&Ni!==void 0?Ni:!0,schemaId:(Mi=A.schemaId)!==null&&Mi!==void 0?Mi:"$id",addUsedSchema:(Di=A.addUsedSchema)!==null&&Di!==void 0?Di:!0,validateSchema:(Ui=A.validateSchema)!==null&&Ui!==void 0?Ui:!0,validateFormats:(ji=A.validateFormats)!==null&&ji!==void 0?ji:!0,unicodeRegExp:(xi=A.unicodeRegExp)!==null&&xi!==void 0?xi:!0,int32range:(qi=A.int32range)!==null&&qi!==void 0?qi:!0,uriResolver:$m}}class ${constructor(b={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,b=this.opts={...b,...E(b)};const{es5:T,lines:S}=this.opts.code;this.scope=new u.ValueScope({scope:{},prefixes:w,es5:T,lines:S}),this.logger=D(b.logger);const h=b.validateFormats;b.validateFormats=!1,this.RULES=(0,n.getRules)(),I.call(this,y,b,"NOT SUPPORTED"),I.call(this,f,b,"DEPRECATED","warn"),this._metaOpts=W.call(this),b.formats&&B.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),b.keywords&&te.call(this,b.keywords),typeof b.meta=="object"&&this.addMetaSchema(b.meta),U.call(this),b.validateFormats=h}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:b,meta:T,schemaId:S}=this.opts;let h=d;S==="id"&&(h={...d},h.id=h.$id,delete h.$id),T&&b&&this.addMetaSchema(h,h[S],!1)}defaultMeta(){const{meta:b,schemaId:T}=this.opts;return this.opts.defaultMeta=typeof b=="object"?b[T]||b:void 0}validate(b,T){let S;if(typeof b=="string"){if(S=this.getSchema(b),!S)throw new Error(`no schema with key or ref "${b}"`)}else S=this.compile(b);const h=S(T);return"$async"in S||(this.errors=S.errors),h}compile(b,T){const S=this._addSchema(b,T);return S.validate||this._compileSchemaEnv(S)}compileAsync(b,T){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:S}=this.opts;return h.call(this,b,T);async function h(K,ae){await p.call(this,K.$schema);const Tt=this._addSchema(K,ae);return Tt.validate||P.call(this,Tt)}async function p(K){K&&!this.getSchema(K)&&await h.call(this,{$ref:K},!0)}async function P(K){try{return this._compileSchemaEnv(K)}catch(ae){if(!(ae instanceof i.default))throw ae;return M.call(this,ae),await j.call(this,ae.missingSchema),P.call(this,K)}}function M({missingSchema:K,missingRef:ae}){if(this.refs[K])throw new Error(`AnySchema ${K} is loaded but ${ae} cannot be resolved`)}async function j(K){const ae=await X.call(this,K);this.refs[K]||await p.call(this,ae.$schema),this.refs[K]||this.addSchema(ae,K,T)}async function X(K){const ae=this._loading[K];if(ae)return ae;try{return await(this._loading[K]=S(K))}finally{delete this._loading[K]}}}addSchema(b,T,S,h=this.opts.validateSchema){if(Array.isArray(b)){for(const P of b)this.addSchema(P,void 0,S,h);return this}let p;if(typeof b=="object"){const{schemaId:P}=this.opts;if(p=b[P],p!==void 0&&typeof p!="string")throw new Error(`schema ${P} must be string`)}return T=(0,o.normalizeId)(T||p),this._checkUnique(T),this.schemas[T]=this._addSchema(b,S,T,h,!0),this}addMetaSchema(b,T,S=this.opts.validateSchema){return this.addSchema(b,T,!0,S),this}validateSchema(b,T){if(typeof b=="boolean")return!0;let S;if(S=b.$schema,S!==void 0&&typeof S!="string")throw new Error("$schema must be a string");if(S=S||this.opts.defaultMeta||this.defaultMeta(),!S)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const h=this.validate(S,b);if(!h&&T){const p="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(p);else throw new Error(p)}return h}getSchema(b){let T;for(;typeof(T=L.call(this,b))=="string";)b=T;if(T===void 0){const{schemaId:S}=this.opts,h=new a.SchemaEnv({schema:{},schemaId:S});if(T=a.resolveSchema.call(this,h,b),!T)return;this.refs[b]=T}return T.validate||this._compileSchemaEnv(T)}removeSchema(b){if(b instanceof RegExp)return this._removeAllSchemas(this.schemas,b),this._removeAllSchemas(this.refs,b),this;switch(typeof b){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const T=L.call(this,b);return typeof T=="object"&&this._cache.delete(T.schema),delete this.schemas[b],delete this.refs[b],this}case"object":{const T=b;this._cache.delete(T);let S=b[this.opts.schemaId];return S&&(S=(0,o.normalizeId)(S),delete this.schemas[S],delete this.refs[S]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(b){for(const T of b)this.addKeyword(T);return this}addKeyword(b,T){let S;if(typeof b=="string")S=b,typeof T=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),T.keyword=S);else if(typeof b=="object"&&T===void 0){if(T=b,S=T.keyword,Array.isArray(S)&&!S.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(x.call(this,S,T),!T)return(0,l.eachItem)(S,p=>H.call(this,p)),this;Fe.call(this,T);const h={...T,type:(0,c.getJSONTypes)(T.type),schemaType:(0,c.getJSONTypes)(T.schemaType)};return(0,l.eachItem)(S,h.type.length===0?p=>H.call(this,p,h):p=>h.type.forEach(P=>H.call(this,p,h,P))),this}getKeyword(b){const T=this.RULES.all[b];return typeof T=="object"?T.definition:!!T}removeKeyword(b){const{RULES:T}=this;delete T.keywords[b],delete T.all[b];for(const S of T.rules){const h=S.rules.findIndex(p=>p.keyword===b);h>=0&&S.rules.splice(h,1)}return this}addFormat(b,T){return typeof T=="string"&&(T=new RegExp(T)),this.formats[b]=T,this}errorsText(b=this.errors,{separator:T=", ",dataVar:S="data"}={}){return!b||b.length===0?"No errors":b.map(h=>`${S}${h.instancePath} ${h.message}`).reduce((h,p)=>h+T+p)}$dataMetaSchema(b,T){const S=this.RULES.all;b=JSON.parse(JSON.stringify(b));for(const h of T){const p=h.split("/").slice(1);let P=b;for(const M of p)P=P[M];for(const M in S){const j=S[M];if(typeof j!="object")continue;const{$data:X}=j.definition,K=P[M];X&&K&&(P[M]=at(K))}}return b}_removeAllSchemas(b,T){for(const S in b){const h=b[S];(!T||T.test(S))&&(typeof h=="string"?delete b[S]:h&&!h.meta&&(this._cache.delete(h.schema),delete b[S]))}}_addSchema(b,T,S,h=this.opts.validateSchema,p=this.opts.addUsedSchema){let P;const{schemaId:M}=this.opts;if(typeof b=="object")P=b[M];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof b!="boolean")throw new Error("schema must be object or boolean")}let j=this._cache.get(b);if(j!==void 0)return j;S=(0,o.normalizeId)(P||S);const X=o.getSchemaRefs.call(this,b,S);return j=new a.SchemaEnv({schema:b,schemaId:M,meta:T,baseId:S,localRefs:X}),this._cache.set(j.schema,j),p&&!S.startsWith("#")&&(S&&this._checkUnique(S),this.refs[S]=j),h&&this.validateSchema(b,!0),j}_checkUnique(b){if(this.schemas[b]||this.refs[b])throw new Error(`schema with key or id "${b}" already exists`)}_compileSchemaEnv(b){if(b.meta?this._compileMetaSchema(b):a.compileSchema.call(this,b),!b.validate)throw new Error("ajv implementation error");return b.validate}_compileMetaSchema(b){const T=this.opts;this.opts=this._metaOpts;try{a.compileSchema.call(this,b)}finally{this.opts=T}}}$.ValidationError=s.default,$.MissingRefError=i.default,t.default=$;function I(A,b,T,S="error"){for(const h in A){const p=h;p in b&&this.logger[S](`${T}: option ${h}. ${A[p]}`)}}function L(A){return A=(0,o.normalizeId)(A),this.schemas[A]||this.refs[A]}function U(){const A=this.opts.schemas;if(A)if(Array.isArray(A))this.addSchema(A);else for(const b in A)this.addSchema(A[b],b)}function B(){for(const A in this.opts.formats){const b=this.opts.formats[A];b&&this.addFormat(A,b)}}function te(A){if(Array.isArray(A)){this.addVocabulary(A);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const b in A){const T=A[b];T.keyword||(T.keyword=b),this.addKeyword(T)}}function W(){const A={...this.opts};for(const b of _)delete A[b];return A}const C={log(){},warn(){},error(){}};function D(A){if(A===!1)return C;if(A===void 0)return console;if(A.log&&A.warn&&A.error)return A;throw new Error("logger must implement log, warn and error methods")}const F=/^[a-z_$][a-z0-9_$:-]*$/i;function x(A,b){const{RULES:T}=this;if((0,l.eachItem)(A,S=>{if(T.keywords[S])throw new Error(`Keyword ${S} is already defined`);if(!F.test(S))throw new Error(`Keyword ${S} has invalid name`)}),!!b&&b.$data&&!("code"in b||"validate"in b))throw new Error('$data keyword must have "code" or "validate" function')}function H(A,b,T){var S;const h=b==null?void 0:b.post;if(T&&h)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:p}=this;let P=h?p.post:p.rules.find(({type:j})=>j===T);if(P||(P={type:T,rules:[]},p.rules.push(P)),p.keywords[A]=!0,!b)return;const M={keyword:A,definition:{...b,type:(0,c.getJSONTypes)(b.type),schemaType:(0,c.getJSONTypes)(b.schemaType)}};b.before?qe.call(this,P,M,b.before):P.rules.push(M),p.all[A]=M,(S=b.implements)===null||S===void 0||S.forEach(j=>this.addKeyword(j))}function qe(A,b,T){const S=A.rules.findIndex(h=>h.keyword===T);S>=0?A.rules.splice(S,0,b):(A.rules.push(b),this.logger.warn(`rule ${T} is not defined`))}function Fe(A){let{metaSchema:b}=A;b!==void 0&&(A.$data&&this.opts.$data&&(b=at(b)),A.validateSchema=this.compile(b,!0))}const ir={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function at(A){return{anyOf:[A,ir]}}}(Yi);var Es={},Ts={},ks={};Object.defineProperty(ks,"__esModule",{value:!0});const cl={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};ks.default=cl;var Ye={};Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.callRef=Ye.getValidate=void 0;const ll=pt,Zn=J,ge=V,gt=ke,eo=pe,gr=O,dl={keyword:"$ref",schemaType:"string",code(t){const{gen:e,schema:r,it:s}=t,{baseId:i,schemaEnv:n,validateName:a,opts:u,self:o}=s,{root:c}=n;if((r==="#"||r==="#/")&&i===c.baseId)return d();const l=eo.resolveRef.call(o,c,i,r);if(l===void 0)throw new ll.default(s.opts.uriResolver,i,r);if(l instanceof eo.SchemaEnv)return m(l);return g(l);function d(){if(n===c)return yr(t,a,n,n.$async);const _=e.scopeValue("root",{ref:c});return yr(t,(0,ge._)`${_}.validate`,c,c.$async)}function m(_){const w=to(t,_);yr(t,w,_,_.$async)}function g(_){const w=e.scopeValue("schema",u.code.source===!0?{ref:_,code:(0,ge.stringify)(_)}:{ref:_}),y=e.name("valid"),f=t.subschema({schema:_,dataTypes:[],schemaPath:ge.nil,topSchemaRef:w,errSchemaPath:r},y);t.mergeEvaluated(f),t.ok(y)}}};function to(t,e){const{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,ge._)`${r.scopeValue("wrapper",{ref:e})}.validate`}Ye.getValidate=to;function yr(t,e,r,s){const{gen:i,it:n}=t,{allErrors:a,schemaEnv:u,opts:o}=n,c=o.passContext?gt.default.this:ge.nil;s?l():d();function l(){if(!u.$async)throw new Error("async schema referenced by sync schema");const _=i.let("valid");i.try(()=>{i.code((0,ge._)`await ${(0,Zn.callValidateCode)(t,e,c)}`),g(e),a||i.assign(_,!0)},w=>{i.if((0,ge._)`!(${w} instanceof ${n.ValidationError})`,()=>i.throw(w)),m(w),a||i.assign(_,!1)}),t.ok(_)}function d(){t.result((0,Zn.callValidateCode)(t,e,c),()=>g(e),()=>m(e))}function m(_){const w=(0,ge._)`${_}.errors`;i.assign(gt.default.vErrors,(0,ge._)`${gt.default.vErrors} === null ? ${w} : ${gt.default.vErrors}.concat(${w})`),i.assign(gt.default.errors,(0,ge._)`${gt.default.vErrors}.length`)}function g(_){var w;if(!n.opts.unevaluated)return;const y=(w=r==null?void 0:r.validate)===null||w===void 0?void 0:w.evaluated;if(n.props!==!0)if(y&&!y.dynamicProps)y.props!==void 0&&(n.props=gr.mergeEvaluated.props(i,y.props,n.props));else{const f=i.var("props",(0,ge._)`${_}.evaluated.props`);n.props=gr.mergeEvaluated.props(i,f,n.props,ge.Name)}if(n.items!==!0)if(y&&!y.dynamicItems)y.items!==void 0&&(n.items=gr.mergeEvaluated.items(i,y.items,n.items));else{const f=i.var("items",(0,ge._)`${_}.evaluated.items`);n.items=gr.mergeEvaluated.items(i,f,n.items,ge.Name)}}}Ye.callRef=yr,Ye.default=dl,Object.defineProperty(Ts,"__esModule",{value:!0});const hl=ks,fl=Ye,ml=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",hl.default,fl.default];Ts.default=ml;var $s={},Rs={};Object.defineProperty(Rs,"__esModule",{value:!0});const _r=V,Je=_r.operators,vr={maximum:{okStr:"<=",ok:Je.LTE,fail:Je.GT},minimum:{okStr:">=",ok:Je.GTE,fail:Je.LT},exclusiveMaximum:{okStr:"<",ok:Je.LT,fail:Je.GTE},exclusiveMinimum:{okStr:">",ok:Je.GT,fail:Je.LTE}},pl={message:({keyword:t,schemaCode:e})=>(0,_r.str)`must be ${vr[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,_r._)`{comparison: ${vr[t].okStr}, limit: ${e}}`},gl={keyword:Object.keys(vr),type:"number",schemaType:"number",$data:!0,error:pl,code(t){const{keyword:e,data:r,schemaCode:s}=t;t.fail$data((0,_r._)`${r} ${vr[e].fail} ${s} || isNaN(${r})`)}};Rs.default=gl;var As={};Object.defineProperty(As,"__esModule",{value:!0});const Mt=V,yl={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:{message:({schemaCode:t})=>(0,Mt.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,Mt._)`{multipleOf: ${t}}`},code(t){const{gen:e,data:r,schemaCode:s,it:i}=t,n=i.opts.multipleOfPrecision,a=e.let("res"),u=n?(0,Mt._)`Math.abs(Math.round(${a}) - ${a}) > 1e-${n}`:(0,Mt._)`${a} !== parseInt(${a})`;t.fail$data((0,Mt._)`(${s} === 0 || (${a} = ${r}/${s}, ${u}))`)}};As.default=yl;var Is={},Os={};Object.defineProperty(Os,"__esModule",{value:!0});function ro(t){const e=t.length;let r=0,s=0,i;for(;s<e;)r++,i=t.charCodeAt(s++),i>=55296&&i<=56319&&s<e&&(i=t.charCodeAt(s),(i&64512)===56320&&s++);return r}Os.default=ro,ro.code='require("ajv/dist/runtime/ucs2length").default',Object.defineProperty(Is,"__esModule",{value:!0});const Ze=V,_l=O,vl=Os,wl={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:{message({keyword:t,schemaCode:e}){const r=t==="maxLength"?"more":"fewer";return(0,Ze.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,Ze._)`{limit: ${t}}`},code(t){const{keyword:e,data:r,schemaCode:s,it:i}=t,n=e==="maxLength"?Ze.operators.GT:Ze.operators.LT,a=i.opts.unicode===!1?(0,Ze._)`${r}.length`:(0,Ze._)`${(0,_l.useFunc)(t.gen,vl.default)}(${r})`;t.fail$data((0,Ze._)`${a} ${n} ${s}`)}};Is.default=wl;var Cs={};Object.defineProperty(Cs,"__esModule",{value:!0});const bl=J,wr=V,Sl={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:{message:({schemaCode:t})=>(0,wr.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,wr._)`{pattern: ${t}}`},code(t){const{data:e,$data:r,schema:s,schemaCode:i,it:n}=t,a=n.opts.unicodeRegExp?"u":"",u=r?(0,wr._)`(new RegExp(${i}, ${a}))`:(0,bl.usePattern)(t,s);t.fail$data((0,wr._)`!${u}.test(${e})`)}};Cs.default=Sl;var Ns={};Object.defineProperty(Ns,"__esModule",{value:!0});const Dt=V,Pl={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:{message({keyword:t,schemaCode:e}){const r=t==="maxProperties"?"more":"fewer";return(0,Dt.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,Dt._)`{limit: ${t}}`},code(t){const{keyword:e,data:r,schemaCode:s}=t,i=e==="maxProperties"?Dt.operators.GT:Dt.operators.LT;t.fail$data((0,Dt._)`Object.keys(${r}).length ${i} ${s}`)}};Ns.default=Pl;var Ms={};Object.defineProperty(Ms,"__esModule",{value:!0});const Ut=J,jt=V,El=O,Tl={keyword:"required",type:"object",schemaType:"array",$data:!0,error:{message:({params:{missingProperty:t}})=>(0,jt.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,jt._)`{missingProperty: ${t}}`},code(t){const{gen:e,schema:r,schemaCode:s,data:i,$data:n,it:a}=t,{opts:u}=a;if(!n&&r.length===0)return;const o=r.length>=u.loopRequired;if(a.allErrors?c():l(),u.strictRequired){const g=t.parentSchema.properties,{definedProperties:_}=t.it;for(const w of r)if((g==null?void 0:g[w])===void 0&&!_.has(w)){const y=a.schemaEnv.baseId+a.errSchemaPath,f=`required property "${w}" is not defined at "${y}" (strictRequired)`;(0,El.checkStrictMode)(a,f,a.opts.strictRequired)}}function c(){if(o||n)t.block$data(jt.nil,d);else for(const g of r)(0,Ut.checkReportMissingProp)(t,g)}function l(){const g=e.let("missing");if(o||n){const _=e.let("valid",!0);t.block$data(_,()=>m(g,_)),t.ok(_)}else e.if((0,Ut.checkMissingProp)(t,r,g)),(0,Ut.reportMissingProp)(t,g),e.else()}function d(){e.forOf("prop",s,g=>{t.setParams({missingProperty:g}),e.if((0,Ut.noPropertyInData)(e,i,g,u.ownProperties),()=>t.error())})}function m(g,_){t.setParams({missingProperty:g}),e.forOf(g,s,()=>{e.assign(_,(0,Ut.propertyInData)(e,i,g,u.ownProperties)),e.if((0,jt.not)(_),()=>{t.error(),e.break()})},jt.nil)}}};Ms.default=Tl;var Ds={};Object.defineProperty(Ds,"__esModule",{value:!0});const xt=V,kl={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:{message({keyword:t,schemaCode:e}){const r=t==="maxItems"?"more":"fewer";return(0,xt.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,xt._)`{limit: ${t}}`},code(t){const{keyword:e,data:r,schemaCode:s}=t,i=e==="maxItems"?xt.operators.GT:xt.operators.LT;t.fail$data((0,xt._)`${r}.length ${i} ${s}`)}};Ds.default=kl;var Us={},qt={};Object.defineProperty(qt,"__esModule",{value:!0});const so=vn;so.code='require("ajv/dist/runtime/equal").default',qt.default=so,Object.defineProperty(Us,"__esModule",{value:!0});const js=ie,ce=V,$l=O,Rl=qt,Al={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:{message:({params:{i:t,j:e}})=>(0,ce.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,ce._)`{i: ${t}, j: ${e}}`},code(t){const{gen:e,data:r,$data:s,schema:i,parentSchema:n,schemaCode:a,it:u}=t;if(!s&&!i)return;const o=e.let("valid"),c=n.items?(0,js.getSchemaTypes)(n.items):[];t.block$data(o,l,(0,ce._)`${a} === false`),t.ok(o);function l(){const _=e.let("i",(0,ce._)`${r}.length`),w=e.let("j");t.setParams({i:_,j:w}),e.assign(o,!0),e.if((0,ce._)`${_} > 1`,()=>(d()?m:g)(_,w))}function d(){return c.length>0&&!c.some(_=>_==="object"||_==="array")}function m(_,w){const y=e.name("item"),f=(0,js.checkDataTypes)(c,y,u.opts.strictNumbers,js.DataType.Wrong),v=e.const("indices",(0,ce._)`{}`);e.for((0,ce._)`;${_}--;`,()=>{e.let(y,(0,ce._)`${r}[${_}]`),e.if(f,(0,ce._)`continue`),c.length>1&&e.if((0,ce._)`typeof ${y} == "string"`,(0,ce._)`${y} += "_"`),e.if((0,ce._)`typeof ${v}[${y}] == "number"`,()=>{e.assign(w,(0,ce._)`${v}[${y}]`),t.error(),e.assign(o,!1).break()}).code((0,ce._)`${v}[${y}] = ${_}`)})}function g(_,w){const y=(0,$l.useFunc)(e,Rl.default),f=e.name("outer");e.label(f).for((0,ce._)`;${_}--;`,()=>e.for((0,ce._)`${w} = ${_}; ${w}--;`,()=>e.if((0,ce._)`${y}(${r}[${_}], ${r}[${w}])`,()=>{t.error(),e.assign(o,!1).break(f)})))}}};Us.default=Al;var xs={};Object.defineProperty(xs,"__esModule",{value:!0});const qs=V,Il=O,Ol=qt,Cl={keyword:"const",$data:!0,error:{message:"must be equal to constant",params:({schemaCode:t})=>(0,qs._)`{allowedValue: ${t}}`},code(t){const{gen:e,data:r,$data:s,schemaCode:i,schema:n}=t;s||n&&typeof n=="object"?t.fail$data((0,qs._)`!${(0,Il.useFunc)(e,Ol.default)}(${r}, ${i})`):t.fail((0,qs._)`${n} !== ${r}`)}};xs.default=Cl;var Fs={};Object.defineProperty(Fs,"__esModule",{value:!0});const Ft=V,Nl=O,Ml=qt,Dl={keyword:"enum",schemaType:"array",$data:!0,error:{message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,Ft._)`{allowedValues: ${t}}`},code(t){const{gen:e,data:r,$data:s,schema:i,schemaCode:n,it:a}=t;if(!s&&i.length===0)throw new Error("enum must have non-empty array");const u=i.length>=a.opts.loopEnum;let o;const c=()=>o??(o=(0,Nl.useFunc)(e,Ml.default));let l;if(u||s)l=e.let("valid"),t.block$data(l,d);else{if(!Array.isArray(i))throw new Error("ajv implementation error");const g=e.const("vSchema",n);l=(0,Ft.or)(...i.map((_,w)=>m(g,w)))}t.pass(l);function d(){e.assign(l,!1),e.forOf("v",n,g=>e.if((0,Ft._)`${c()}(${r}, ${g})`,()=>e.assign(l,!0).break()))}function m(g,_){const w=i[_];return typeof w=="object"&&w!==null?(0,Ft._)`${c()}(${r}, ${g}[${_}])`:(0,Ft._)`${r} === ${w}`}}};Fs.default=Dl,Object.defineProperty($s,"__esModule",{value:!0});const Ul=Rs,jl=As,xl=Is,ql=Cs,Fl=Ns,Gl=Ms,Ll=Ds,zl=Us,Vl=xs,Jl=Fs,Bl=[Ul.default,jl.default,xl.default,ql.default,Fl.default,Gl.default,Ll.default,zl.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},Vl.default,Jl.default];$s.default=Bl;var Gs={},yt={};Object.defineProperty(yt,"__esModule",{value:!0}),yt.validateAdditionalItems=void 0;const et=V,Ls=O,Kl={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:{message:({params:{len:t}})=>(0,et.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,et._)`{limit: ${t}}`},code(t){const{parentSchema:e,it:r}=t,{items:s}=e;if(!Array.isArray(s)){(0,Ls.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}io(t,s)}};function io(t,e){const{gen:r,schema:s,data:i,keyword:n,it:a}=t;a.items=!0;const u=r.const("len",(0,et._)`${i}.length`);if(s===!1)t.setParams({len:e.length}),t.pass((0,et._)`${u} <= ${e.length}`);else if(typeof s=="object"&&!(0,Ls.alwaysValidSchema)(a,s)){const c=r.var("valid",(0,et._)`${u} <= ${e.length}`);r.if((0,et.not)(c),()=>o(c)),t.ok(c)}function o(c){r.forRange("i",e.length,u,l=>{t.subschema({keyword:n,dataProp:l,dataPropType:Ls.Type.Num},c),a.allErrors||r.if((0,et.not)(c),()=>r.break())})}}yt.validateAdditionalItems=io,yt.default=Kl;var zs={},_t={};Object.defineProperty(_t,"__esModule",{value:!0}),_t.validateTuple=void 0;const no=V,br=O,Hl=J,Wl={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){const{schema:e,it:r}=t;if(Array.isArray(e))return oo(t,"additionalItems",e);r.items=!0,!(0,br.alwaysValidSchema)(r,e)&&t.ok((0,Hl.validateArray)(t))}};function oo(t,e,r=t.schema){const{gen:s,parentSchema:i,data:n,keyword:a,it:u}=t;l(i),u.opts.unevaluated&&r.length&&u.items!==!0&&(u.items=br.mergeEvaluated.items(s,r.length,u.items));const o=s.name("valid"),c=s.const("len",(0,no._)`${n}.length`);r.forEach((d,m)=>{(0,br.alwaysValidSchema)(u,d)||(s.if((0,no._)`${c} > ${m}`,()=>t.subschema({keyword:a,schemaProp:m,dataProp:m},o)),t.ok(o))});function l(d){const{opts:m,errSchemaPath:g}=u,_=r.length,w=_===d.minItems&&(_===d.maxItems||d[e]===!1);if(m.strictTuples&&!w){const y=`"${a}" is ${_}-tuple, but minItems or maxItems/${e} are not specified or different at path "${g}"`;(0,br.checkStrictMode)(u,y,m.strictTuples)}}}_t.validateTuple=oo,_t.default=Wl,Object.defineProperty(zs,"__esModule",{value:!0});const Xl=_t,Ql={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,Xl.validateTuple)(t,"items")};zs.default=Ql;var Vs={};Object.defineProperty(Vs,"__esModule",{value:!0});const ao=V,Yl=O,Zl=J,ed=yt,td={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:{message:({params:{len:t}})=>(0,ao.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,ao._)`{limit: ${t}}`},code(t){const{schema:e,parentSchema:r,it:s}=t,{prefixItems:i}=r;s.items=!0,!(0,Yl.alwaysValidSchema)(s,e)&&(i?(0,ed.validateAdditionalItems)(t,i):t.ok((0,Zl.validateArray)(t)))}};Vs.default=td;var Js={};Object.defineProperty(Js,"__esModule",{value:!0});const ve=V,Sr=O,rd={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:{message:({params:{min:t,max:e}})=>e===void 0?(0,ve.str)`must contain at least ${t} valid item(s)`:(0,ve.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,ve._)`{minContains: ${t}}`:(0,ve._)`{minContains: ${t}, maxContains: ${e}}`},code(t){const{gen:e,schema:r,parentSchema:s,data:i,it:n}=t;let a,u;const{minContains:o,maxContains:c}=s;n.opts.next?(a=o===void 0?1:o,u=c):a=1;const l=e.const("len",(0,ve._)`${i}.length`);if(t.setParams({min:a,max:u}),u===void 0&&a===0){(0,Sr.checkStrictMode)(n,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(u!==void 0&&a>u){(0,Sr.checkStrictMode)(n,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,Sr.alwaysValidSchema)(n,r)){let w=(0,ve._)`${l} >= ${a}`;u!==void 0&&(w=(0,ve._)`${w} && ${l} <= ${u}`),t.pass(w);return}n.items=!0;const d=e.name("valid");u===void 0&&a===1?g(d,()=>e.if(d,()=>e.break())):a===0?(e.let(d,!0),u!==void 0&&e.if((0,ve._)`${i}.length > 0`,m)):(e.let(d,!1),m()),t.result(d,()=>t.reset());function m(){const w=e.name("_valid"),y=e.let("count",0);g(w,()=>e.if(w,()=>_(y)))}function g(w,y){e.forRange("i",0,l,f=>{t.subschema({keyword:"contains",dataProp:f,dataPropType:Sr.Type.Num,compositeRule:!0},w),y()})}function _(w){e.code((0,ve._)`${w}++`),u===void 0?e.if((0,ve._)`${w} >= ${a}`,()=>e.assign(d,!0).break()):(e.if((0,ve._)`${w} > ${u}`,()=>e.assign(d,!1).break()),a===1?e.assign(d,!0):e.if((0,ve._)`${w} >= ${a}`,()=>e.assign(d,!0)))}}};Js.default=rd;var uo={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateSchemaDeps=t.validatePropertyDeps=t.error=void 0;const e=V,r=O,s=J;t.error={message:({params:{property:o,depsCount:c,deps:l}})=>{const d=c===1?"property":"properties";return(0,e.str)`must have ${d} ${l} when property ${o} is present`},params:({params:{property:o,depsCount:c,deps:l,missingProperty:d}})=>(0,e._)`{property: ${o},
    missingProperty: ${d},
    depsCount: ${c},
    deps: ${l}}`};const i={keyword:"dependencies",type:"object",schemaType:"object",error:t.error,code(o){const[c,l]=n(o);a(o,c),u(o,l)}};function n({schema:o}){const c={},l={};for(const d in o){if(d==="__proto__")continue;const m=Array.isArray(o[d])?c:l;m[d]=o[d]}return[c,l]}function a(o,c=o.schema){const{gen:l,data:d,it:m}=o;if(Object.keys(c).length===0)return;const g=l.let("missing");for(const _ in c){const w=c[_];if(w.length===0)continue;const y=(0,s.propertyInData)(l,d,_,m.opts.ownProperties);o.setParams({property:_,depsCount:w.length,deps:w.join(", ")}),m.allErrors?l.if(y,()=>{for(const f of w)(0,s.checkReportMissingProp)(o,f)}):(l.if((0,e._)`${y} && (${(0,s.checkMissingProp)(o,w,g)})`),(0,s.reportMissingProp)(o,g),l.else())}}t.validatePropertyDeps=a;function u(o,c=o.schema){const{gen:l,data:d,keyword:m,it:g}=o,_=l.name("valid");for(const w in c)(0,r.alwaysValidSchema)(g,c[w])||(l.if((0,s.propertyInData)(l,d,w,g.opts.ownProperties),()=>{const y=o.subschema({keyword:m,schemaProp:w},_);o.mergeValidEvaluated(y,_)},()=>l.var(_,!0)),o.ok(_))}t.validateSchemaDeps=u,t.default=i})(uo);var Bs={};Object.defineProperty(Bs,"__esModule",{value:!0});const co=V,sd=O,id={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:{message:"property name must be valid",params:({params:t})=>(0,co._)`{propertyName: ${t.propertyName}}`},code(t){const{gen:e,schema:r,data:s,it:i}=t;if((0,sd.alwaysValidSchema)(i,r))return;const n=e.name("valid");e.forIn("key",s,a=>{t.setParams({propertyName:a}),t.subschema({keyword:"propertyNames",data:a,dataTypes:["string"],propertyName:a,compositeRule:!0},n),e.if((0,co.not)(n),()=>{t.error(!0),i.allErrors||e.break()})}),t.ok(n)}};Bs.default=id;var Pr={};Object.defineProperty(Pr,"__esModule",{value:!0});const Er=J,Ee=V,nd=ke,Tr=O,od={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:{message:"must NOT have additional properties",params:({params:t})=>(0,Ee._)`{additionalProperty: ${t.additionalProperty}}`},code(t){const{gen:e,schema:r,parentSchema:s,data:i,errsCount:n,it:a}=t;if(!n)throw new Error("ajv implementation error");const{allErrors:u,opts:o}=a;if(a.props=!0,o.removeAdditional!=="all"&&(0,Tr.alwaysValidSchema)(a,r))return;const c=(0,Er.allSchemaProperties)(s.properties),l=(0,Er.allSchemaProperties)(s.patternProperties);d(),t.ok((0,Ee._)`${n} === ${nd.default.errors}`);function d(){e.forIn("key",i,y=>{!c.length&&!l.length?_(y):e.if(m(y),()=>_(y))})}function m(y){let f;if(c.length>8){const v=(0,Tr.schemaRefOrVal)(a,s.properties,"properties");f=(0,Er.isOwnProperty)(e,v,y)}else c.length?f=(0,Ee.or)(...c.map(v=>(0,Ee._)`${y} === ${v}`)):f=Ee.nil;return l.length&&(f=(0,Ee.or)(f,...l.map(v=>(0,Ee._)`${(0,Er.usePattern)(t,v)}.test(${y})`))),(0,Ee.not)(f)}function g(y){e.code((0,Ee._)`delete ${i}[${y}]`)}function _(y){if(o.removeAdditional==="all"||o.removeAdditional&&r===!1){g(y);return}if(r===!1){t.setParams({additionalProperty:y}),t.error(),u||e.break();return}if(typeof r=="object"&&!(0,Tr.alwaysValidSchema)(a,r)){const f=e.name("valid");o.removeAdditional==="failing"?(w(y,f,!1),e.if((0,Ee.not)(f),()=>{t.reset(),g(y)})):(w(y,f),u||e.if((0,Ee.not)(f),()=>e.break()))}}function w(y,f,v){const E={keyword:"additionalProperties",dataProp:y,dataPropType:Tr.Type.Str};v===!1&&Object.assign(E,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(E,f)}}};Pr.default=od;var Ks={};Object.defineProperty(Ks,"__esModule",{value:!0});const ad=be,lo=J,Hs=O,ho=Pr,ud={keyword:"properties",type:"object",schemaType:"object",code(t){const{gen:e,schema:r,parentSchema:s,data:i,it:n}=t;n.opts.removeAdditional==="all"&&s.additionalProperties===void 0&&ho.default.code(new ad.KeywordCxt(n,ho.default,"additionalProperties"));const a=(0,lo.allSchemaProperties)(r);for(const d of a)n.definedProperties.add(d);n.opts.unevaluated&&a.length&&n.props!==!0&&(n.props=Hs.mergeEvaluated.props(e,(0,Hs.toHash)(a),n.props));const u=a.filter(d=>!(0,Hs.alwaysValidSchema)(n,r[d]));if(u.length===0)return;const o=e.name("valid");for(const d of u)c(d)?l(d):(e.if((0,lo.propertyInData)(e,i,d,n.opts.ownProperties)),l(d),n.allErrors||e.else().var(o,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(o);function c(d){return n.opts.useDefaults&&!n.compositeRule&&r[d].default!==void 0}function l(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},o)}}};Ks.default=ud;var Ws={};Object.defineProperty(Ws,"__esModule",{value:!0});const fo=J,kr=V,mo=O,po=O,cd={keyword:"patternProperties",type:"object",schemaType:"object",code(t){const{gen:e,schema:r,data:s,parentSchema:i,it:n}=t,{opts:a}=n,u=(0,fo.allSchemaProperties)(r),o=u.filter(w=>(0,mo.alwaysValidSchema)(n,r[w]));if(u.length===0||o.length===u.length&&(!n.opts.unevaluated||n.props===!0))return;const c=a.strictSchema&&!a.allowMatchingProperties&&i.properties,l=e.name("valid");n.props!==!0&&!(n.props instanceof kr.Name)&&(n.props=(0,po.evaluatedPropsToName)(e,n.props));const{props:d}=n;m();function m(){for(const w of u)c&&g(w),n.allErrors?_(w):(e.var(l,!0),_(w),e.if(l))}function g(w){for(const y in c)new RegExp(w).test(y)&&(0,mo.checkStrictMode)(n,`property ${y} matches pattern ${w} (use allowMatchingProperties)`)}function _(w){e.forIn("key",s,y=>{e.if((0,kr._)`${(0,fo.usePattern)(t,w)}.test(${y})`,()=>{const f=o.includes(w);f||t.subschema({keyword:"patternProperties",schemaProp:w,dataProp:y,dataPropType:po.Type.Str},l),n.opts.unevaluated&&d!==!0?e.assign((0,kr._)`${d}[${y}]`,!0):!f&&!n.allErrors&&e.if((0,kr.not)(l),()=>e.break())})})}}};Ws.default=cd;var Xs={};Object.defineProperty(Xs,"__esModule",{value:!0});const ld=O,dd={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){const{gen:e,schema:r,it:s}=t;if((0,ld.alwaysValidSchema)(s,r)){t.fail();return}const i=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},i),t.failResult(i,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};Xs.default=dd;var Qs={};Object.defineProperty(Qs,"__esModule",{value:!0});const hd={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:J.validateUnion,error:{message:"must match a schema in anyOf"}};Qs.default=hd;var Ys={};Object.defineProperty(Ys,"__esModule",{value:!0});const $r=V,fd=O,md={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:{message:"must match exactly one schema in oneOf",params:({params:t})=>(0,$r._)`{passingSchemas: ${t.passing}}`},code(t){const{gen:e,schema:r,parentSchema:s,it:i}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(i.opts.discriminator&&s.discriminator)return;const n=r,a=e.let("valid",!1),u=e.let("passing",null),o=e.name("_valid");t.setParams({passing:u}),e.block(c),t.result(a,()=>t.reset(),()=>t.error(!0));function c(){n.forEach((l,d)=>{let m;(0,fd.alwaysValidSchema)(i,l)?e.var(o,!0):m=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},o),d>0&&e.if((0,$r._)`${o} && ${a}`).assign(a,!1).assign(u,(0,$r._)`[${u}, ${d}]`).else(),e.if(o,()=>{e.assign(a,!0),e.assign(u,d),m&&t.mergeEvaluated(m,$r.Name)})})}}};Ys.default=md;var Zs={};Object.defineProperty(Zs,"__esModule",{value:!0});const pd=O,gd={keyword:"allOf",schemaType:"array",code(t){const{gen:e,schema:r,it:s}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");const i=e.name("valid");r.forEach((n,a)=>{if((0,pd.alwaysValidSchema)(s,n))return;const u=t.subschema({keyword:"allOf",schemaProp:a},i);t.ok(i),t.mergeEvaluated(u)})}};Zs.default=gd;var ei={};Object.defineProperty(ei,"__esModule",{value:!0});const Rr=V,go=O,yd={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:{message:({params:t})=>(0,Rr.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,Rr._)`{failingKeyword: ${t.ifClause}}`},code(t){const{gen:e,parentSchema:r,it:s}=t;r.then===void 0&&r.else===void 0&&(0,go.checkStrictMode)(s,'"if" without "then" and "else" is ignored');const i=yo(s,"then"),n=yo(s,"else");if(!i&&!n)return;const a=e.let("valid",!0),u=e.name("_valid");if(o(),t.reset(),i&&n){const l=e.let("ifClause");t.setParams({ifClause:l}),e.if(u,c("then",l),c("else",l))}else i?e.if(u,c("then")):e.if((0,Rr.not)(u),c("else"));t.pass(a,()=>t.error(!0));function o(){const l=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},u);t.mergeEvaluated(l)}function c(l,d){return()=>{const m=t.subschema({keyword:l},u);e.assign(a,u),t.mergeValidEvaluated(m,a),d?e.assign(d,(0,Rr._)`${l}`):t.setParams({ifClause:l})}}}};function yo(t,e){const r=t.schema[e];return r!==void 0&&!(0,go.alwaysValidSchema)(t,r)}ei.default=yd;var ti={};Object.defineProperty(ti,"__esModule",{value:!0});const _d=O,vd={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,_d.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};ti.default=vd,Object.defineProperty(Gs,"__esModule",{value:!0});const wd=yt,bd=zs,Sd=_t,Pd=Vs,Ed=Js,Td=uo,kd=Bs,$d=Pr,Rd=Ks,Ad=Ws,Id=Xs,Od=Qs,Cd=Ys,Nd=Zs,Md=ei,Dd=ti;function Ud(t=!1){const e=[Id.default,Od.default,Cd.default,Nd.default,Md.default,Dd.default,kd.default,$d.default,Td.default,Rd.default,Ad.default];return t?e.push(bd.default,Pd.default):e.push(wd.default,Sd.default),e.push(Ed.default),e}Gs.default=Ud;var ri={},si={};Object.defineProperty(si,"__esModule",{value:!0});const re=V,jd={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:{message:({schemaCode:t})=>(0,re.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,re._)`{format: ${t}}`},code(t,e){const{gen:r,data:s,$data:i,schema:n,schemaCode:a,it:u}=t,{opts:o,errSchemaPath:c,schemaEnv:l,self:d}=u;if(!o.validateFormats)return;i?m():g();function m(){const _=r.scopeValue("formats",{ref:d.formats,code:o.code.formats}),w=r.const("fDef",(0,re._)`${_}[${a}]`),y=r.let("fType"),f=r.let("format");r.if((0,re._)`typeof ${w} == "object" && !(${w} instanceof RegExp)`,()=>r.assign(y,(0,re._)`${w}.type || "string"`).assign(f,(0,re._)`${w}.validate`),()=>r.assign(y,(0,re._)`"string"`).assign(f,w)),t.fail$data((0,re.or)(v(),E()));function v(){return o.strictSchema===!1?re.nil:(0,re._)`${a} && !${f}`}function E(){const $=l.$async?(0,re._)`(${w}.async ? await ${f}(${s}) : ${f}(${s}))`:(0,re._)`${f}(${s})`,I=(0,re._)`(typeof ${f} == "function" ? ${$} : ${f}.test(${s}))`;return(0,re._)`${f} && ${f} !== true && ${y} === ${e} && !${I}`}}function g(){const _=d.formats[n];if(!_){v();return}if(_===!0)return;const[w,y,f]=E(_);w===e&&t.pass($());function v(){if(o.strictSchema===!1){d.logger.warn(I());return}throw new Error(I());function I(){return`unknown format "${n}" ignored in schema at path "${c}"`}}function E(I){const L=I instanceof RegExp?(0,re.regexpCode)(I):o.code.formats?(0,re._)`${o.code.formats}${(0,re.getProperty)(n)}`:void 0,U=r.scopeValue("formats",{key:n,ref:I,code:L});return typeof I=="object"&&!(I instanceof RegExp)?[I.type||"string",I.validate,(0,re._)`${U}.validate`]:["string",I,U]}function $(){if(typeof _=="object"&&!(_ instanceof RegExp)&&_.async){if(!l.$async)throw new Error("async format in sync schema");return(0,re._)`await ${f}(${s})`}return typeof y=="function"?(0,re._)`${f}(${s})`:(0,re._)`${f}.test(${s})`}}}};si.default=jd,Object.defineProperty(ri,"__esModule",{value:!0});const xd=[si.default];ri.default=xd;var vt={};Object.defineProperty(vt,"__esModule",{value:!0}),vt.contentVocabulary=vt.metadataVocabulary=void 0,vt.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],vt.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"],Object.defineProperty(Es,"__esModule",{value:!0});const qd=Ts,Fd=$s,Gd=Gs,Ld=ri,_o=vt,zd=[qd.default,Fd.default,(0,Gd.default)(),Ld.default,_o.metadataVocabulary,_o.contentVocabulary];Es.default=zd;var ii={},Ar={};Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.DiscrError=void 0;var vo;(function(t){t.Tag="tag",t.Mapping="mapping"})(vo||(Ar.DiscrError=vo={})),Object.defineProperty(ii,"__esModule",{value:!0});const wt=V,ni=Ar,wo=pe,Vd=pt,Jd=O,Bd={keyword:"discriminator",type:"object",schemaType:"object",error:{message:({params:{discrError:t,tagName:e}})=>t===ni.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,wt._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},code(t){const{gen:e,data:r,schema:s,parentSchema:i,it:n}=t,{oneOf:a}=i;if(!n.opts.discriminator)throw new Error("discriminator: requires discriminator option");const u=s.propertyName;if(typeof u!="string")throw new Error("discriminator: requires propertyName");if(s.mapping)throw new Error("discriminator: mapping is not supported");if(!a)throw new Error("discriminator: requires oneOf keyword");const o=e.let("valid",!1),c=e.const("tag",(0,wt._)`${r}${(0,wt.getProperty)(u)}`);e.if((0,wt._)`typeof ${c} == "string"`,()=>l(),()=>t.error(!1,{discrError:ni.DiscrError.Tag,tag:c,tagName:u})),t.ok(o);function l(){const g=m();e.if(!1);for(const _ in g)e.elseIf((0,wt._)`${c} === ${_}`),e.assign(o,d(g[_]));e.else(),t.error(!1,{discrError:ni.DiscrError.Mapping,tag:c,tagName:u}),e.endIf()}function d(g){const _=e.name("valid"),w=t.subschema({keyword:"oneOf",schemaProp:g},_);return t.mergeEvaluated(w,wt.Name),_}function m(){var g;const _={},w=f(i);let y=!0;for(let $=0;$<a.length;$++){let I=a[$];if(I!=null&&I.$ref&&!(0,Jd.schemaHasRulesButRef)(I,n.self.RULES)){const U=I.$ref;if(I=wo.resolveRef.call(n.self,n.schemaEnv.root,n.baseId,U),I instanceof wo.SchemaEnv&&(I=I.schema),I===void 0)throw new Vd.default(n.opts.uriResolver,n.baseId,U)}const L=(g=I==null?void 0:I.properties)===null||g===void 0?void 0:g[u];if(typeof L!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${u}"`);y=y&&(w||f(I)),v(L,$)}if(!y)throw new Error(`discriminator: "${u}" must be required`);return _;function f({required:$}){return Array.isArray($)&&$.includes(u)}function v($,I){if($.const)E($.const,I);else if($.enum)for(const L of $.enum)E(L,I);else throw new Error(`discriminator: "properties/${u}" must have "const" or "enum"`)}function E($,I){if(typeof $!="string"||$ in _)throw new Error(`discriminator: "${u}" values must be unique strings`);_[$]=I}}}};ii.default=Bd;const Kd={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MissingRefError=e.ValidationError=e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=e.Ajv=void 0;const r=Yi,s=Es,i=ii,n=Kd,a=["/properties"],u="http://json-schema.org/draft-07/schema";class o extends r.default{_addVocabularies(){super._addVocabularies(),s.default.forEach(_=>this.addVocabulary(_)),this.opts.discriminator&&this.addKeyword(i.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const _=this.opts.$data?this.$dataMetaSchema(n,a):n;this.addMetaSchema(_,u,!1),this.refs["http://json-schema.org/schema"]=u}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(u)?u:void 0)}}e.Ajv=o,t.exports=e=o,t.exports.Ajv=o,Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var c=be;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return c.KeywordCxt}});var l=V;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return l._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return l.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return l.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return l.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return l.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return l.CodeGen}});var d=Ct;Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return d.default}});var m=pt;Object.defineProperty(e,"MissingRefError",{enumerable:!0,get:function(){return m.default}})})(ts,ts.exports);var bo=ts.exports;const Hd=es(bo);var oi={exports:{}},So={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.formatNames=t.fastFormats=t.fullFormats=void 0;function e(C,D){return{validate:C,compare:D}}t.fullFormats={date:e(n,a),time:e(o(!0),c),"date-time":e(m(!0),g),"iso-time":e(o(),l),"iso-date-time":e(m(),_),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:f,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:W,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:E,int32:{type:"number",validate:L},int64:{type:"number",validate:U},float:{type:"number",validate:B},double:{type:"number",validate:B},password:!0,binary:!0},t.fastFormats={...t.fullFormats,date:e(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,a),time:e(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,c),"date-time":e(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,g),"iso-time":e(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,l),"iso-date-time":e(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,_),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i},t.formatNames=Object.keys(t.fullFormats);function r(C){return C%4===0&&(C%100!==0||C%400===0)}const s=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,i=[0,31,28,31,30,31,30,31,31,30,31,30,31];function n(C){const D=s.exec(C);if(!D)return!1;const F=+D[1],x=+D[2],H=+D[3];return x>=1&&x<=12&&H>=1&&H<=(x===2&&r(F)?29:i[x])}function a(C,D){if(C&&D)return C>D?1:C<D?-1:0}const u=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function o(C){return function(F){const x=u.exec(F);if(!x)return!1;const H=+x[1],qe=+x[2],Fe=+x[3],ir=x[4],at=x[5]==="-"?-1:1,A=+(x[6]||0),b=+(x[7]||0);if(A>23||b>59||C&&!ir)return!1;if(H<=23&&qe<=59&&Fe<60)return!0;const T=qe-b*at,S=H-A*at-(T<0?1:0);return(S===23||S===-1)&&(T===59||T===-1)&&Fe<61}}function c(C,D){if(!(C&&D))return;const F=new Date("2020-01-01T"+C).valueOf(),x=new Date("2020-01-01T"+D).valueOf();if(F&&x)return F-x}function l(C,D){if(!(C&&D))return;const F=u.exec(C),x=u.exec(D);if(F&&x)return C=F[1]+F[2]+F[3],D=x[1]+x[2]+x[3],C>D?1:C<D?-1:0}const d=/t|\s/i;function m(C){const D=o(C);return function(x){const H=x.split(d);return H.length===2&&n(H[0])&&D(H[1])}}function g(C,D){if(!(C&&D))return;const F=new Date(C).valueOf(),x=new Date(D).valueOf();if(F&&x)return F-x}function _(C,D){if(!(C&&D))return;const[F,x]=C.split(d),[H,qe]=D.split(d),Fe=a(F,H);if(Fe!==void 0)return Fe||c(x,qe)}const w=/\/|:/,y=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function f(C){return w.test(C)&&y.test(C)}const v=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function E(C){return v.lastIndex=0,v.test(C)}const $=-(2**31),I=2**31-1;function L(C){return Number.isInteger(C)&&C<=I&&C>=$}function U(C){return Number.isInteger(C)}function B(){return!0}const te=/[^\\]\\Z/;function W(C){if(te.test(C))return!1;try{return new RegExp(C),!0}catch{return!1}}})(So);var Po={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.formatLimitDefinition=void 0;const e=bo,r=V,s=r.operators,i={formatMaximum:{okStr:"<=",ok:s.LTE,fail:s.GT},formatMinimum:{okStr:">=",ok:s.GTE,fail:s.LT},formatExclusiveMaximum:{okStr:"<",ok:s.LT,fail:s.GTE},formatExclusiveMinimum:{okStr:">",ok:s.GT,fail:s.LTE}},n={message:({keyword:u,schemaCode:o})=>(0,r.str)`should be ${i[u].okStr} ${o}`,params:({keyword:u,schemaCode:o})=>(0,r._)`{comparison: ${i[u].okStr}, limit: ${o}}`};t.formatLimitDefinition={keyword:Object.keys(i),type:"string",schemaType:"string",$data:!0,error:n,code(u){const{gen:o,data:c,schemaCode:l,keyword:d,it:m}=u,{opts:g,self:_}=m;if(!g.validateFormats)return;const w=new e.KeywordCxt(m,_.RULES.all.format.definition,"format");w.$data?y():f();function y(){const E=o.scopeValue("formats",{ref:_.formats,code:g.code.formats}),$=o.const("fmt",(0,r._)`${E}[${w.schemaCode}]`);u.fail$data((0,r.or)((0,r._)`typeof ${$} != "object"`,(0,r._)`${$} instanceof RegExp`,(0,r._)`typeof ${$}.compare != "function"`,v($)))}function f(){const E=w.schema,$=_.formats[E];if(!$||$===!0)return;if(typeof $!="object"||$ instanceof RegExp||typeof $.compare!="function")throw new Error(`"${d}": format "${E}" does not define "compare" function`);const I=o.scopeValue("formats",{key:E,ref:$,code:g.code.formats?(0,r._)`${g.code.formats}${(0,r.getProperty)(E)}`:void 0});u.fail$data(v(I))}function v(E){return(0,r._)`${E}.compare(${c}, ${l}) ${i[d].fail} 0`}},dependencies:["format"]};const a=u=>(u.addKeyword(t.formatLimitDefinition),u);t.default=a})(Po),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const r=So,s=Po,i=V,n=new i.Name("fullFormats"),a=new i.Name("fastFormats"),u=(c,l={keywords:!0})=>{if(Array.isArray(l))return o(c,l,r.fullFormats,n),c;const[d,m]=l.mode==="fast"?[r.fastFormats,a]:[r.fullFormats,n],g=l.formats||r.formatNames;return o(c,g,d,m),l.keywords&&(0,s.default)(c),c};u.get=(c,l="full")=>{const m=(l==="fast"?r.fastFormats:r.fullFormats)[c];if(!m)throw new Error(`Unknown format "${c}"`);return m};function o(c,l,d,m){var g,_;(g=(_=c.opts.code).formats)!==null&&g!==void 0||(_.formats=(0,i._)`require("ajv-formats/dist/formats").${m}`);for(const w of l)c.addFormat(w,d[w])}t.exports=e=u,Object.defineProperty(e,"__esModule",{value:!0}),e.default=u}(oi,oi.exports);var Wd=oi.exports;const Xd=es(Wd),Qd={ads:{isEnabled:!0,configs:[{conditions:"isDebugMode() && isPlatformType('AARP') && (isGame('cooking-live') || isGame('crosswordling'))",config:{adTypes:["interstitial"],cooldown:300}},{conditions:"(isPlatform('arkadium.com') || isPlatform('evo-staging.arkadiumarena.com') || isPlatform('staging.arkadium.com')) && isGame('zoo-boom')",config:{adTypes:["interstitial"],cooldown:120}},{conditions:"isPlatformType('AARP') && (isGame('zoo-boom') || isGame('garden-bloom'))",config:{isEnabled:!1,adTypes:["interstitial"]}}]},config:{refreshInterval:0},leaderboards:{scoreBlacklist:["swipe-city","crosswordling","categories","room-escape","ridella","foony-chess","tile-match-usa","gridland-2","unblock-evolution","cross-stitch-masters","mr-runner-x","one-line","cooking-live","cubis-2","hex-puzzle-adventure","hex-jigsaw-challenge","jewel-quest","find-hidden-object","bubble-town"]},nakama:{isEnabled:!0,envs:["DEV"],debugMode:!0}},Yd="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Zd=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=Yd[r[t]&63];return e};const oe={block:"padding-left: 4px; padding-right: 4px; font-weight: normal;",chunk:"padding-left: 4px; padding-right: 4px; font-weight: normal;",arkadium:'line-height:1.5; color: #000; font-family: "Apple Emoji Font"; font-weight: normal !important;',new:"background-color: #29b6f6; color: #000",rpc:"background-color: #7e57c2; color: #fff",event:"background-color: #9ccc65; color: #000",effect:"background-color: #26a69a; color: #000",emoji:"",file:"color: #9e9e9e; padding-left: 20px;",reset:"color: currentColor; background-color: transparent;"},eh="",th=[["Ark SDK","%s","font-family: Menlo, monospace;"]],rh=(t,e,r)=>t===e-1?oe.reset:r;function tt(t,e,r=void 0){if(!(location.hostname==="localhost"||we()))return;const i=[],n=[];t.unshift(...th),t.forEach(([u,o,c],l)=>{i.push(`%c${o}%c`),n.push(`${oe.block} ${c}`,u,rh(l,t.length,`${oe.block} ${c}`))}),e.forEach(([u,o,c])=>{i.push(`%c${o}`),n.push(`${oe.chunk} ${c}`,u)});const a=[i.join(eh),...n];r==="open"?console.group(...a):r==="collapsed"?console.groupCollapsed(...a):console.log(...a)}const sh=t=>[t,"%s",oe.rpc],Eo=t=>[t,"%s",oe.rpc],ai=t=>[t,"%s",oe.event];function To(t,e=null){let r=[["done ","%s",oe.emoji]];e&&r.push([e,"%o","padding-left: 4px;"]),tt([sh(t)],r)}function ko(t,e,r){tt([Eo(t)],[[r,"%o","padding-left: 4px;"],[e,"%s",oe.file],[t,"%s",oe.file]])}function ih(t,e,r,s){tt([ai(t)],[["responding ","%s",oe.emoji],[r,"(%o)","padding-left: 4px;"],["-> ","%s",""],[s,"%o","padding: 0;"],[e,"%s",oe.file],[t,"%s",oe.file]])}function nh(t){tt([ai(t)],[["done ","%s",oe.emoji]])}function oh(t){tt([ai(t)],[["missing ","%s",oe.emoji],["missing handler","%s","padding-left: 4px;"]])}function ah(t,e,r,s){const i=s instanceof Error;tt([Eo(t)],[["fail ","%s",oe.emoji],[r,"(%o)","padding-left: 4px;"],["-> ","%s",""],i?[String(s),"%s",""]:[s,"%o","padding: 0;"],[e,"%s",oe.file],[t,"%s",oe.file]],i?"collapsed":void 0),i&&tt([],[[" ","%s",""],[s,"%o","padding-left: 20px;"]]),console.groupEnd()}const uh=5e3;class ch{constructor(){this.rpcCallbacks={}}init(e){this.target=e,To("update target",e),this.processMessages()}sendMessage(e){return new Promise((s,i)=>{var u;ko(e.func,e.module,e.payload);let n="",a;e.executionTimeLimitMs&&e.executionTimeLimitMs===-1?a=void 0:a=setTimeout(()=>{this.unregisterCB(n),i(new Error(`${e.func} has been exceeded timeout`))},e.executionTimeLimitMs||uh),n=this.registerCb(e,s,i,a),(u=this.target)==null||u.postMessage(JSON.stringify({eventType:"rpcRequest",message:e,cbId:n}),"*")})}unsubscribe(){this.target=null,window.removeEventListener("message",this.eventListener),this.eventListener=null,Object.keys(this.rpcCallbacks).forEach(e=>{this.unregisterCB(e)})}genId(e){const r=Date.now();return`${e.module}_${e.func}_${r}_${Zd()}`}processMessages(){this.eventListener=e=>{if(e.data)try{const r=JSON.parse(e.data);r.eventType==="rpcResponse"&&(this.rpcCallbacks[r.message.cbId]?"err"in r.message?this.rpcCallbacks[r.message.cbId].reject(new Error(r.message.err)):(nh(r.message.cbId),this.rpcCallbacks[r.message.cbId].resolve(r.message.payload)):oh(r.message.cbId),this.unregisterCB(r.message.cbId))}catch{}},window.addEventListener("message",this.eventListener)}registerCb(e,r,s,i){const n=this.genId(e);return this.rpcCallbacks[n]={resolve:r,reject:s,timerId:i},n}unregisterCB(e){this.rpcCallbacks[e].timerId&&clearTimeout(this.rpcCallbacks[e].timerId),delete this.rpcCallbacks[e]}}class lh{constructor(){this.registry={},this.processMessages()}init(e){this.target=e}addToRegistry(e,r,s,i){this.registry[this.getId(e,r)]={bindTo:s,fn:i}}unsubscribe(){this.target=null,window.removeEventListener("message",this.eventListener),this.eventListener=null,this.registry={}}getId(e,r){return`${e}_${r}`}processMessages(){To("subscribed to debug"),this.eventListener=async e=>{if(e.data)try{const r=JSON.parse(e.data);if(r.eventType==="rpcRequest"){const s=this.getId(r.message.module,r.message.func);if(ko(r.message.func,r.message.module,r.message.payload),this.registry[s])try{const i=await this.registry[s].fn.apply(this.registry[s].bindTo,r.message.payload);ih(r.message.func,r.message.module,r.message.payload,i),this.sendResponse(r.cbId,i)}catch(i){console.error(i),ah(r.message.func,r.message.module,r.message.payload,i),this.sendError(r.cbId,i)}}}catch{}},window.addEventListener("message",this.eventListener)}sendResponse(e,r){var s;(s=this.target)==null||s.postMessage(JSON.stringify({eventType:"rpcResponse",message:{cbId:e,payload:r}}),"*")}sendError(e,r){var s;(s=this.target)==null||s.postMessage(JSON.stringify({eventType:"rpcResponse",message:{cbId:e,err:r.toString()}}),"*")}}class Be{constructor(){this.rpcPublisher=new ch,this.rpcSubscriber=new lh}static get Instance(){return this._instance||(this._instance=new this)}}const dh="DebugProvider";function we(){let t;try{t=window.localStorage}catch{t=window.sessionStorage}try{return t.getItem("DEBUG_SDK")==="*"}catch{return!1}}class Ir{constructor(){this.observers=[],this.isDebug=!1,Be.Instance.rpcSubscriber.addToRegistry(dh,"sendDebugEvent",this,this.sendDebugEvent),this.initDebugMode()}static get Instance(){return this._instance||(this._instance=new this)}initDebugMode(){let e;try{e=window.localStorage}catch{e=window.sessionStorage}try{this.isDebug=e.getItem("DEBUG_SDK")==="*"}catch{this.isDebug=!1}}isDebugMode(){return this.isDebug}setDebugMode(e){this.isDebug=e;let r;try{r=window.localStorage}catch{r=window.sessionStorage}e?r.setItem("DEBUG_SDK","*"):r.removeItem("DEBUG_SDK","*")}sendDebugEvent(e,...r){this.isDebugMode()&&(r.length>0?console.log("[Debug Log]",e,"with args:",...r):console.log("[Debug Log]",e),this.observers.forEach(s=>s(e)))}onDebugEvent(e){this.observers.push(e)}}const je="Host";var Te=(t=>(t.ARKCOM="ARKCOM",t.ARENA51="ARENA51",t.AARP="AARP",t))(Te||{});class ui{constructor(e="",r="",s="",i="",n="",a=!1){this.siteName=e,this.siteDomain=r,this.referrer=s,this.activeLocale=i,this.devEnvironment=n,this.darkMode=a}clone(e){const r=new ui;return Object.assign(r,this,e)}}class hh{constructor(e,r){this.rpcProvider=e,this.debugProvider=r,this.gameIdOverride="",this.data=new ui,this.openRequest=lt(void 0),e.rpcSubscriber.addToRegistry(je,"getQueryParameter",this,this.getQueryParameter),e.rpcSubscriber.addToRegistry(je,"getGameId",this,this.getGameId),e.rpcSubscriber.addToRegistry(je,"getDetails",this,this.getDetails),e.rpcSubscriber.addToRegistry(je,"openPurchaseForm",this,this.openPurchaseForm),e.rpcSubscriber.addToRegistry(je,"getArenaName",this,this.getArenaName),e.rpcSubscriber.addToRegistry(je,"getArenaType",this,this.getArenaType),e.rpcSubscriber.addToRegistry("UrlParamsReader","GetParam",this,this.getQueryParameter),e.rpcSubscriber.addToRegistry("GameIdReader","readGameId",this,this.getGameId),e.rpcSubscriber.addToRegistry("GameIdReader","setGameId",this,this.noOp),e.rpcSubscriber.addToRegistry("WebEnvironmentDetailsStorage","getParams",this,this.getDetails),e.rpcSubscriber.addToRegistry("WebEnvironmentDetailsStorage","setParams",this,this.noOp),e.rpcSubscriber.addToRegistry("PurchaseUIManager","purchaseRequest",this,this.openPurchaseForm)}async noOp(){}async getQueryParameter(e){return new URLSearchParams(window.location.search).get(e)}async getGameId(){return this.getGameIdSync()}getGameIdSync(){var s,i;if(this.gameIdOverride)return this.gameIdOverride;const r=window.location.href.match("\\/games\\/([^\\/?]*)");return((r?r[1]:"")||"").split("/")[0]||((i=(s=this.debugProvider).isDebugMode)!=null&&i.call(s)?"test-game-id":"")}async setGameId(e){this.gameIdOverride=e}async getDetails(){return this.data.clone({})}async setDetails(e){this.data=this.data.clone(e)}openPurchaseForm(e){return this.openRequest.update(e),Promise.resolve()}onOpenPurchaseForm(e){return this.openRequest.subscribe(e)}async purchaseFormClosed(e){return this.rpcProvider.rpcPublisher.sendMessage({module:je,func:"purchaseFormClosed",payload:[e]}).catch(()=>this.rpcProvider.rpcPublisher.sendMessage({module:"PurchaseUIManager",func:"shopWindowClosed",payload:[e]}))}async getArenaName(){return this.getArenaNameSync()}getArenaNameSync(){var e;return window.arenaName||((e=window.location.hostname)==null?void 0:e.replace(/^www./,""))||"default"}async getGameSDKUrl(){return this.rpcProvider.rpcPublisher.sendMessage({module:je,func:"getGameSDKUrl",payload:[]})}async getArenaType(){const e=await this.getArenaName();return e.includes("arena51")?"ARENA51":e.includes("AARP")||e.includes("aarp")?"AARP":"ARKCOM"}getGameDimensions(){return this.rpcProvider.rpcPublisher.sendMessage({module:je,func:"getGameDimensions",payload:[]})}}const fh={type:"object",properties:{nakama:{type:"object",properties:{isEnabled:{type:"boolean"},envs:{type:"array",items:{type:"string"}},debugMode:{type:"boolean"}},required:["isEnabled","envs","debugMode"],additionalProperties:!1},config:{type:"object",properties:{refreshInterval:{type:"number"}},required:["refreshInterval"],additionalProperties:!1},leaderboards:{type:"object",properties:{scoreBlacklist:{type:"array",items:{type:"string"}}},required:["scoreBlacklist"],additionalProperties:!1},ads:{type:"object",properties:{isEnabled:{type:"boolean"},configs:{type:"array",items:{type:"object",properties:{conditions:{type:"string"},config:{type:"object",oneOf:[{required:["adTypes","isEnabled"],properties:{adTypes:{type:"array",items:{type:"string"}},isEnabled:{type:"boolean"},cooldown:!1},additionalProperties:!1},{required:["adTypes","cooldown"],properties:{adTypes:{type:"array",items:{type:"string"}},isEnabled:!1,cooldown:{type:"number"}},additionalProperties:!1}]}},required:["conditions","config"],additionalProperties:!1}}},required:["isEnabled","configs"],additionalProperties:!1}},required:["nakama","config","leaderboards","ads"],additionalProperties:!1},Xr=class Xr{constructor(){this._config=Qd,this._isLoaded=!1,this._refreshTimer=null,this._configChangeCallbacks=new Set,this._gameId="",this._platformId="",this._platformType=Te.ARKCOM,this._host=null;const e=new Hd;Xd(e),this._validate=e.compile(fh)}static get Instance(){return this._instance||(this._instance=new Xr),this._instance}subscribe(e){return this._configChangeCallbacks.add(e),()=>this._configChangeCallbacks.delete(e)}notifyConfigChange(){this._configChangeCallbacks.forEach(e=>e(this._config))}async init(e){if(!this._isLoaded){if(e){this._host=e;const[r,s,i]=await Promise.all([e.getGameId(),e.getArenaName(),e.getArenaType()]);this._gameId=r,this._platformId=s,this._platformType=i}this._refreshTimer&&(clearTimeout(this._refreshTimer),this._refreshTimer=null),await this.loadConfig(),!this._refreshTimer&&this._config.config.refreshInterval>=60*5&&(this._refreshTimer=setTimeout(()=>{this._isLoaded=!1,this.init()},this._config.config.refreshInterval*1e3))}}async loadConfig(){try{const e=await fetch(`https://developers.arkadium.com/cdn/sdk/sdk-config/config.json?build=${Date.now()}`);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const r=await e.json();if(!this._validate(r))throw new Error(`Invalid JSON: ${JSON.stringify(this._validate.errors,null,2)}`);const s=r;JSON.stringify(this._config)!==JSON.stringify(s)&&(this._config=s,this.notifyConfigChange()),this._isLoaded=!0}catch(e){console.error(`Failed to fetch JSON: ${e}`)}}get config(){return this._config}dispose(){this._isLoaded=!1,this._refreshTimer&&(clearTimeout(this._refreshTimer),this._refreshTimer=null),this._configChangeCallbacks.clear()}getConfigForProperty(e){var i,n,a;const r=this._gameId;this._gameId=((n=(i=this._host)==null?void 0:i.getGameIdSync)==null?void 0:n.call(i))||"";let s=!1;if(r!==this._gameId&&(s=!0),e==="ads"){if(!this._config.ads.isEnabled)return{isEnabled:!1,gameIdChanged:s};for(const u of this._config.ads.configs)try{const o=this.tokenize(u.conditions),c=this.parseExpression(o);if(this.evaluateAST(c))return{isEnabled:((a=u.config)==null?void 0:a.isEnabled)??!0,gameIdChanged:s,...u.config}}catch(o){console.error(`Error evaluating conditions: ${o}`)}return{isEnabled:!0,gameIdChanged:s}}return null}tokenize(e){const r=[];let s="",i=!1,n="",a=0;for(let u=0;u<e.length;u++){const o=e[u];if(o==='"'||o==="'"){i?o===n&&(i=!1):(i=!0,n=o),s+=o;continue}if(i){s+=o;continue}if(o==="("){s&&(r.push(s.trim()),s=""),r.push(o),a++;continue}if(o===")"){s&&(r.push(s.trim()),s=""),r.push(o),a--;continue}if(o==="&"||o==="|"){s&&(r.push(s.trim()),s=""),u+1<e.length&&e[u+1]===o&&(r.push(o+o),u++);continue}if(o===" "||o==="	"){s&&(r.push(s.trim()),s="");continue}s+=o}if(s&&r.push(s.trim()),a!==0)throw new Error("Unmatched parentheses");return r.filter(u=>u!=="")}parseExpression(e){let r=0;const s=()=>{let a=i();for(;r<e.length&&e[r]==="||";){r++;const u=i();a={type:"or",left:a,right:u}}return a},i=()=>{let a=n();for(;r<e.length&&e[r]==="&&";){r++;const u=n();a={type:"and",left:a,right:u}}return a},n=()=>{const a=e[r++];if(a.match(/^\w+$/)&&e[r]==="("){r++;const u=[];let o="",c=0;for(;r<e.length;){const l=e[r++];if(l==="(")c++,o+=l;else if(l===")"){if(c===0){o&&u.push(o.trim().replace(/['"]/g,""));break}c--,o+=l}else l===","&&c===0?(u.push(o.trim().replace(/['"]/g,"")),o=""):o+=l}return{type:"condition",method:a,args:u}}if(a==="("){const u=s();if(r>=e.length||e[r]!==")")throw new Error("Unmatched parentheses");return r++,u}throw new Error(`Invalid token: ${a}`)};return s()}evaluateAST(e){if(!e)return!1;switch(e.type){case"or":{const r=this.evaluateAST(e.left),s=this.evaluateAST(e.right);return r||s}case"and":{const r=this.evaluateAST(e.left),s=this.evaluateAST(e.right);return r&&s}case"condition":return this.evaluateCondition(e.method,e.args);default:throw new Error(`Unknown node type: ${e.type}`)}}evaluateCondition(e,r){switch(e){case"isDebugMode":return this.isDebugMode();case"isPlatform":return this.isPlatform(r[0]);case"isPlatformType":return this.isPlatformType(r[0]);case"isGame":return this.isGame(r[0]);default:return!1}}isDebugMode(){return Ir.Instance.isDebugMode()}isPlatform(e){return e===this._platformId}isPlatformType(e){return e===this._platformType}isGame(e){return e===this._gameId}};Xr._instance=null;let bt=Xr;var $o=(t=>(t[t.TEST_READY=1]="TEST_READY",t[t.GAME_START=2]="GAME_START",t[t.INTERACT=3]="INTERACT",t[t.SCORE_CHANGED=4]="SCORE_CHANGED",t[t.GAME_END=5]="GAME_END",t[t.PAUSE_READY=6]="PAUSE_READY",t[t.GAME_PAUSE=7]="GAME_PAUSE",t[t.GAME_RESUME=8]="GAME_RESUME",t[t.GEMS_UPDATE=9]="GEMS_UPDATE",t[t.AD_INTERSTITIAL_REQUESTED=10]="AD_INTERSTITIAL_REQUESTED",t[t.AD_INTERSTITIAL_SHOWN=11]="AD_INTERSTITIAL_SHOWN",t[t.AD_REWARDED_REQUESTED=12]="AD_REWARDED_REQUESTED",t[t.AD_REWARDED_SHOWN=13]="AD_REWARDED_SHOWN",t[t.LEVEL_START=14]="LEVEL_START",t[t.LEVEL_END=15]="LEVEL_END",t))($o||{});const mh=[7,8],Ro="GameLifecycle";class ph{constructor(e,r){this.rpcProvider=e,this.host=r,this.subscribers=[],this.LifecycleEvent=$o,this.rpcProvider.rpcSubscriber.addToRegistry(Ro,"onEvent",this,this.onEvent),["OnTestReady","OnGameStart","OnInteract","OnChangeScore","OnGameEnd","OnGamePause","OnGameResume","OnPauseReady"].forEach(i=>{this.rpcProvider.rpcSubscriber.addToRegistry("GameLifecycle",i,this,this[i])})}async onEvent(e,r){var s,i,n,a,u,o,c,l,d,m;if(e===1&&((i=(s=window.__RUM__)==null?void 0:s.addBreadcrumb)==null||i.call(s,{category:"game",message:"Game sent TEST_READY event",level:"debug"}),(a=(n=window.__RUM__)==null?void 0:n.captureMessage)==null||a.call(n,"game.ready",{tags:{"game.ready":"true"}})),e===2&&((o=(u=window.__RUM__)==null?void 0:u.addBreadcrumb)==null||o.call(u,{category:"game",message:"Game sent GAME_START event",level:"debug"}),(l=(c=window.__RUM__)==null?void 0:c.captureMessage)==null||l.call(c,"game.start",{tags:{"game.start":"true"}})),e===4){const g=await this.host.getGameId();if((m=(d=bt.Instance.config.leaderboards)==null?void 0:d.scoreBlacklist)!=null&&m.includes(g))return}this.subscribers.forEach(g=>{g(e,r)})}async dispatchEvent(e){if(!Object.values(mh).includes(e))throw new Error("[GameLifecycle]: cannot dispatch unsupported event.");await this.rpcProvider.rpcPublisher.sendMessage({module:Ro,func:"onEvent",payload:[e]})}subscribe(e,r=!0){r&&(this.subscribers.length=0),this.subscribers.push(e)}async OnTestReady(){this.onEvent(1)}async OnGameStart(){this.onEvent(2)}async OnInteract(){this.onEvent(3)}async OnChangeScore(e){this.onEvent(4,e)}async OnGameEnd(){this.onEvent(5)}async OnGamePause(){this.onEvent(7)}async OnGameResume(){this.onEvent(8)}async OnPauseReady(){this.onEvent(6)}}let ci;const rr=class rr{constructor(e,r){this._isShowing=!1,this._scriptLoaded=new Promise((s,i)=>{var a;if((a=globalThis.__ark_ads__)!=null&&a.AdVideo){s();return}var n=document.createElement("script");n.src=r||`https://ams.cdn.arkadiumhosted.com/advertisement/video/stable/${e!==""?e+"/":""}video-ads.js`,n.onload=()=>s(),n.onerror=()=>i(new Error(`[ArkadiumArenaSDK] Failed to load video ad library: ${n.src}`)),setTimeout(()=>i(new Error(`[ArkadiumArenaSDK] Timed out while waiting for video ad library to load: ${n.src}`)),3e4),(document.head||document.body).appendChild(n)})}static getInstance(e="",r=""){return(!ci||this.domain!==e||this.url!==r)&&(ci=new rr(e,r),this.domain=e,this.url=r),ci}preroll(e){return this._scriptLoaded.then(()=>this.render({...e,position:"pre-roll"}))}interstitial(e){return this._scriptLoaded.then(()=>this.render({...e,position:"interstitial"}))}rewarded(e){return this._scriptLoaded.then(()=>this.render({...e,position:"reward"}))}isShowing(){return this._isShowing}render({duration:e=30,env:r=se.PROD,product:s="sdk",position:i="pre-roll",keyvalues:n={},adPodding:a=!0}={}){const u=r===se.DEV;return this._isShowing?(console.error("[ArkadiumArenaSDK] Video Ad: Cannot show ad while another ad is being displayed."),Promise.reject(new Error("Cannot show ad while another ad is being displayed."))):new Promise((o,c)=>{try{const l=document.querySelector("#game_container")||document.querySelector(".game");let d=null;document.querySelector("#video_container")||(we()&&console.log("[ArkadiumArenaSDK] Video Ad: Creating video container."),l.insertAdjacentHTML("beforeend",'<div id="video_container" style="background: #000; position: absolute; top: 0; left: 0; height: 100%; width: 100%; display: flex; flex-flow: column nowrap; justify-content: center;"></div>'),d=document.querySelector("#video_container"),we()&&console.log("[ArkadiumArenaSDK] Video Ad: Video container created."));const m=new globalThis.__ark_ads__.AdVideo,g=()=>{var _;this._isShowing=!1,(_=document.querySelector("#video_container"))==null||_.remove(),d==null||d.remove(),we()&&console.log("[ArkadiumArenaSDK] Video Ad: Video container removed."),o()};this._isShowing=!0,m.render({finalCallback:g,duration:e,isDev:u,element:"video_container",product:s,position:i,keyvalues:n,adPodding:a,autoplay:!0,CTAScreenConfig:{}}),d&&(d.style.position="absolute")}catch(l){this._isShowing=!1,c(l)}})}};rr.domain="",rr.url="";let Gt=rr,Lt;var Ao=(t=>(t.AD_300x250="AD_300x250",t.AD_250x250="AD_250x250",t.AD_336x280="AD_336x280",t.AD_300x600="AD_300x600",t.AD_728x90="AD_728x90",t.AD_768x90="AD_768x90",t.AD_970x90="AD_970x90",t.AD_970x250="AD_970x250",t.AD_320x50="AD_320x50",t.AD_320x100="AD_320x100",t.AD_468x60="AD_468x60",t.AD_160x600="AD_160x600",t))(Ao||{});const gh={AD_300x250:[300,250],AD_250x250:[250,250],AD_336x280:[336,280],AD_300x600:[300,600],AD_728x90:[728,90],AD_768x90:[768,90],AD_970x90:[970,90],AD_970x250:[970,250],AD_320x50:[320,50],AD_320x100:[320,100],AD_468x60:[468,60],AD_160x600:[160,600]},sr=class sr{constructor(e,r){this.ads={},this._scriptLoaded=new Promise((s,i)=>{let n=document.createElement("script");n.src=r||`https://ams.cdn.arkadiumhosted.com/advertisement/display/stable/${e!==""?e+"/":""}display-ads.js`,n.onload=()=>s(),n.onerror=()=>i(new Error(`[ArkadiumArenaSDK] Failed to load display ad library: ${n.src}`)),setTimeout(()=>i(new Error(`[ArkadiumArenaSDK] Timed out while waiting for display ad library to load: ${n.src}`)),3e4),(document.head||document.body).appendChild(n)})}static getInstance(e="",r=""){return(!Lt||this.domain!==e||this.url!==r)&&(Lt&&Lt.removeAllAds(),Lt=new sr(e,r),this.domain=e,this.url=r),Lt}matchAdSize(e){const r=[];return e.forEach(s=>{r.push(gh[s])}),r}removeAllAds(){Object.keys(this.ads).forEach(r=>{const s=document.querySelector(`${r}`);s&&s.remove(),delete this.ads[r]})}show(e){var u;const r=e.id,s=this.matchAdSize(e.dimensions),i=document.querySelector(`#${r}`),n=e.dataId??"sdk_"+r,a=e.product??"arena";if(i&&!i.querySelector("display-ad-component")){const c=document.createElement("display-ad-component");c.setAttribute("data-id",n),c.setAttribute("product",a),c.setAttribute("dimensions",JSON.stringify(s)),i.appendChild(c),this.ads[r]=!0,(u=e.onAdShow)==null||u.call(e)}}};sr.domain="",sr.url="";let zt=sr;class Or{constructor(){this.domain="",this.url="",this.lastShownTime=0,this.adErrorHandlingMode="throw"}getAdText(){switch(this.adType){case"interstitial":return"Interstitial";case"rewarded":return"Rewarded";case"preroll":return"Preroll";case"banner":return"Banner";default:return"Unknown"}}isInCooldownPeriod(){var s;if(!this.adType)return!1;const e=bt.Instance.getConfigForProperty("ads"),r=this.getAdText();return!e||!e.isEnabled?(console.warn(`[ArkadiumArenaSDK] ${r} Ad: skipping ad due to being disabled on config.`),!0):!((s=e.adTypes)!=null&&s.find(i=>i===this.adType))||!e.cooldown||(e.gameIdChanged&&this.resetLastShownTime(),Date.now()>this.lastShownTime+e.cooldown*1e3)?!1:(console.warn(`[ArkadiumArenaSDK] ${r} Ad: skipping ad due to cooldown period.`),!0)}setLastShownTime(){this.lastShownTime=Date.now()}resetLastShownTime(){this.lastShownTime=0}setCustomDomain(e){this.domain=e}setCustomUrl(e){this.url=e}setAdErrorHandlingMode(e){this.adErrorHandlingMode=e||"throw"}}class yh extends Or{constructor(e,r){super(),this.auth=e,this.lifecycle=r,this.adType="preroll"}show(e){if(this.isInCooldownPeriod())return Promise.resolve();const{env:r}=e,s=Gt.getInstance(this.domain,this.url);return s.isShowing()?(console.error("[ArkadiumArenaSDK] Preroll Ad: Cannot show ad while another ad is being displayed."),Promise.resolve()):this.auth.getUserProfile().catch(()=>null).then(i=>i!=null&&i.isUserSubscriber?(console.log("[ArkadiumArenaSDK] Preroll Ad: skipping ad for subscribed user."),Promise.resolve()):((r!==se.PROD||we())&&console.log("[ArkadiumArenaSDK] Preroll Ad: showing ad."),this.lifecycle.dispatchEvent(this.lifecycle.LifecycleEvent.GAME_PAUSE).catch(()=>{Ir.Instance.isDebugMode()&&console.error("[ArkadiumArenaSDK] Preroll Ad: Failed to pause game.")}),s.preroll(e).catch(n=>{if(this.adErrorHandlingMode==="throw")throw n;return Promise.resolve()}).finally(()=>{this.setLastShownTime(),this.lifecycle.dispatchEvent(this.lifecycle.LifecycleEvent.GAME_RESUME).catch(()=>{Ir.Instance.isDebugMode()&&console.error("[ArkadiumArenaSDK] Preroll Ad: Failed to resume game.")})})))}}class _h extends Or{constructor(e,r,s){super(),this.rpcProvider=e,this.auth=r,this.lifecycle=s,this.adType="interstitial",this.rpcProvider.rpcSubscriber.addToRegistry("InterstitialAd","show",this,this.show)}show(e){if(this.isInCooldownPeriod())return Promise.resolve();const{env:r}=e,s=Gt.getInstance(this.domain,this.url);return s.isShowing()?(console.error("[ArkadiumArenaSDK] Interstitial Ad: Cannot show ad while another ad is being displayed."),Promise.resolve()):this.auth.getUserProfile().catch(()=>null).then(i=>i!=null&&i.isUserSubscriber?(console.log("[ArkadiumArenaSDK] Interstitial Ad: skipping ad for subscribed user."),Promise.resolve()):((r!==se.PROD||we())&&console.log("[ArkadiumArenaSDK] Interstitial Ad: showing ad."),this.lifecycle.dispatchEvent(this.lifecycle.LifecycleEvent.GAME_PAUSE),this.lifecycle.onEvent(this.lifecycle.LifecycleEvent.AD_INTERSTITIAL_REQUESTED),s.interstitial(e).then(()=>{this.setLastShownTime(),this.lifecycle.onEvent(this.lifecycle.LifecycleEvent.AD_INTERSTITIAL_SHOWN)}).catch(n=>{if(this.adErrorHandlingMode==="throw")throw n;return Promise.resolve()}).finally(()=>{this.lifecycle.dispatchEvent(this.lifecycle.LifecycleEvent.GAME_RESUME)})))}}class vh extends Or{constructor(e,r){super(),this.rpcProvider=e,this.lifecycle=r,this.adType="rewarded",this.rpcProvider.rpcSubscriber.addToRegistry("RewardedAd","show",this,this.show)}show(e){const r=Gt.getInstance(this.domain,this.url);return r.isShowing()?(console.error("[ArkadiumArenaSDK] Reward Ad: Cannot show ad while another ad is being displayed."),Promise.resolve({value:0})):((e.env!==se.PROD||we())&&console.log("[ArkadiumArenaSDK] Reward Ad: showing ad."),this.lifecycle.dispatchEvent(this.lifecycle.LifecycleEvent.GAME_PAUSE),this.lifecycle.onEvent(this.lifecycle.LifecycleEvent.AD_REWARDED_REQUESTED),r.rewarded(e).then(()=>{this.lifecycle.onEvent(this.lifecycle.LifecycleEvent.AD_REWARDED_SHOWN)}).then(()=>({value:1})).catch(s=>{if(this.adErrorHandlingMode==="ignore_with_rewards")return Promise.resolve({value:1});if(this.adErrorHandlingMode==="ignore")return Promise.resolve({value:0});throw s}).finally(()=>{this.lifecycle.dispatchEvent(this.lifecycle.LifecycleEvent.GAME_RESUME)}))}}class wh extends Or{constructor(e){super(),this.isSubscriber=!1,this.adType="banner",e.onAuthStatusChange(r=>{r&&e.getUserProfile().catch(()=>null).then(s=>{s&&s.isUserSubscriber&&zt.getInstance(this.domain,this.url).removeAllAds(),this.isSubscriber=!!(s&&s.isUserSubscriber)})})}show(e,r){if(this.isSubscriber)throw new Error("Banner Ad: cannot show ad to subscribed user.");if(typeof e=="string"){if(!r||r.length===0)throw new Error('Parameter "dimensions" must have length greater than 0!');zt.getInstance(this.domain,this.url).show({id:e,dimensions:r})}else zt.getInstance(this.domain,this.url).show(e)}}class bh extends wh{constructor(e,r){super(e),r.rpcSubscriber.addToRegistry("BannerAdsArena","getCustomDomain",this,this.getCustomDomain),r.rpcSubscriber.addToRegistry("BannerAdsArena","getCustomProperties",this,this.getCustomProperties)}getCustomDomain(){return this.domain}getCustomProperties(){return{domain:this.domain,url:this.url}}}class Sh{constructor(e,r,s,i){this.host=i,this.bannerSizes=Ao,this.preroll=new yh(r,s),this.interstitial=new _h(e,r,s),this.rewarded=new vh(e,s),this.banner=new bh(r,e),this.setAdErrorHandlingMode("throw")}setAdErrorHandlingMode(e){var s,i;const r=(i=(s=this.host).getArenaNameSync)==null?void 0:i.call(s);(r!=null&&r.includes("arkadium.com")||r!=null&&r.includes("evo.arena-sandbox.com")||r!=null&&r.includes("evo.arkadiumarena.com")||r!=null&&r.includes("localhost"))&&(e="ignore_with_rewards"),this.preroll.setAdErrorHandlingMode(e),this.interstitial.setAdErrorHandlingMode(e),this.rewarded.setAdErrorHandlingMode(e)}setVideoAdsUrl(e){this.preroll.setCustomUrl(e),this.interstitial.setCustomUrl(e),this.rewarded.setCustomUrl(e)}setVideoAdsDomain(e){this.preroll.setCustomDomain(e),this.interstitial.setCustomDomain(e),this.rewarded.setCustomDomain(e)}setDisplayAdsUrl(e){this.banner.setCustomUrl(e)}setDisplayAdsDomain(e){this.banner.setCustomDomain(e)}showPrerollAd(e){return this.preroll.show(e)}showInterstitialAd(e){return this.interstitial.show(e)}showRewardAd(e){return this.rewarded.show(e)}showBannerAd(e){return this.banner.show(e)}}/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var li=function(t,e){return li=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i])},li(t,e)};function Io(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");li(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Z=function(){return Z=Object.assign||function(e){for(var r,s=1,i=arguments.length;s<i;s++){r=arguments[s];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Z.apply(this,arguments)};function Ph(t,e,r,s){function i(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function u(l){try{c(s.next(l))}catch(d){a(d)}}function o(l){try{c(s.throw(l))}catch(d){a(d)}}function c(l){l.done?n(l.value):i(l.value).then(u,o)}c((s=s.apply(t,[])).next())})}function Eh(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,i,n,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(c){return function(l){return o([c,l])}}function o(c){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,i&&(n=c[0]&2?i.return:c[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,c[1])).done)return n;switch(i=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){r.label=c[1];break}if(c[0]===6&&r.label<n[1]){r.label=n[1],n=c;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(c);break}n[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(l){c=[6,l],i=0}finally{s=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var Th=["POST","PATCH"],Cr=function(t,e){return e=e||{},e.headers=e.headers||{"Content-Type":"application/json"},!e.headers["Content-Type"]&&Th.indexOf(e.method.toUpperCase())!==-1&&(e.headers["Content-Type"]="application/json"),fetch(t,e).then(function(r){return r.text().then(function(s){var i;try{i=JSON.parse(s)}catch{}if(r.status>=200&&r.status<300)return i||s;var n=new kh(r);throw i&&(i=Array.isArray(i)?i[0]:i),n.body=i||s,n})})},kh=function(t){Io(e,t);function e(r){var s=t.call(this,r.status+" - "+r.statusText+" for "+r.url)||this;return s.name="HttpError",s.response=r,s}return e}(Error),Vt;(function(t){t.ACCESS_TOKEN="eagle-access-token",t.REFRESH_TOKEN="eagle-refresh-token",t.EXPIRES_IN="eagle-expires_in"})(Vt||(Vt={}));var Nr=function(){function t(){this.AccessToken="",this.RefreshToken="",this.ExpiresIn=0}return t.prototype.update=function(e){this.AccessToken=e.AccessToken,this.RefreshToken=e.RefreshToken,this.ExpiresIn=e.ExpiresIn},t.fromV1=function(e){var r=new t;return r.AccessToken=e.access_token,r.RefreshToken=e.refresh_token,r.ExpiresIn=e.expires_in,r},t.fromV2=function(e){var r=new t;return r.AccessToken=e.access_toOOOOOOKEN,r.RefreshToken=e.refresh_tOOOOOOOoken,r.ExpiresIn=e.expires_inOOOOOOOOOO,r},t.fromStorage=function(e){return Ph(this,void 0,void 0,function(){var r,s,i,n,a;return Eh(this,function(u){switch(u.label){case 0:return r=new t,s=r,[4,e.getItem(Vt.ACCESS_TOKEN)];case 1:return s.AccessToken=u.sent()||"",i=r,[4,e.getItem(Vt.REFRESH_TOKEN)];case 2:return i.RefreshToken=u.sent()||"",n=r,a=parseInt,[4,e.getItem(Vt.EXPIRES_IN)];case 3:return n.ExpiresIn=a.apply(void 0,[u.sent()||"0",10]),[2,r]}})})},t}(),$h=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(Nr.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i,n){if(s===void 0&&(s=null),i===void 0&&(i=""),n===void 0&&(n=""),!this.server)throw new Error("No server url provided");var a=new Headers({"Content-Type":"application/json"});return i&&a.append("Authorization","Bearer "+i),n&&a.append("recaptcha",n),Cr(this.server.toString()+r,Z({method:e,headers:a},s?{body:JSON.stringify(Z({},s))}:{}))},t.prototype.doPost=function(e,r,s){s===void 0&&(s="");var i=r.captchaToken||"";return delete r.captchaToken,this.makeRequest("POST",e,r,s,i)},t.prototype.doPatch=function(e,r,s){s===void 0&&(s="");var i=r.captchaToken||"";return delete r.captchaToken,this.makeRequest("PATCH",e,r,s,i)},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.getPlans=function(){return this.doGet("web-subscription/plan")},t.prototype.createSubscription=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("web-subscription/purchase",Z({},e),s)}):Promise.reject("Please, provide session storage")},t.prototype.purchaseSubscription=function(e,r){return this.purchaseSubscriptionByEmail(e,r)},t.prototype.purchaseSubscriptionByEmail=function(e,r){return this.doPost("web-subscription/purchase/"+e,Z({},r))},t.prototype.purchaseGiftCard=function(e){return this.doPost("Recurly-Gift-Card/purchase/",Z({},e))},t.prototype.cancelSubscription=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("web-subscription/cancel",Z({},e),s)}):Promise.reject("Please, provide session storage")},t.prototype.getRecurlyData=function(){var e=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(r){return e.doGet("web-subscription/user-recurly-data",r)}):Promise.reject("Please, provide session storage")},t.prototype.createSubscriptionChange=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("web-subscription/create-subscription-change",Z({},e),s)}):Promise.reject("Please, provide session storage")},t.prototype.reactivateSubscription=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("web-subscription/reactivate-subscription",Z({},e),s)}):Promise.reject("Please, provide session storage")},t.prototype.purchaseItem=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("web-subscription/purchase-item",Z({},e),s)}):Promise.reject("Please, provide session storage")},t.prototype.getPurchasableItems=function(e){return this.doGet("web-subscription/purchasable-items?"+e.ids.map(function(r){return"ids="+encodeURIComponent(r)}).join("&"))},t}(),Rh=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(Nr.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i){if(s===void 0&&(s=null),i===void 0&&(i=""),!this.server)throw new Error("No server url provided");return Cr(this.server.toString()+r,Z(Z({method:e},i?{headers:{Authorization:"Bearer "+i}}:{}),s?{body:JSON.stringify(Z({},s))}:{}))},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.getSubscriptions=function(){var e=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(r){return e.doGet("general/subscriptions",r)}):Promise.reject("Please, provide session storage")},t.prototype.getExpiredSubscriptions=function(){var e=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(r){return e.doGet("general/expired-subscriptions",r)}):Promise.reject("Please, provide session storage")},t}(),Ah=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(Nr.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i){if(s===void 0&&(s=null),i===void 0&&(i=""),!this.server)throw new Error("No server url provided");return Cr(this.server.toString()+r,Z(Z({method:e},i?{headers:{Authorization:"Bearer "+i}}:{}),s?{body:JSON.stringify(Z({},s))}:{}))},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.doPost=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("POST",e,r,s)},t.prototype.syncSubcriptions=function(e){var r=this;return console.warn("syncSubcriptions method deprecated use syncSubscriptions instead"),this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("apple-subscription/sync",{originalTransactionsIds:e},s)}):Promise.reject("Please, provide session storage")},t.prototype.syncSubscriptions=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("apple-subscription/sync",{originalTransactionsIds:e},s)}):Promise.reject("Please, provide session storage")},t.prototype.syncAppsFlyer=function(e){return this.doPost("apple-subscription/sync-appsflyer",Z({},e))},t.prototype.getSubcriptionShortInfo=function(e,r){return console.warn("getSubcriptionShortInfo method deprecated use getSubscriptionShortInfo instead"),this.doGet("apple-subscription/subscription-short-info?originalTransactionId="+e+"&productId="+r)},t.prototype.getSubscriptionShortInfo=function(e,r){return this.doGet("apple-subscription/subscription-short-info?originalTransactionId="+e+"&productId="+r)},t.prototype.validateReciept=function(e){return this.doPost("apple-subscription/validate-reciept",{data:e})},t}(),Ih=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(Nr.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i){if(s===void 0&&(s=null),i===void 0&&(i=""),!this.server)throw new Error("No server url provided");return Cr(this.server.toString()+r,Z(Z({method:e},i?{headers:{Authorization:"Bearer "+i}}:{}),s?{body:JSON.stringify(Z({},s))}:{}))},t.prototype.doPost=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("POST",e,r,s)},t.prototype.doPatch=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("PATCH",e,r,s)},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.syncSubcriptions=function(e){var r=this;return console.warn("syncSubcriptions method deprecated use syncSubscriptions instead"),this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("google-subscription/sync",Z({},e),s)}):Promise.reject("Please, provide session storage")},t.prototype.syncSubscriptions=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("google-subscription/sync",Z({},e),s)}):Promise.reject("Please, provide session storage")},t.prototype.syncAppsFlyer=function(e){return this.doPost("google-subscription/sync-appsflyer",Z({},e))},t.prototype.cancelSubscription=function(e,r,s){var i=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(n){return i.doPost("google-subscription/cancel?packageName="+e+"&subscriptionId="+r+"&purchaseToken="+s,{subscriptionId:r},n)}):Promise.reject("Please, provide session storage")},t.prototype.getSubcriptionShortInfo=function(e){return console.warn("getSubcriptionShortInfo method deprecated use getSubscriptionShortInfo instead"),this.doGet("google-subscription/subscription-short-info?purchaseToken="+e)},t.prototype.getSubscriptionShortInfo=function(e){return this.doGet("google-subscription/subscription-short-info?purchaseToken="+e)},t}(),di;(function(t){t.PurchaseSubscription="PurchaseSub",t.PurchaseSubscriptionByEmail="PurchaseSubByEmail",t.PurchaseItem="PurchaseItem"})(di||(di={}));var Oh=function(){function t(){this.events={}}return t.prototype.addEventListener=function(e,r){if(this.events[e]){this.events[e].push(r);return}this.events[e]=[r]},t.prototype.removeEventListener=function(e,r){this.events[e]&&(this.events[e]=this.events[e].filter(function(s){return s!==r}))},t.prototype.fire=function(e,r){r===void 0&&(r=void 0),(this.events[e]||[]).forEach(function(s){return s(r)})},t}(),Oo;(function(t){t[t.InvalidRequestData=1e3]="InvalidRequestData",t[t.UserNotFound=1001]="UserNotFound",t[t.UserIsNotActive=1002]="UserIsNotActive",t[t.UserIsBanned=1003]="UserIsBanned",t[t.UserIsSoftDeleted=1004]="UserIsSoftDeleted",t[t.UserRemovedViaGDPR=1005]="UserRemovedViaGDPR",t[t.ExternalProviderError=1006]="ExternalProviderError",t[t.SubscriptionNotFound=1007]="SubscriptionNotFound",t[t.SubscriptionAlreadyAssignedToAnotherUser=1008]="SubscriptionAlreadyAssignedToAnotherUser",t[t.CaptchaValidationFailed=1009]="CaptchaValidationFailed",t[t.CaptchaScoreIsTooLow=1010]="CaptchaScoreIsTooLow",t[t.RecurlyInternalError=2e3]="RecurlyInternalError",t[t.RecurlyLogicError=2001]="RecurlyLogicError",t[t.RecurlyGiftCardPurchaseError=2002]="RecurlyGiftCardPurchaseError",t[t.RecurlySubscriptionPurchaseError=2003]="RecurlySubscriptionPurchaseError",t[t.UserAlreadyHasSubscription=2004]="UserAlreadyHasSubscription"})(Oo||(Oo={}));var hi,Mr;(function(t){t[t.v1=1]="v1"})(Mr||(Mr={}));var fi=(hi={},hi[Mr.v1]={captchaActions:di,recurlySubscriptions:new $h,googleSubscriptions:new Ih,appleSubscriptions:new Ah,generalSubscriptions:new Rh},hi),Ch=function(t){Io(e,t);function e(r){var s=t.call(this)||this;if(!r.server)throw new Error("Please, provide server Url");return s.server=r.server,s.sessionStorage=r.sessionStorage,s}return e.prototype.getApi=function(r){var s=this;return Object.keys(fi[r]).forEach(function(i){var n=fi[r][i];n.setServer&&n.setServer(s.server),n.setSessionStorage&&n.setSessionStorage(s.sessionStorage)}),Promise.resolve(fi[r])},e}(Oh);let Co=!1,No;function mi(){return Co}function Nh(t){Co=t}function pi(){return No}function Mh(t){No=t}function Dh(t,e){return!t||t[6]!=="_"?e:t==null?void 0:t.split(".").slice(0,-1).join(".")}function Jt(t,e){let s=Dh(t,"avatar_blank");const i=s.includes("premium"),n="https://arenacloud.cdn.arkadiumhosted.com/arenaxstorage-blob/arenax-index/_arena-shared-content_/arkadium-avatars/";let a=`${n}subscription/${e}/1x/${s}.${e}`;return i&&(a=`${n}subscription/${e}/1x/premium/${s}.${e}`),a}function Mo(t,e){const r="frame2",s=t==null?void 0:t.split(".").slice(0,-1).join(".");return`https://arenacloud.cdn.arkadiumhosted.com/arenaxstorage-blob/arenax-index/_arena-shared-content_/arkadium-frames/${e}/1x/${s||r}.${e}`}class Uh{constructor(e,r){this.backendApi=e,this.host=r,this.authStatus=lt(!1),this.paymentsApiGateway=null,this.gameList={games:{},developers:{}},this.authStatus=this.backendApi.authStatus}async init(){const e=this.backendApi.getPaymentsEndpoint();this.paymentsApiGateway=e?await new Ch({server:e,sessionStorage:this.backendApi.getSessionStorage()}).getApi(Mr.v1):null;try{const r=await fetch("https://developers.arkadium.com/cdn/sdk/games-list/list.json");this.gameList=await r.json()}catch{this.gameList={games:{},developers:{}}}}async isUserAuthorized(){return this.backendApi.isUserAuthorized()}async getUserProfile(){var s,i,n,a,u,o;if(mi()){const c=pi();return(c==null?void 0:c.profile)??null}const e=await((s=this.backendApi.user)==null?void 0:s.managment.getUserProfile());let r=[];try{r=await((i=this.paymentsApiGateway)==null?void 0:i.generalSubscriptions.getSubscriptions())||[]}catch(c){console.error(c),r=[]}if(e){if(this.backendApi.getBackendType()===Zr.EAGLE)return{uid:await this.processUserId(e.uid),username:e.name,avatar:{png:Jt(e.avatar||((n=e.subscriberAvatar)==null?void 0:n.avatar)||"","png"),webp:Jt(e.avatar||((a=e.subscriberAvatar)==null?void 0:a.avatar)||"","webp")},avatarFrame:{png:Mo(((u=e.subscriberAvatar)==null?void 0:u.frame)||"","png"),webp:Mo(((o=e.subscriberAvatar)==null?void 0:o.frame)||"","webp")},avatarBackground:e.avatarBackground||"",isUserSubscriber:(r||[]).length>0};{const c=e;return{uid:c.id,username:c.name,aarpMembershipStatus:c.aarpMembershipStatus==="ACTIVE",coins:c.coins||0,level:c.level||1,avatar:{png:Jt(c.avatar.replace("-","_")||"","png"),webp:Jt(c.avatar.replace("-","_")||"","webp")},isUserSubscriber:!1}}}return null}async processUserId(e){const r=await this.host.getGameId(),s=this.gameList.games[r],i=this.gameList.developers[s];return i?this.hashUserId(e,i):e}async hashUserId(e,r){try{const s=`${e}:${r}`,n=new TextEncoder().encode(s),a=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(a)).map(c=>c.toString(16).padStart(2,"0")).join("")}catch{return e}}}class jh{constructor(e,r){this.backendApi=e,this.rpcProvider=r,this.openAuthRequest=lt(!1),this.authFormStateChangedListenerRemover=()=>{},this.openAuthRequest=this.backendApi.uiOpenRequest,this.rpcProvider.rpcSubscriber.addToRegistry("AuthUIManager","openAuthForm",this,this.openAuthForm),this.rpcProvider.rpcSubscriber.addToRegistry("AuthUIManager","closeAuthForm",this,this.closeAuthForm),this.rpcProvider.rpcSubscriber.addToRegistry("AuthUIManager","subscribeToAuthFormStateChanged",this,this.subscribeToAuthFormStateChanged)}async openAuthForm(){this.backendApi.openAuthForm()}async closeAuthForm(){this.backendApi.closeAuthForm()}onOpenAuthForm(e){return this.openAuthRequest.subscribe(e)}subscribeToAuthFormStateChanged(){var r;const e=this.notifyAuthFormStateChanged.bind(this);(r=this.authFormStateChangedListenerRemover)==null||r.call(this),this.authFormStateChangedListenerRemover=this.onOpenAuthForm(e)}notifyAuthFormStateChanged(e){setTimeout(()=>{this.rpcProvider.rpcPublisher.sendMessage({module:"AuthUIManager",func:"onAuthFormStateChanged",payload:[e]})},1)}}class xh{constructor(e,r){this.backendApi=e,this.userProfileReader=new Uh(e,r)}async init(){await this.userProfileReader.init(),this.userId=void 0}async isUserAuthorized(){return this.userProfileReader.isUserAuthorized()}async getToken(){return this.backendApi.getAuthToken()}onAuthStatusChange(e){return this.userProfileReader.authStatus.subscribe(e)}async openAuthForm(){var e;(e=this.authUIManager)==null||e.openAuthForm()}async closeAuthForm(){var e;(e=this.authUIManager)==null||e.closeAuthForm()}onOpenAuthForm(e){var r;return(r=this.authUIManager)==null?void 0:r.onOpenAuthForm(e)}async getUserId(){if(!this.userId){const e=await this.getUserProfile();this.userId=e==null?void 0:e.uid}return this.userId}}class qh extends xh{constructor(e,r,s){super(e,r),this.authUIManager=new jh(e,s),s.rpcSubscriber.addToRegistry("Auth","getUserProfile",this,this.getUserProfile)}async getUserProfile(){return this.userProfileReader.getUserProfile()}}const Dr="2.55.0";class Do{constructor(e){this.config=e,this.isReady=!1,this.unsentEvents=[],this.unsentPageViews=[],this.unsentExceptions=[],this.setup().then(()=>{this.isReady=!0,this.handleUnsent()})}async setup(){}handleUnsent(){this.unsentEvents.forEach(([e,r,s])=>{this.sendEvent(e,r,s)}),this.unsentEvents.splice(0,this.unsentEvents.length),this.unsentPageViews.forEach(([e,r])=>{this.sendPageView(e,r)}),this.unsentPageViews.splice(0,this.unsentPageViews.length),this.unsentExceptions.forEach(e=>{this.trackException(e)}),this.unsentExceptions.splice(0,this.unsentExceptions.length)}sendEvent(e,r,s){if(!this.isReady){this.unsentEvents.push([e,r,s]);return}this.sendEventImpl(e,r,s),we()&&this.debugSendEvent(e,r,s)}sendPageView(e,r){if(!this.isReady){this.unsentPageViews.push([e,r]);return}this.sendPageViewImpl(e,r),we()&&this.debugSendPageView(e,r)}trackException(e){if(!this.isReady){this.unsentExceptions.push(e);return}this.trackExceptionImpl(e),we()&&this.debugTrackException(e)}debugSendEvent(e,r,s){console.log(`%c[${this.getProviderName()}Provider] sendEvent`,"background:green",e,r,s)}debugSendPageView(e,r){console.log(`%c[${this.getProviderName()}Provider] sendPageView`,"background:green",e,r)}debugTrackException(e){console.log(`%c[${this.getProviderName()}Provider] trackException`,"background:green",e)}getProviderType(){var e;return(e=this.config)==null?void 0:e.provider}}class Fh extends Do{getProviderName(){return"Console"}async setup(){}sendEventImpl(e,r,s){console.log("%c[ConsoleProvider] sendEvent","background:green",e,r,s)}sendPageViewImpl(e,r){console.log("%c[ConsoleProvider] sendPageView","background:green",e,r)}trackExceptionImpl(e){console.log("%c[ConsoleProvider] trackException","background:green",e)}debugSendEvent(e,r,s){}debugSendPageView(e,r){}debugTrackException(e){}}var Uo=(t=>(t.action="action",t.round="round",t.score="score",t.reason="reason",t.domain="domain",t.trafficSource="trafficSource",t.timespent="timespent",t.gameVersion="gameVersion",t.abtestVersion="abtestVersion",t.deviceType="deviceType",t.frameRate="frameRate",t.difficulty="difficulty",t.userType="userType",t.userID="userID",t.userSubscriptionId="userSubscriptionId",t.userSubscriptionPlan="userSubscriptionPlan",t.CD1="CD1",t.CD2="CD2",t.CD3="CD3",t.CD4="CD4",t.fpVisitorId="fpVisitorId",t.fpIncognito="fpIncognito",t))(Uo||{});async function Gh(t){const e=document.createElement("script");return e.async=!0,e.src=t,e.setAttribute("crossorigin","anonymous"),document.head.appendChild(e),new Promise(r=>e.addEventListener("load",()=>r()))}const Lh="https://arenacloud.cdn.arkadiumhosted.com/gamesfeeds-blob/remote-configs/appinsights-config/appinsights-config.json",zh=100;class Vh extends Do{getProviderName(){return"AppInsights"}async setup(){var a;let e=zh;const[r,s]=await Promise.all([this.fetchRemoteJson(),Gh("https://js.monitor.azure.com/scripts/b/ai.3.gbl.min.js")]),i=r.find(u=>u.instrumentationKey==this.config.appId);if(i){const u=window.location.hostname;e=i.defaultSamplingPercentage,i.selectedDomains.some(o=>o.includes(u))&&(e=i.selectedDomainsSamplingPercentage)}const n=((a=this.config)==null?void 0:a.providerConfig)||this.getDefaultConfig(this.config.appId);n.config.samplingPercentage=e,n.config.disableFetchTracking=!0,this._config=n,this.onceLoaded()}async fetchRemoteJson(){try{return await(await fetch(Lh)).json()}catch{return[]}}onceLoaded(){const e=window.Microsoft.ApplicationInsights.ApplicationInsights;this._aiTracker=new e(this._config),this._aiTracker.loadAppInsights()}validateProperties(e){if(we()||xa()!==se.PROD)for(const[i,n]of Object.entries(e)){i.length>150&&console.warn(`[AppInsightsProvider] Maximum analytics dimension's key length exceeded for key '${i}', expected up to 150, got ${i.length}.`);let a=0;(typeof n=="string"&&(a=n.length)>8192||(a=JSON.stringify(n).length)>8192)&&console.warn(`[AppInsightsProvider] Maximum analytics dimension's value length exceeded for key '${i}', expected up to 8192, got ${a}.`)}}sendEventImpl(e,r,s){const i={...s};r&&(i[Uo.action]=r),this.validateProperties(i),this._aiTracker.trackEvent({name:e,properties:i}),this._aiTracker.flush()}sendPageViewImpl(e,r){this.validateProperties(r),this._aiTracker.trackPageView({name:e,properties:r}),this._aiTracker.flush()}trackExceptionImpl(e){this._aiTracker.trackException({exception:e}),this._aiTracker.flush()}getDefaultConfig(e){const r=e+"_GameCore_AppInsights";return{config:{instrumentationKey:e,maxBatchInterval:0,overridePageViewDuration:!0,enableSessionStorageBuffer:!1,disableAjaxTracking:!0,disableExceptionTracking:!0,disableCorrelationHeaders:!0,disableDataLossAnalysis:!0,disableFetchTracking:!0,namePrefix:r}}}}var Ke=(t=>(t[t.CONSOLE=1]="CONSOLE",t[t.GOOGLE=2]="GOOGLE",t[t.APP_INSIGHTS=3]="APP_INSIGHTS",t[t.APP_INSIGHTS_SDK=300]="APP_INSIGHTS_SDK",t[t.ALL=1e3]="ALL",t))(Ke||{});const jo="Analytics";class Jh{constructor(e,r,s,i){this.host=e,this.rpcProvider=r,this.debugProvider=s,this.arenaEnvironment=i,this.providers=[],this.configuredProviders=new Set,this.disabledProviders=new Set,this.info={gameVersion:"",nestVersion:""},this.providersTypes=Ke,["AnalyticsApi",jo].forEach(n=>{this.rpcProvider.rpcSubscriber.addToRegistry(n,"setGameVersion",this,this.setGameVersion),this.rpcProvider.rpcSubscriber.addToRegistry(n,"setNestVersion",this,this.setNestVersion),this.rpcProvider.rpcSubscriber.addToRegistry(n,"getEnvVersion",this,this.getEnvVersion),this.rpcProvider.rpcSubscriber.addToRegistry(n,"sendGameSDKInitEvent",this,this.sendGameSDKInitEvent),this.rpcProvider.rpcSubscriber.addToRegistry(n,"configureProvider",this,this.configureProvider),this.rpcProvider.rpcSubscriber.addToRegistry(n,"sendEvent",this,this.sendEvent),this.rpcProvider.rpcSubscriber.addToRegistry(n,"sendPageView",this,this.sendPageView),this.rpcProvider.rpcSubscriber.addToRegistry(n,"trackException",this,this.trackException)})}async getEnvVersion(){return{GameKey:await this.host.getGameId(),GameVersion:this.info.gameVersion,NestVersion:this.info.nestVersion,SdkVersion:Dr}}async setGameVersion(e){this.info.gameVersion=e}async setNestVersion(e){this.info.nestVersion=e}async sendGameSDKInitEvent(e){}async configureProvider(e){if(e.provider===Ke.GOOGLE){console.error("Analytics Google Provider not supported");return}if(this.configuredProviders.has(e.provider))throw new Error("Provider already configured");let r;switch(e.provider){case Ke.CONSOLE:r=new Fh(e);break;case Ke.APP_INSIGHTS:case Ke.APP_INSIGHTS_SDK:r=new Vh(e);break;default:throw new Error("Unsupported provider")}this.providers.push(r),this.configuredProviders.add(e.provider)}async sendEvent(e,r,s){if(!this.disabledProviders.has(Ke.ALL)){this.debugProvider.sendDebugEvent("analyticsSendEvent",e,r,s);for(const i of this.providers)this.disabledProviders.has(i.getProviderType())||i.sendEvent(e,r,s)}}async sendPageView(e,r){if(!this.disabledProviders.has(Ke.ALL)){this.debugProvider.sendDebugEvent("analyticsSendPageView",e,r);for(const s of this.providers)this.disabledProviders.has(s.getProviderType())||s.sendPageView(e,r)}}async trackException(e){var r,s;if(e)try{this.debugProvider.sendDebugEvent("analyticsTrackException",e),e.name=`[game.error] ${e.name||"Error"}`,(s=(r=window.__RUM__)==null?void 0:r.captureException)==null||s.call(r,JSON.stringify(e,Object.getOwnPropertyNames(e)),{tags:{"game.error":"true"}})}catch(i){console.warn("Failed to track exception:",i)}}setFingerprintData(e){return this.rpcProvider.rpcPublisher.sendMessage({module:jo,func:"setFingerprintData",payload:[e]})}enableProvider(e){this.disabledProviders.delete(e)}disableProvider(e){this.disabledProviders.add(e)}clearProviders(){this.providers.length=0,this.configuredProviders.clear(),this.disabledProviders.clear()}}class Bh{constructor(){this.$ping=lt(0),Be.Instance.rpcSubscriber.addToRegistry("PingModule","ping",this,this.ping)}ping(){return this.$ping.update(Date.now()),!0}}class Kh{ping(){return Be.Instance.rpcPublisher.sendMessage({module:"PingModule",func:"ping",payload:[]})}}async function Hh(t){return new Promise(e=>{setTimeout(()=>e({}),t*1e3)})}class Wh{constructor(e){e.rpcSubscriber.addToRegistry("TimeoutTester","timeout",this,this.timeout)}async timeout(){await Hh(20*1e3)}}var xo={};(function(t){(function(e){e([],function(){var r=-1,s=-2,i=-3,n=-4,a=-5,u=function(_,w){w=w||{};var y=w.verbose||!1;y&&console.log("Normalize the JSON Object"),_=typeof _=="string"?this.JSON.parse(_):_,y&&console.log("Creating a empty dictionary");var f={strings:[],integers:[],floats:[]};y&&console.log("Creating the AST");var v=function L(U){y&&console.log("Calling recursiveAstBuilder with "+this.JSON.stringify(U));var B=typeof U;if(U===null)return{type:"null",index:i};if(typeof U>"u")return{type:"undefined",index:a};if(U instanceof Array){var te=["@"];for(var W in U)U.hasOwnProperty(W)&&te.push(L(U[W]));return te}if(B==="object"){var te=["$"];for(var C in U)U.hasOwnProperty(C)&&(te.push(L(C)),te.push(L(U[C])));return te}if(U==="")return{type:"empty",index:n};if(B==="string"){var D=g.call(f.strings,U);return D==-1&&(f.strings.push(c(U)),D=f.strings.length-1),{type:"strings",index:D}}if(B==="number"&&U%1===0){var D=g.call(f.integers,U);return D==-1&&(f.integers.push(d(U)),D=f.integers.length-1),{type:"integers",index:D}}if(B==="number"){var D=g.call(f.floats,U);return D==-1&&(f.floats.push(U),D=f.floats.length-1),{type:"floats",index:D}}if(B==="boolean")return{type:"boolean",index:U?r:s};throw new Error("Unexpected argument of type "+typeof U)}(_),E=f.strings.length,$=f.integers.length;f.floats.length,y&&console.log("Parsing the dictionary");var I=f.strings.join("|");return I+="^"+f.integers.join("|"),I+="^"+f.floats.join("|"),y&&console.log("Parsing the structure"),I+="^"+function L(U){if(y&&console.log("Calling a recursiveParser with "+this.JSON.stringify(U)),U instanceof Array){var B=U.shift();for(var te in U)U.hasOwnProperty(te)&&(B+=L(U[te])+"|");return(B[B.length-1]==="|"?B.slice(0,-1):B)+"]"}var W=U.type,C=U.index;if(W==="strings")return d(C);if(W==="integers")return d(E+C);if(W==="floats")return d(E+$+C);if(W==="boolean")return U.index;if(W==="null")return i;if(W==="undefined")return a;if(W==="empty")return n;throw new TypeError("The item is alien!")}(v),y&&console.log("Ending parser"),w.debug?{dictionary:f,ast:v,packed:I}:I},o=function(_,w){w=w||{};var y=_.split("^");w.verbose&&console.log("Building dictionary");var f=[],v=y[0];if(v!==""){v=v.split("|"),w.verbose&&console.log("Parse the strings dictionary");for(var E=0,$=v.length;E<$;E++)f.push(l(v[E]))}if(v=y[1],v!==""){v=v.split("|"),w.verbose&&console.log("Parse the integers dictionary");for(var E=0,$=v.length;E<$;E++)f.push(m(v[E]))}if(v=y[2],v!==""){v=v.split("|"),w.verbose&&console.log("Parse the floats dictionary");for(var E=0,$=v.length;E<$;E++)f.push(parseFloat(v[E]))}v=null,w.verbose&&console.log("Tokenizing the structure");for(var I="",L=[],U=y[3].length,E=0;E<U;E++){var B=y[3].charAt(E);B==="|"||B==="$"||B==="@"||B==="]"?(I&&(L.push(m(I)),I=""),B!=="|"&&L.push(B)):I+=B}var te=L.length,W=0;return w.verbose&&console.log("Starting recursive parser"),function C(){var D=L[W++];if(w.verbose&&console.log("Reading collection type "+(D==="$"?"object":"Array")),D==="@"){for(var F=[];W<te;W++){var x=L[W];if(w.verbose&&console.log("Read "+x+" symbol"),x==="]")return F;if(x==="@"||x==="$")F.push(C());else switch(x){case r:F.push(!0);break;case s:F.push(!1);break;case i:F.push(null);break;case a:F.push(void 0);break;case n:F.push("");break;default:F.push(f[x])}}return w.verbose&&console.log("Parsed "+this.JSON.stringify(F)),F}if(D==="$"){for(var F={};W<te;W++){var H=L[W];if(H==="]")return F;H===n?H="":H=f[H];var x=L[++W];if(x==="@"||x==="$")F[H]=C();else switch(x){case r:F[H]=!0;break;case s:F[H]=!1;break;case i:F[H]=null;break;case a:F[H]=void 0;break;case n:F[H]="";break;default:F[H]=f[x]}}return w.verbose&&console.log("Parsed "+this.JSON.stringify(F)),F}throw new TypeError("Bad token "+D+" isn't a type")}()},c=function(_){return typeof _!="string"?_:_.replace(/[\+ \|\^\%]/g,function(w){return{" ":"+","+":"%2B","|":"%7C","^":"%5E","%":"%25"}[w]})},l=function(_){return typeof _!="string"?_:_.replace(/\+|%2B|%7C|%5E|%25/g,function(w){return{"+":" ","%2B":"+","%7C":"|","%5E":"^","%25":"%"}[w]})},d=function(_){return Number.prototype.toString.call(_,36).toUpperCase()},m=function(_){return parseInt(_,36)},g=Array.prototype.indexOf||function(_,w){for(var y=w||0,f=this.length;y<f;y++)if(this[y]===_)return y;return-1};return{JSON,pack:u,unpack:o}})})(function(e,r){var s=r();for(var i in s)t[i]=s[i]})})(xo);const qo=es(xo),Ur="Persistence";class Xh{constructor(e,r){this.debugProvider=r;try{this.ls=window.localStorage}catch{this.ls=window.sessionStorage}e.rpcSubscriber.addToRegistry(Ur,"getLocalStorageItem",this,this.getLocalStorageItem),e.rpcSubscriber.addToRegistry(Ur,"setLocalStorageItem",this,this.setLocalStorageItem),e.rpcSubscriber.addToRegistry(Ur,"removeLocalStorageItem",this,this.removeLocalStorageItem),e.rpcSubscriber.addToRegistry(Ur,"getCookie",this,this.getCookie),e.rpcSubscriber.addToRegistry("LocalStorage","getItem",this,this.getLocalStorageItem),e.rpcSubscriber.addToRegistry("LocalStorage","setItem",this,this.setLocalStorageItem),e.rpcSubscriber.addToRegistry("LocalStorage","removeItem",this,this.removeLocalStorageItem),e.rpcSubscriber.addToRegistry("CookieStorage","GetKey",this,this.getCookie)}getCookie(e){const r=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));return r?Promise.resolve(r[2]):Promise.resolve("")}getLocalStorageItem(e){return this.debugProvider.sendDebugEvent("getLocalStorageItem",e),this.ls.getItem(e)}setLocalStorageItem(e,r){return this.debugProvider.sendDebugEvent("setLocalStorageItem",e,r),this.ls.setItem(e,r)}removeLocalStorageItem(e){return this.debugProvider.sendDebugEvent("removeLocalStorageItem",e),this.ls.removeItem(e)}}var gi=function(t,e){return gi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i])},gi(t,e)};function Bt(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");gi(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var ee=function(){return ee=Object.assign||function(e){for(var r,s=1,i=arguments.length;s<i;s++){r=arguments[s];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ee.apply(this,arguments)};function Qh(t,e,r,s){function i(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function u(l){try{c(s.next(l))}catch(d){a(d)}}function o(l){try{c(s.throw(l))}catch(d){a(d)}}function c(l){l.done?n(l.value):i(l.value).then(u,o)}c((s=s.apply(t,[])).next())})}function Yh(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,i,n,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(c){return function(l){return o([c,l])}}function o(c){if(s)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(r=0)),r;)try{if(s=1,i&&(n=c[0]&2?i.return:c[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,c[1])).done)return n;switch(i=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){r.label=c[1];break}if(c[0]===6&&r.label<n[1]){r.label=n[1],n=c;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(c);break}n[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(l){c=[6,l],i=0}finally{s=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var Zh=["POST","PATCH"],rt=function(t,e){return e=e||{},e.headers=e.headers||{"Content-Type":"application/json"},!e.headers["Content-Type"]&&Zh.indexOf(e.method.toUpperCase())!==-1&&(e.headers["Content-Type"]="application/json"),fetch(t,e).then(function(r){return r.text().then(function(s){var i;try{i=JSON.parse(s)}catch{}if(r.status>=200&&r.status<300)return i||s;var n=new ef(r);throw i&&(i=Array.isArray(i)?i[0]:i),n.body=i||s,n})})},ef=function(t){Bt(e,t);function e(r){var s=t.call(this,"".concat(r.status," - ").concat(r.statusText," for ").concat(r.url))||this;return s.name="HttpError",s.response=r,s}return e}(Error),Kt;(function(t){t.ACCESS_TOKEN="eagle-access-token",t.REFRESH_TOKEN="eagle-refresh-token",t.EXPIRES_IN="eagle-expires_in"})(Kt||(Kt={}));var st=function(){function t(){this.AccessToken="",this.RefreshToken="",this.ExpiresIn=0}return t.prototype.update=function(e){this.AccessToken=e.AccessToken,this.RefreshToken=e.RefreshToken,this.ExpiresIn=e.ExpiresIn},t.fromV1=function(e){var r=new t;return r.AccessToken=e.access_token,r.RefreshToken=e.refresh_token,r.ExpiresIn=e.expires_in,r},t.fromV2=function(e){var r=new t;return r.AccessToken=e.access_toOOOOOOKEN,r.RefreshToken=e.refresh_tOOOOOOOoken,r.ExpiresIn=e.expires_inOOOOOOOOOO,r},t.fromStorage=function(e){return Qh(this,void 0,void 0,function(){var r,s,i,n,a;return Yh(this,function(u){switch(u.label){case 0:return r=new t,s=r,[4,e.getItem(Kt.ACCESS_TOKEN)];case 1:return s.AccessToken=u.sent()||"",i=r,[4,e.getItem(Kt.REFRESH_TOKEN)];case 2:return i.RefreshToken=u.sent()||"",n=r,a=parseInt,[4,e.getItem(Kt.EXPIRES_IN)];case 3:return n.ExpiresIn=a.apply(void 0,[u.sent()||"0",10]),[2,r]}})})},t}(),tf=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(st.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i){if(s===void 0&&(s=null),i===void 0&&(i=""),!this.server)throw new Error("No server url provided");return rt(this.server.toString()+r,ee(ee({method:e},i?{headers:{Authorization:"Bearer ".concat(i)}}:{}),s?{body:JSON.stringify(ee({},s))}:{}))},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.getVirtualItemList=function(e){return this.doGet("virtual-item/?gameKeyFilter=".concat(e))},t.prototype.getVirtualItem=function(e){return this.doGet("virtual-item/".concat(e))},t.prototype.getCategoryList=function(e){return this.doGet("virtual-item-category/?gameKeyFilter=".concat(e))},t}(),rf=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(st.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i){if(s===void 0&&(s=null),i===void 0&&(i=""),!this.server)throw new Error("No server url provided");return rt(this.server.toString()+r,ee(ee({method:e},i?{headers:{Authorization:"Bearer ".concat(i)}}:{}),s?{body:JSON.stringify(ee({},s))}:{}))},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.doPost=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("POST",e,r,s)},t.prototype.getUserInventory=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doGet("user-inventory/?gameKeyFilter=".concat(e),s)}):Promise.reject("Please, provide session storage")},t.prototype.getUserInventoryItem=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doGet("user-inventory/".concat(e),s)}):Promise.reject("Please, provide session storage")},t.prototype.issueUserInventory=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("user-inventory/issue",e,s)}):Promise.reject("Please, provide session storage")},t.prototype.consumeUserInventory=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("user-inventory/consume",e,s)}):Promise.reject("Please, provide session storage")},t.prototype.restoreUserInventoryRestorable=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("user-inventory/restorable/restore",e,s)}):Promise.reject("Please, provide session storage")},t.prototype.consumeUserInventoryRestorable=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("user-inventory/restorable/consume",e,s)}):Promise.reject("Please, provide session storage")},t.prototype.getUserInventoryTransaction=function(e,r,s){var i=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(n){return i.doGet("user-inventory-transaction/?gameKeyFilter=".concat(s,"&skip=").concat(e,"&take=").concat(r),n)}):Promise.reject("Please, provide session storage")},t}(),it="user-collection",sf=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(st.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i){if(s===void 0&&(s=null),i===void 0&&(i=""),!this.server)throw new Error("No server url provided");return rt(this.server.toString()+r,ee(ee({method:e},i?{headers:{Authorization:"Bearer ".concat(i)}}:{}),s?{body:JSON.stringify(ee({},s))}:{}))},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.doPost=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("POST",e,r,s)},t.prototype.getUserCollections=function(e){var r=this,s=e.gameKey;return this.sessionStorage?this.sessionStorage.getToken().then(function(i){return r.doGet("".concat(it,"/?gameKey=").concat(s),i)}):Promise.reject("Please, provide session storage")},t.prototype.getUserCollection=function(e){var r=this,s=e.sku;return this.sessionStorage?this.sessionStorage.getToken().then(function(i){return r.doGet("".concat(it,"/").concat(s),i)}):Promise.reject("Please, provide session storage")},t.prototype.issueUserCollection=function(e){var r=this,s=e.gameKey,i=e.application,n=e.timeOffset;return this.sessionStorage?this.sessionStorage.getToken().then(function(a){return r.doPost("".concat(it,"/issue"),{gameKey:s,application:i,timeOffset:n},a)}):Promise.reject("Please, provide session storage")},t.prototype.issueAnonymousUserCollection=function(e){return this.doPost("".concat(it,"/issue-anonymous"),e)},t.prototype.synchronizeAnonymous=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("".concat(it,"/synchronize-anonymous"),e,s)}):Promise.reject("Please, provide session storage")},t.prototype.getDiscoveredList=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doGet("".concat(it,"/stats/discovered-list?skip=").concat(e.skip,"&take=").concat(e.take),s)}):Promise.reject("Please, provide session storage")},t.prototype.getUndiscoveredList=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doGet("".concat(it,"/stats/undiscovered-list?skip=").concat(e.skip,"&take=").concat(e.take),s)}):Promise.reject("Please, provide session storage")},t}(),nf=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(st.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i){if(s===void 0&&(s=null),i===void 0&&(i=""),!this.server)throw new Error("No server url provided");return rt(this.server.toString()+r,ee(ee({method:e},i?{headers:{Authorization:"Bearer ".concat(i)}}:{}),s?{body:JSON.stringify(ee({},s))}:{}))},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.getCollectionList=function(e){return this.doGet("collection/?gameKeyFilter=".concat(e))},t.prototype.getCollection=function(e){return this.doGet("collection/".concat(e))},t}(),jr="purchasable-item",of="user-purchasable-item-transaction",af=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(st.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i){if(s===void 0&&(s=null),i===void 0&&(i=""),!this.server)throw new Error("No server url provided");return rt(this.server.toString()+r,ee(ee({method:e},i?{headers:{Authorization:"Bearer ".concat(i)}}:{}),s?{body:JSON.stringify(ee({},s))}:{}))},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.doPost=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("POST",e,r,s)},t.prototype.getPurchasableItemsByGame=function(e){var r=e.gameKeyFilter;return this.doGet("".concat(jr,"/?gameKeyFilter=").concat(r))},t.prototype.getPurchasableItemsBySkuList=function(e){var r=e.skuList;return this.doGet("".concat(jr,"/list?").concat(r.map(function(s){return"skus[]=".concat(encodeURIComponent(s))}).join("&")))},t.prototype.getPurchasableItem=function(e){var r=e.sku;return this.doGet("".concat(jr,"/").concat(r))},t.prototype.purchaseItem=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doPost("".concat(jr,"/purchase"),e,s)}):Promise.reject("Please, provide session storage")},t.prototype.getUserPurchasableItemTransaction=function(e){var r=this;if(!this.sessionStorage)return Promise.reject("Please, provide session storage");var s=new URLSearchParams;return s.set("skip",e.skip.toString()),s.set("take",e.take.toString()),e.skus&&e.skus.length&&e.skus.forEach(function(i){return s.append("skus[]",i)}),e.gameKeyFilter&&s.set("gameKeyFilter",e.gameKeyFilter),e.dateStartFilter&&s.set("dateStartFilter",e.dateStartFilter),e.dateEndFilter&&s.set("dateStartFilter",e.dateEndFilter),e.includeOnlyItemsWithActiveCampaigns&&s.set("includeOnlyItemsWithActiveCampaigns","true"),this.sessionStorage.getToken().then(function(i){return r.doGet("".concat(of,"?").concat(s.toString()),i)})},t}(),yi=function(){function t(){}return t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(st.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i){if(s===void 0&&(s=null),i===void 0&&(i=""),!this.server)throw new Error("No server url provided");return rt(this.server.toString()+r,ee(ee({method:e},i?{headers:{Authorization:"Bearer ".concat(i)}}:{}),s?{body:JSON.stringify(ee({},s))}:{}))},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.doPost=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("POST",e,r,s)},t.prototype.doPatch=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("PATCH",e,r,s)},t}(),uf=function(t){Bt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.setServer=function(r){if(!r)throw new Error("Please, provide server Url");this.server=r},e.prototype.setSessionStorage=function(r){this.sessionStorage=r},e.prototype.participateInOnlyOnceEvent=function(r){var s=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(i){return s.doPost("user-only-once-event/".concat(r),{key:r},i)}):Promise.reject("Please, provide session storage")},e}(yi),_i="daily-reward",cf=function(t){Bt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.setServer=function(r){if(!r)throw new Error("Please, provide server Url");this.server=r},e.prototype.setSessionStorage=function(r){this.sessionStorage=r},e.prototype.get=function(r){var s=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(i){return s.doGet("".concat(_i,"/").concat(r),i)}):Promise.reject("Please, provide session storage")},e.prototype.getUserReward=function(r,s){var i=this;return this.sessionStorage?(s=this.checkTimeOffsetOrDefault(s),this.sessionStorage.getToken().then(function(n){return i.doGet("".concat(_i,"/user/").concat(r,"?timeOffset=").concat(s),n)})):Promise.reject("Please, provide session storage")},e.prototype.issueRewardToUser=function(r){var s=this;return this.sessionStorage?(r.timeOffset=this.checkTimeOffsetOrDefault(r.timeOffset),this.sessionStorage.getToken().then(function(i){return s.doPost("".concat(_i,"/user"),r,i)})):Promise.reject("Please, provide session storage")},e.prototype.checkTimeOffsetOrDefault=function(r){return r&&Number.isInteger(r)?r:new Date().getTimezoneOffset()},e}(yi),xr="daily-mission",lf=function(t){Bt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.setServer=function(r){if(!r)throw new Error("Please, provide server Url");this.server=r},e.prototype.setSessionStorage=function(r){this.sessionStorage=r},e.prototype.getList=function(r,s){var i=this;if(!this.sessionStorage)return Promise.reject("Please, provide session storage");s=this.checkTimeOffsetOrDefault(s);var n="".concat(xr,"?groupKey=").concat(r,"&timeOffset=").concat(s);return this.sessionStorage.getToken().then(function(a){return i.doGet(n,a)})},e.prototype.getUserProgressList=function(r,s){var i=this;if(!this.sessionStorage)return Promise.reject("Please, provide session storage");s=this.checkTimeOffsetOrDefault(s);var n="".concat(xr,"/user-progress?groupKey=").concat(r,"&timeOffset=").concat(s);return this.sessionStorage.getToken().then(function(a){return i.doGet(n,a)})},e.prototype.updateUserProgress=function(r,s){var i=this;if(!this.sessionStorage)return Promise.reject("Please, provide session storage");s.timeOffset=this.checkTimeOffsetOrDefault(s.timeOffset);var n="".concat(xr,"/user-progress/").concat(r);return this.sessionStorage.getToken().then(function(a){return i.doPatch(n,s,a)})},e.prototype.claimUserReward=function(r,s){var i=this;if(!this.sessionStorage)return Promise.reject("Please, provide session storage");s=this.checkTimeOffsetOrDefault(s);var n="".concat(xr,"/user-progress/").concat(r,"/claim-reward");return this.sessionStorage.getToken().then(function(a){return i.doPatch(n,{timeOffset:s},a)})},e.prototype.checkTimeOffsetOrDefault=function(r){return r&&Number.isInteger(r)?r:new Date().getTimezoneOffset()},e}(yi),df=function(){function t(){this.events={}}return t.prototype.addEventListener=function(e,r){if(this.events[e]){this.events[e].push(r);return}this.events[e]=[r]},t.prototype.removeEventListener=function(e,r){this.events[e]&&(this.events[e]=this.events[e].filter(function(s){return s!==r}))},t.prototype.fire=function(e,r){r===void 0&&(r=void 0),(this.events[e]||[]).forEach(function(s){return s(r)})},t}(),Fo="user-virtual-currency",hf=function(){function t(){}return t.prototype.setServer=function(e){if(!e)throw new Error("Please, provide server Url");this.server=e},t.prototype.setSessionStorage=function(e){this.sessionStorage=e},t.prototype.saveCredential=function(e){this.sessionStorage&&this.sessionStorage.update(st.fromV1(e))},t.prototype.makeRequest=function(e,r,s,i){if(s===void 0&&(s=null),i===void 0&&(i=""),!this.server)throw new Error("No server url provided");return rt(this.server.toString()+r,ee(ee({method:e},i?{headers:{Authorization:"Bearer ".concat(i)}}:{}),s?{body:JSON.stringify(ee({},s))}:{}))},t.prototype.doGet=function(e,r){return r===void 0&&(r=""),this.makeRequest("GET",e,null,r)},t.prototype.doPost=function(e,r,s){return s===void 0&&(s=""),this.makeRequest("POST",e,r,s)},t.prototype.getVirtualCurrency=function(){var e=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(r){return e.doGet("".concat(Fo,"/"),r)}):Promise.reject("Please, provide session storage")},t.prototype.getVirtualCurrencyBySku=function(e){var r=this;return this.sessionStorage?this.sessionStorage.getToken().then(function(s){return r.doGet("".concat(Fo,"/").concat(e),s)}):Promise.reject("Please, provide session storage")},t.prototype.getVirtualCurrencyTransactions=function(e){var r=this,s="user-virtual-currency-transaction";return this.sessionStorage?this.sessionStorage.getToken().then(function(i){return r.doGet("".concat(s,"/?sku=").concat(e.sku,"&skip=").concat(e.skip,"&take=").concat(e.take),i)}):Promise.reject("Please, provide session storage")},t}(),Go;(function(t){t[t.InvalidRequestData=1e3]="InvalidRequestData",t[t.UserNotFound=1001]="UserNotFound",t[t.UserIsNotActive=1002]="UserIsNotActive",t[t.UserIsBanned=1003]="UserIsBanned",t[t.UserIsSoftDeleted=1004]="UserIsSoftDeleted",t[t.UserRemovedViaGDPR=1005]="UserRemovedViaGDPR",t[t.ExternalProviderError=1006]="ExternalProviderError",t[t.SubscriptionNotFound=1007]="SubscriptionNotFound",t[t.SubscriptionAlreadyAssignedToAnotherUser=1008]="SubscriptionAlreadyAssignedToAnotherUser",t[t.RecurlyInternalError=2e3]="RecurlyInternalError",t[t.RecurlyLogicError=2001]="RecurlyLogicError",t[t.RecurlyGiftCardPurchaseError=2002]="RecurlyGiftCardPurchaseError",t[t.RecurlySubscriptionPurchaseError=2003]="RecurlySubscriptionPurchaseError",t[t.UserAlreadyHasSubscription=2004]="UserAlreadyHasSubscription"})(Go||(Go={}));var vi,qr;(function(t){t[t.v1=1]="v1"})(qr||(qr={}));var Fr=(vi={},vi[qr.v1]={virtualItems:new tf,userInventory:new rf,userCollection:new sf,collection:new nf,purchasableItems:new af,virtualCurrency:new hf,onlyOnceEvent:new uf,dailyReward:new cf,dailyMission:new lf},vi),ff=function(t){Bt(e,t);function e(r){var s=t.call(this)||this;if(!r.server)throw new Error("Please, provide server Url");return s.server=r.server,s.sessionStorage=r.sessionStorage,s}return e.prototype.getApi=function(r){var s=this;return Object.keys(Fr[r]).forEach(function(i){Fr[r][i].setServer(s.server),Fr[r][i].setSessionStorage(s.sessionStorage)}),Promise.resolve(Fr[r])},e}(df);const wi="Wallet";var Lo=(t=>(t.DEV="pseudo-coins",t.PROD="gems_prod",t))(Lo||{}),zo=(t=>(t.DEV="https://eagle-virtual-item-api-dev.arkadiumhosted.com/",t.PROD="https://eagle-virtual-item-api-prod.arkadiumhosted.com/",t))(zo||{});class mf{constructor(e,r,s){this.backendApi=e,this.lifecycle=r,this.virtualItemsApi=null,this.virtualItemGateway=null,this.currencySku="",this.isInited=!1,this._isGemsSupported=!0,s.rpcSubscriber.addToRegistry(wi,"getGems",this,this.getGems),s.rpcSubscriber.addToRegistry(wi,"consumeGems",this,this.consumeGems),s.rpcSubscriber.addToRegistry(wi,"isGemsSupported",this,this.isGemsSupported)}async init(e){e===se.STAGING&&(e=se.PROD),this.currencySku=Lo[e],this.virtualItemGateway=new ff({server:new URL(zo[e]),sessionStorage:this.backendApi.getSessionStorage()}),this.virtualItemsApi=await this.virtualItemGateway.getApi(qr.v1),this.isInited=!0}setGemsSupported(e){this._isGemsSupported=e}isGemsSupported(){return this._isGemsSupported&&this.isInited}async getGems(){if(mi()){const e=pi();return(e==null?void 0:e.wallet.getGems())??0}if(!this.isInited)throw new Error("Wallet service is unavailable!");if(!this.backendApi.isUserAuthorized())throw new Error("User not authenticated. Please login before using wallet APIs.");if(!this.isGemsSupported())throw new Error("Gems are not supported!");if(this.virtualItemsApi){const e=await this.virtualItemsApi.virtualCurrency.getVirtualCurrencyBySku(this.currencySku);if(e)return e.amount}return 0}async consumeGems(e){if(mi()){const r=pi();return(r==null?void 0:r.wallet.consumeGems(e))||!1}if(!this.isInited)throw new Error("Wallet service is unavailable!");if(!this.backendApi.isUserAuthorized())throw new Error("User not authenticated. Please login before using wallet APIs.");if(!this.isGemsSupported())throw new Error("Gems are not supported!");if(this.virtualItemsApi)try{const r=await this.virtualItemsApi.userInventory.consumeUserInventory({items:[{sku:this.currencySku,amount:e}]});if(r!=null&&r[0])return this.lifecycle.onEvent(this.lifecycle.LifecycleEvent.GEMS_UPDATE),!0}catch(r){console.error(r)}return!1}}class bi{constructor(){this.__cloudMeta__={__version:1},this.data=null}clone(e){const r=new bi;return Object.assign(r,e),r}}const pf=new Error("save is outdated, please manually sync save from cloud");class gf{async pack(e){return qo.pack(e)}async unpack(e){return(e||"").trim().length===0?null:qo.unpack(e)}}const yf=32*1024;class _f{constructor(){try{this.ls=window.localStorage}catch{this.ls=window.sessionStorage}}async getItem(e){return this.ls.getItem(e)}async setItem(e,r){return this.ls.setItem(e,r)}async removeItem(e){return this.ls.removeItem(e)}}class vf{constructor(e,r,s){this.backendApi=e,this.host=r,this.rpcProvider=s,this.knownStates={},this.serializer=new gf,this.useGameSerializer=!1,this.ls=new _f,this.rpcProvider.rpcSubscriber.addToRegistry("GameState","saveGameState",this,this.saveGameState),this.rpcProvider.rpcSubscriber.addToRegistry("GameState","loadGameState",this,this.loadGameState),this.rpcProvider.rpcSubscriber.addToRegistry("GameState","useSerializer",this,this.useSerializer)}async getGameId(){return this.host.getGameId()}async packData(e){return this.useGameSerializer?this.rpcProvider.rpcPublisher.sendMessage({module:"GameStateApi",func:"customPack",payload:[e]}):this.serializer.pack(e)}async unpackData(e=""){return this.useGameSerializer?this.rpcProvider.rpcPublisher.sendMessage({module:"GameStateApi",func:"customUnpack",payload:[e]}):await this.serializer.unpack(e)}isUserAuthorized(){return this.backendApi.isUserAuthorized()}getStorageKey(e,r){return`game-state-${e}-${r}`}useSerializer(e){this.useGameSerializer=e}setSerializer(e){this.serializer=e}async loadGameState(e){const r=await this.loadData(e);return{cloud:await this.unpackData(r.cloud).catch(s=>(console.error("unpacking cloud save error",s),null)),local:await this.unpackData(r.local).catch(s=>(console.error("unpacking local save error",s),null))}}async loadData(e){var a;const r=await this.getGameId(),s=this.getStorageKey(r,e),i=await this.ls.getItem(s);let n="";if(this.isUserAuthorized()){const u=await((a=this.backendApi.getUserGameData())==null?void 0:a.get(r,e));u&&(n=u.value||"",this.knownStates[s]=u.etag??"")}return{local:i??"",cloud:n??""}}async isStateOutdated(e,r){const s=this.getStorageKey(e,r),i=this.knownStates[s];return!!await this.loadData(r)&&i!==this.knownStates[s]}async saveGameState(e,r){const s=await this.getGameId();if(await this.isStateOutdated(s,e))throw pf;const n=new bi().clone(r);++n.__cloudMeta__.__version;const a=await this.packData(n);a.length>yf||a&&await this.saveDataToStorage(s,e,a)}async saveDataToStorage(e,r,s){var n;const i=this.getStorageKey(e,r);if(this.isUserAuthorized()){const a=await((n=this.backendApi.getUserGameData())==null?void 0:n.save(e,r,{etag:this.knownStates[i]||"",value:s}));this.knownStates[i]=a??""}else await this.ls.setItem(i,s)}}class wf{constructor(e,r,s){this.rpcProvider=e,this.gameState=new vf(r,s,e)}}function Ht(t,e){var r,s;return e=e||{},e.headers=e.headers||new Headers,(s=(r=e.headers).set)==null||s.call(r,"Content-type","application/json"),fetch(t,e).then(i=>i.text().then(n=>{let a=JSON.parse(n);if(i.status>=200&&i.status<300)return a||n;const u=new bf(i);throw a&&(a=Array.isArray(a)?a[0]:a),u.body=a||n,u}))}class bf extends Error{constructor(e){super(`${e.status} - ${e.statusText} for ${e.url}`),this.name="HttpError",this.response=e}}const Gr="Leaderboard";var Vo=(t=>(t.DEV="https://arenacloud.cdn.arkadiumhosted.com/uup-api-score-dev/api/v1/score/",t.PROD="https://arenacloud.cdn.arkadiumhosted.com/uup-api-score-prod/api/v1/score/",t))(Vo||{}),Jo=(t=>(t.DEV="https://arenacloud.cdn.arkadiumhosted.com/arenax-51-api-score-dev/api/v1/score/",t.PROD="https://arenacloud.cdn.arkadiumhosted.com/arenax-51-api-score-live/api/v1/score/",t))(Jo||{});class Sf{constructor(e,r,s,i){this.host=r,this.auth=s,this.lifecycle=i,this.isInited=!1,this.leaderboardEndpoint="https://arenacloud.cdn.arkadiumhosted.com/uup-api-score-dev/api/v1/score/",this.arenaDomain="arkadium.com",this._isSupported=!0,this.arenaType=Te.ARKCOM,e.rpcSubscriber.addToRegistry(Gr,"isSupported",this,this.isSupported),e.rpcSubscriber.addToRegistry(Gr,"getUserScore",this,this.getUserScore),e.rpcSubscriber.addToRegistry(Gr,"getTopScores",this,this.getTopScores),e.rpcSubscriber.addToRegistry(Gr,"postScore",this,this.postScore)}async init(e){switch(e===se.STAGING&&(e=se.PROD),this.arenaDomain=await this.host.getArenaName(),this.arenaType=await this.host.getArenaType(),this.arenaType){case Te.ARKCOM:this.leaderboardEndpoint=Vo[e];break;case Te.ARENA51:this.leaderboardEndpoint=Jo[e];break;default:this._isSupported=!1;break}this.isInited=!0}async isSupported(){return this._isSupported}getUserScoresUrl(e,r){switch(this.arenaType){case Te.ARKCOM:return`${this.leaderboardEndpoint}/arena/user/${e}/game/${r}/?arenaDomain=${this.arenaDomain}&timeOffset=${new Date().getTimezoneOffset()}`;case Te.ARENA51:return`${this.leaderboardEndpoint}/user/top/${r}/?arenaDomain=${this.arenaDomain}`;default:return""}}async getUserScore(e="all"){if(!this.isInited||!this._isSupported)throw new Error("Leaderboard service is unavailable!");let r="";try{const o=await this.auth.getUserProfile();r=(o==null?void 0:o.uid)??""}catch{return 0}const s=await this.auth.getToken();if(!r||!s)return 0;const i=await this.host.getGameId(),n=this.getUserScoresUrl(r,i),a={method:"GET",headers:{"Content-Type":"application/json",...this.arenaType===Te.ARENA51&&{Authorization:`Bearer ${s}`}}};return(await Ht(n,a))[e]||0}getTopScoresUrl(e,r,s){switch(this.arenaType){case Te.ARKCOM:return`${this.leaderboardEndpoint}/arena/leaderboard/${e}/${r}/?limit=${s}&arenaDomain=${this.arenaDomain}&timeOffset=${new Date().getTimezoneOffset()}`;case Te.ARENA51:return`${this.leaderboardEndpoint}/leaderboard/${e}/${r}/?limit=${s}&arenaDomain=${this.arenaDomain}`;default:return""}}async getTopScores(e="all",r=100){if(!this.isInited||!this._isSupported)throw new Error("Leaderboard service is unavailable!");const s=100;r>s&&(r=s);const i=await this.auth.getToken(),n=await this.host.getGameId(),a=this.getTopScoresUrl(n,e,r),u={method:"GET",headers:{"Content-Type":"application/json",...this.arenaType===Te.ARENA51&&{Authorization:`Bearer ${i}`}}};return(await Ht(a,u)).map((c,l)=>({rank:l+1,score:c.score,username:c.name,avatar:c.avatar}))}async postScore(e){await this.lifecycle.onEvent(this.lifecycle.LifecycleEvent.SCORE_CHANGED,e)}}var Pf=Object.defineProperty,Bo=Object.getOwnPropertySymbols,Ef=Object.prototype.hasOwnProperty,Tf=Object.prototype.propertyIsEnumerable,Ko=(t,e,r)=>e in t?Pf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Lr=(t,e)=>{for(var r in e||(e={}))Ef.call(e,r)&&Ko(t,r,e[r]);if(Bo)for(var r of Bo(e))Tf.call(e,r)&&Ko(t,r,e[r]);return t},k=(t,e,r)=>new Promise((s,i)=>{var n=o=>{try{u(r.next(o))}catch(c){i(c)}},a=o=>{try{u(r.throw(o))}catch(c){i(c)}},u=o=>o.done?s(o.value):Promise.resolve(o.value).then(n,a);u((r=r.apply(t,e)).next())}),fe=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof fe<"u"&&fe,ye={searchParams:"URLSearchParams"in fe,iterable:"Symbol"in fe&&"iterator"in Symbol,blob:"FileReader"in fe&&"Blob"in fe&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in fe,arrayBuffer:"ArrayBuffer"in fe};function kf(t){return t&&DataView.prototype.isPrototypeOf(t)}ye.arrayBuffer&&(Ho=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Wo=ArrayBuffer.isView||function(t){return t&&Ho.indexOf(Object.prototype.toString.call(t))>-1});var Ho,Wo;function Wt(t){if(typeof t!="string"&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||t==="")throw new TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function Si(t){return typeof t!="string"&&(t=String(t)),t}function Pi(t){var e={next:function(){var r=t.shift();return{done:r===void 0,value:r}}};return ye.iterable&&(e[Symbol.iterator]=function(){return e}),e}function ne(t){this.map={},t instanceof ne?t.forEach(function(e,r){this.append(r,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}ne.prototype.append=function(t,e){t=Wt(t),e=Si(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},ne.prototype.delete=function(t){delete this.map[Wt(t)]},ne.prototype.get=function(t){return t=Wt(t),this.has(t)?this.map[t]:null},ne.prototype.has=function(t){return this.map.hasOwnProperty(Wt(t))},ne.prototype.set=function(t,e){this.map[Wt(t)]=Si(e)},ne.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},ne.prototype.keys=function(){var t=[];return this.forEach(function(e,r){t.push(r)}),Pi(t)},ne.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),Pi(t)},ne.prototype.entries=function(){var t=[];return this.forEach(function(e,r){t.push([r,e])}),Pi(t)},ye.iterable&&(ne.prototype[Symbol.iterator]=ne.prototype.entries);function Ei(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function Xo(t){return new Promise(function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}})}function $f(t){var e=new FileReader,r=Xo(e);return e.readAsArrayBuffer(t),r}function Rf(t){var e=new FileReader,r=Xo(e);return e.readAsText(t),r}function Af(t){for(var e=new Uint8Array(t),r=new Array(e.length),s=0;s<e.length;s++)r[s]=String.fromCharCode(e[s]);return r.join("")}function Qo(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function Yo(){return this.bodyUsed=!1,this._initBody=function(t){this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?typeof t=="string"?this._bodyText=t:ye.blob&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:ye.formData&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:ye.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():ye.arrayBuffer&&ye.blob&&kf(t)?(this._bodyArrayBuffer=Qo(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):ye.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||Wo(t))?this._bodyArrayBuffer=Qo(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||(typeof t=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):ye.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},ye.blob&&(this.blob=function(){var t=Ei(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=Ei(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then($f)}),this.text=function(){var t=Ei(this);if(t)return t;if(this._bodyBlob)return Rf(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(Af(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},ye.formData&&(this.formData=function(){return this.text().then(Cf)}),this.json=function(){return this.text().then(JSON.parse)},this}var If=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Of(t){var e=t.toUpperCase();return If.indexOf(e)>-1?e:t}function nt(t,e){if(!(this instanceof nt))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var r=e.body;if(t instanceof nt){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new ne(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,!r&&t._bodyInit!=null&&(r=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new ne(e.headers)),this.method=Of(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&r)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(r),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var s=/([?&])_=[^&]*/;if(s.test(this.url))this.url=this.url.replace(s,"$1_="+new Date().getTime());else{var i=/\?/;this.url+=(i.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}nt.prototype.clone=function(){return new nt(this,{body:this._bodyInit})};function Cf(t){var e=new FormData;return t.trim().split("&").forEach(function(r){if(r){var s=r.split("="),i=s.shift().replace(/\+/g," "),n=s.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(n))}}),e}function Nf(t){var e=new ne,r=t.replace(/\r?\n[\t ]+/g," ");return r.split("\r").map(function(s){return s.indexOf(`
`)===0?s.substr(1,s.length):s}).forEach(function(s){var i=s.split(":"),n=i.shift().trim();if(n){var a=i.join(":").trim();e.append(n,a)}}),e}Yo.call(nt.prototype);function Ie(t,e){if(!(this instanceof Ie))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new ne(e.headers),this.url=e.url||"",this._initBody(t)}Yo.call(Ie.prototype),Ie.prototype.clone=function(){return new Ie(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new ne(this.headers),url:this.url})},Ie.error=function(){var t=new Ie(null,{status:0,statusText:""});return t.type="error",t};var Mf=[301,302,303,307,308];Ie.redirect=function(t,e){if(Mf.indexOf(e)===-1)throw new RangeError("Invalid status code");return new Ie(null,{status:e,headers:{location:t}})};var ot=fe.DOMException;try{new ot}catch{ot=function(e,r){this.message=e,this.name=r;var s=Error(e);this.stack=s.stack},ot.prototype=Object.create(Error.prototype),ot.prototype.constructor=ot}function Zo(t,e){return new Promise(function(r,s){var i=new nt(t,e);if(i.signal&&i.signal.aborted)return s(new ot("Aborted","AbortError"));var n=new XMLHttpRequest;function a(){n.abort()}n.onload=function(){var o={status:n.status,statusText:n.statusText,headers:Nf(n.getAllResponseHeaders()||"")};o.url="responseURL"in n?n.responseURL:o.headers.get("X-Request-URL");var c="response"in n?n.response:n.responseText;setTimeout(function(){r(new Ie(c,o))},0)},n.onerror=function(){setTimeout(function(){s(new TypeError("Network request failed"))},0)},n.ontimeout=function(){setTimeout(function(){s(new TypeError("Network request failed"))},0)},n.onabort=function(){setTimeout(function(){s(new ot("Aborted","AbortError"))},0)};function u(o){try{return o===""&&fe.location.href?fe.location.href:o}catch{return o}}n.open(i.method,u(i.url),!0),i.credentials==="include"?n.withCredentials=!0:i.credentials==="omit"&&(n.withCredentials=!1),"responseType"in n&&(ye.blob?n.responseType="blob":ye.arrayBuffer&&i.headers.get("Content-Type")&&i.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(n.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof ne)?Object.getOwnPropertyNames(e.headers).forEach(function(o){n.setRequestHeader(o,Si(e.headers[o]))}):i.headers.forEach(function(o,c){n.setRequestHeader(c,o)}),i.signal&&(i.signal.addEventListener("abort",a),n.onreadystatechange=function(){n.readyState===4&&i.signal.removeEventListener("abort",a)}),n.send(typeof i._bodyInit>"u"?null:i._bodyInit)})}Zo.polyfill=!0,fe.fetch||(fe.fetch=Zo,fe.Headers=ne,fe.Request=nt,fe.Response=Ie);var Df=typeof atob=="function",Uf=typeof btoa=="function",St=typeof Buffer=="function",ea=typeof TextDecoder=="function"?new TextDecoder:void 0,ta=typeof TextEncoder=="function"?new TextEncoder:void 0,jf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Xt=Array.prototype.slice.call(jf),zr=(t=>{let e={};return t.forEach((r,s)=>e[r]=s),e})(Xt),xf=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,le=String.fromCharCode.bind(String),ra=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),qf=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),sa=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),Ff=t=>{let e,r,s,i,n="";const a=t.length%3;for(let u=0;u<t.length;){if((r=t.charCodeAt(u++))>255||(s=t.charCodeAt(u++))>255||(i=t.charCodeAt(u++))>255)throw new TypeError("invalid character found");e=r<<16|s<<8|i,n+=Xt[e>>18&63]+Xt[e>>12&63]+Xt[e>>6&63]+Xt[e&63]}return a?n.slice(0,a-3)+"===".substring(a):n},Vr=Uf?t=>btoa(t):St?t=>Buffer.from(t,"binary").toString("base64"):Ff,Gf=St?t=>Buffer.from(t).toString("base64"):t=>{let r=[];for(let s=0,i=t.length;s<i;s+=4096)r.push(le.apply(null,t.subarray(s,s+4096)));return Vr(r.join(""))},Lf=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?le(192|e>>>6)+le(128|e&63):le(224|e>>>12&15)+le(128|e>>>6&63)+le(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return le(240|e>>>18&7)+le(128|e>>>12&63)+le(128|e>>>6&63)+le(128|e&63)}},zf=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Vf=t=>t.replace(zf,Lf),ia=St?t=>Buffer.from(t,"utf8").toString("base64"):ta?t=>Gf(ta.encode(t)):t=>Vr(Vf(t)),Oe=(t,e=!1)=>e?qf(ia(t)):ia(t),Jf=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Bf=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),r=e-65536;return le((r>>>10)+55296)+le((r&1023)+56320);case 3:return le((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return le((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},Kf=t=>t.replace(Jf,Bf),Hf=t=>{if(t=t.replace(/\s+/g,""),!xf.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,r="",s,i;for(let n=0;n<t.length;)e=zr[t.charAt(n++)]<<18|zr[t.charAt(n++)]<<12|(s=zr[t.charAt(n++)])<<6|(i=zr[t.charAt(n++)]),r+=s===64?le(e>>16&255):i===64?le(e>>16&255,e>>8&255):le(e>>16&255,e>>8&255,e&255);return r},Jr=Df?t=>atob(sa(t)):St?t=>Buffer.from(t,"base64").toString("binary"):Hf,Wf=St?t=>ra(Buffer.from(t,"base64")):t=>ra(Jr(t).split("").map(e=>e.charCodeAt(0))),Xf=St?t=>Buffer.from(t,"base64").toString("utf8"):ea?t=>ea.decode(Wf(t)):t=>Kf(Jr(t)),Qf=t=>sa(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),na=t=>Xf(Qf(t));function R(t,e,r){const s=Lr(Lr({},{method:t}),e);if(s.headers=Lr({},e.headers),typeof XMLHttpRequest<"u"){const i=Object.getOwnPropertyDescriptor(XMLHttpRequest.prototype,"withCredentials");i!=null&&i.set||(s.credentials="cocos-ignore")}return Object.keys(s.headers).includes("Accept")||(s.headers.Accept="application/json"),Object.keys(s.headers).includes("Content-Type")||(s.headers["Content-Type"]="application/json"),Object.keys(s.headers).forEach(i=>{s.headers[i]||delete s.headers[i]}),r&&(s.body=r),s}var Yf=class{constructor(t,e,r){this.serverKey=t,this.basePath=e,this.timeoutMs=r}healthcheck(t,e={}){const r="/healthcheck",s=new Map;let i="";const n=this.buildFullUrl(this.basePath,r,s),a=R("GET",e,i);return t&&(a.headers.Authorization="Bearer "+t),Promise.race([fetch(n,a).then(u=>{if(u.status==204)return u;if(u.status>=200&&u.status<300)return u.json();throw u}),new Promise((u,o)=>setTimeout(o,this.timeoutMs,"Request timed out."))])}deleteAccount(t,e={}){const r="/v2/account",s=new Map;let i="";const n=this.buildFullUrl(this.basePath,r,s),a=R("DELETE",e,i);return t&&(a.headers.Authorization="Bearer "+t),Promise.race([fetch(n,a).then(u=>{if(u.status==204)return u;if(u.status>=200&&u.status<300)return u.json();throw u}),new Promise((u,o)=>setTimeout(o,this.timeoutMs,"Request timed out."))])}getAccount(t,e={}){const r="/v2/account",s=new Map;let i="";const n=this.buildFullUrl(this.basePath,r,s),a=R("GET",e,i);return t&&(a.headers.Authorization="Bearer "+t),Promise.race([fetch(n,a).then(u=>{if(u.status==204)return u;if(u.status>=200&&u.status<300)return u.json();throw u}),new Promise((u,o)=>setTimeout(o,this.timeoutMs,"Request timed out."))])}updateAccount(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("PUT",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}authenticateApple(t,e,r,s,i,n={}){if(r==null)throw new Error("'account' is a required parameter but is null or undefined.");const a="/v2/account/authenticate/apple",u=new Map;u.set("create",s),u.set("username",i);let o="";o=JSON.stringify(r||{});const c=this.buildFullUrl(this.basePath,a,u),l=R("POST",n,o);return t&&(l.headers.Authorization="Basic "+Oe(t+":"+e)),Promise.race([fetch(c,l).then(d=>{if(d.status==204)return d;if(d.status>=200&&d.status<300)return d.json();throw d}),new Promise((d,m)=>setTimeout(m,this.timeoutMs,"Request timed out."))])}authenticateCustom(t,e,r,s,i,n={}){if(r==null)throw new Error("'account' is a required parameter but is null or undefined.");const a="/v2/account/authenticate/custom",u=new Map;u.set("create",s),u.set("username",i);let o="";o=JSON.stringify(r||{});const c=this.buildFullUrl(this.basePath,a,u),l=R("POST",n,o);return t&&(l.headers.Authorization="Basic "+Oe(t+":"+e)),Promise.race([fetch(c,l).then(d=>{if(d.status==204)return d;if(d.status>=200&&d.status<300)return d.json();throw d}),new Promise((d,m)=>setTimeout(m,this.timeoutMs,"Request timed out."))])}authenticateDevice(t,e,r,s,i,n={}){if(r==null)throw new Error("'account' is a required parameter but is null or undefined.");const a="/v2/account/authenticate/device",u=new Map;u.set("create",s),u.set("username",i);let o="";o=JSON.stringify(r||{});const c=this.buildFullUrl(this.basePath,a,u),l=R("POST",n,o);return t&&(l.headers.Authorization="Basic "+Oe(t+":"+e)),Promise.race([fetch(c,l).then(d=>{if(d.status==204)return d;if(d.status>=200&&d.status<300)return d.json();throw d}),new Promise((d,m)=>setTimeout(m,this.timeoutMs,"Request timed out."))])}authenticateEmail(t,e,r,s,i,n={}){if(r==null)throw new Error("'account' is a required parameter but is null or undefined.");const a="/v2/account/authenticate/email",u=new Map;u.set("create",s),u.set("username",i);let o="";o=JSON.stringify(r||{});const c=this.buildFullUrl(this.basePath,a,u),l=R("POST",n,o);return t&&(l.headers.Authorization="Basic "+Oe(t+":"+e)),Promise.race([fetch(c,l).then(d=>{if(d.status==204)return d;if(d.status>=200&&d.status<300)return d.json();throw d}),new Promise((d,m)=>setTimeout(m,this.timeoutMs,"Request timed out."))])}authenticateFacebook(t,e,r,s,i,n,a={}){if(r==null)throw new Error("'account' is a required parameter but is null or undefined.");const u="/v2/account/authenticate/facebook",o=new Map;o.set("create",s),o.set("username",i),o.set("sync",n);let c="";c=JSON.stringify(r||{});const l=this.buildFullUrl(this.basePath,u,o),d=R("POST",a,c);return t&&(d.headers.Authorization="Basic "+Oe(t+":"+e)),Promise.race([fetch(l,d).then(m=>{if(m.status==204)return m;if(m.status>=200&&m.status<300)return m.json();throw m}),new Promise((m,g)=>setTimeout(g,this.timeoutMs,"Request timed out."))])}authenticateFacebookInstantGame(t,e,r,s,i,n={}){if(r==null)throw new Error("'account' is a required parameter but is null or undefined.");const a="/v2/account/authenticate/facebookinstantgame",u=new Map;u.set("create",s),u.set("username",i);let o="";o=JSON.stringify(r||{});const c=this.buildFullUrl(this.basePath,a,u),l=R("POST",n,o);return t&&(l.headers.Authorization="Basic "+Oe(t+":"+e)),Promise.race([fetch(c,l).then(d=>{if(d.status==204)return d;if(d.status>=200&&d.status<300)return d.json();throw d}),new Promise((d,m)=>setTimeout(m,this.timeoutMs,"Request timed out."))])}authenticateGameCenter(t,e,r,s,i,n={}){if(r==null)throw new Error("'account' is a required parameter but is null or undefined.");const a="/v2/account/authenticate/gamecenter",u=new Map;u.set("create",s),u.set("username",i);let o="";o=JSON.stringify(r||{});const c=this.buildFullUrl(this.basePath,a,u),l=R("POST",n,o);return t&&(l.headers.Authorization="Basic "+Oe(t+":"+e)),Promise.race([fetch(c,l).then(d=>{if(d.status==204)return d;if(d.status>=200&&d.status<300)return d.json();throw d}),new Promise((d,m)=>setTimeout(m,this.timeoutMs,"Request timed out."))])}authenticateGoogle(t,e,r,s,i,n={}){if(r==null)throw new Error("'account' is a required parameter but is null or undefined.");const a="/v2/account/authenticate/google",u=new Map;u.set("create",s),u.set("username",i);let o="";o=JSON.stringify(r||{});const c=this.buildFullUrl(this.basePath,a,u),l=R("POST",n,o);return t&&(l.headers.Authorization="Basic "+Oe(t+":"+e)),Promise.race([fetch(c,l).then(d=>{if(d.status==204)return d;if(d.status>=200&&d.status<300)return d.json();throw d}),new Promise((d,m)=>setTimeout(m,this.timeoutMs,"Request timed out."))])}authenticateSteam(t,e,r,s,i,n,a={}){if(r==null)throw new Error("'account' is a required parameter but is null or undefined.");const u="/v2/account/authenticate/steam",o=new Map;o.set("create",s),o.set("username",i),o.set("sync",n);let c="";c=JSON.stringify(r||{});const l=this.buildFullUrl(this.basePath,u,o),d=R("POST",a,c);return t&&(d.headers.Authorization="Basic "+Oe(t+":"+e)),Promise.race([fetch(l,d).then(m=>{if(m.status==204)return m;if(m.status>=200&&m.status<300)return m.json();throw m}),new Promise((m,g)=>setTimeout(g,this.timeoutMs,"Request timed out."))])}linkApple(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/link/apple",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}linkCustom(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/link/custom",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}linkDevice(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/link/device",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}linkEmail(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/link/email",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}linkFacebook(t,e,r,s={}){if(e==null)throw new Error("'account' is a required parameter but is null or undefined.");const i="/v2/account/link/facebook",n=new Map;n.set("sync",r);let a="";a=JSON.stringify(e||{});const u=this.buildFullUrl(this.basePath,i,n),o=R("POST",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}linkFacebookInstantGame(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/link/facebookinstantgame",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}linkGameCenter(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/link/gamecenter",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}linkGoogle(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/link/google",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}linkSteam(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/link/steam",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}sessionRefresh(t,e,r,s={}){if(r==null)throw new Error("'body' is a required parameter but is null or undefined.");const i="/v2/account/session/refresh",n=new Map;let a="";a=JSON.stringify(r||{});const u=this.buildFullUrl(this.basePath,i,n),o=R("POST",s,a);return t&&(o.headers.Authorization="Basic "+Oe(t+":"+e)),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}unlinkApple(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/unlink/apple",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}unlinkCustom(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/unlink/custom",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}unlinkDevice(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/unlink/device",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}unlinkEmail(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/unlink/email",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}unlinkFacebook(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/unlink/facebook",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}unlinkFacebookInstantGame(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/unlink/facebookinstantgame",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}unlinkGameCenter(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/unlink/gamecenter",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}unlinkGoogle(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/unlink/google",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}unlinkSteam(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/account/unlink/steam",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}listChannelMessages(t,e,r,s,i,n={}){if(e==null)throw new Error("'channelId' is a required parameter but is null or undefined.");const a="/v2/channel/{channelId}".replace("{channelId}",encodeURIComponent(String(e))),u=new Map;u.set("limit",r),u.set("forward",s),u.set("cursor",i);let o="";const c=this.buildFullUrl(this.basePath,a,u),l=R("GET",n,o);return t&&(l.headers.Authorization="Bearer "+t),Promise.race([fetch(c,l).then(d=>{if(d.status==204)return d;if(d.status>=200&&d.status<300)return d.json();throw d}),new Promise((d,m)=>setTimeout(m,this.timeoutMs,"Request timed out."))])}event(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/event",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}deleteFriends(t,e,r,s={}){const i="/v2/friend",n=new Map;n.set("ids",e),n.set("usernames",r);let a="";const u=this.buildFullUrl(this.basePath,i,n),o=R("DELETE",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}listFriends(t,e,r,s,i={}){const n="/v2/friend",a=new Map;a.set("limit",e),a.set("state",r),a.set("cursor",s);let u="";const o=this.buildFullUrl(this.basePath,n,a),c=R("GET",i,u);return t&&(c.headers.Authorization="Bearer "+t),Promise.race([fetch(o,c).then(l=>{if(l.status==204)return l;if(l.status>=200&&l.status<300)return l.json();throw l}),new Promise((l,d)=>setTimeout(d,this.timeoutMs,"Request timed out."))])}addFriends(t,e,r,s={}){const i="/v2/friend",n=new Map;n.set("ids",e),n.set("usernames",r);let a="";const u=this.buildFullUrl(this.basePath,i,n),o=R("POST",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}blockFriends(t,e,r,s={}){const i="/v2/friend/block",n=new Map;n.set("ids",e),n.set("usernames",r);let a="";const u=this.buildFullUrl(this.basePath,i,n),o=R("POST",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}importFacebookFriends(t,e,r,s={}){if(e==null)throw new Error("'account' is a required parameter but is null or undefined.");const i="/v2/friend/facebook",n=new Map;n.set("reset",r);let a="";a=JSON.stringify(e||{});const u=this.buildFullUrl(this.basePath,i,n),o=R("POST",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}listFriendsOfFriends(t,e,r,s={}){const i="/v2/friend/friends",n=new Map;n.set("limit",e),n.set("cursor",r);let a="";const u=this.buildFullUrl(this.basePath,i,n),o=R("GET",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}importSteamFriends(t,e,r,s={}){if(e==null)throw new Error("'account' is a required parameter but is null or undefined.");const i="/v2/friend/steam",n=new Map;n.set("reset",r);let a="";a=JSON.stringify(e||{});const u=this.buildFullUrl(this.basePath,i,n),o=R("POST",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}listGroups(t,e,r,s,i,n,a,u={}){const o="/v2/group",c=new Map;c.set("name",e),c.set("cursor",r),c.set("limit",s),c.set("lang_tag",i),c.set("members",n),c.set("open",a);let l="";const d=this.buildFullUrl(this.basePath,o,c),m=R("GET",u,l);return t&&(m.headers.Authorization="Bearer "+t),Promise.race([fetch(d,m).then(g=>{if(g.status==204)return g;if(g.status>=200&&g.status<300)return g.json();throw g}),new Promise((g,_)=>setTimeout(_,this.timeoutMs,"Request timed out."))])}createGroup(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/group",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}deleteGroup(t,e,r={}){if(e==null)throw new Error("'groupId' is a required parameter but is null or undefined.");const s="/v2/group/{groupId}".replace("{groupId}",encodeURIComponent(String(e))),i=new Map;let n="";const a=this.buildFullUrl(this.basePath,s,i),u=R("DELETE",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}updateGroup(t,e,r,s={}){if(e==null)throw new Error("'groupId' is a required parameter but is null or undefined.");if(r==null)throw new Error("'body' is a required parameter but is null or undefined.");const i="/v2/group/{groupId}".replace("{groupId}",encodeURIComponent(String(e))),n=new Map;let a="";a=JSON.stringify(r||{});const u=this.buildFullUrl(this.basePath,i,n),o=R("PUT",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}addGroupUsers(t,e,r,s={}){if(e==null)throw new Error("'groupId' is a required parameter but is null or undefined.");const i="/v2/group/{groupId}/add".replace("{groupId}",encodeURIComponent(String(e))),n=new Map;n.set("user_ids",r);let a="";const u=this.buildFullUrl(this.basePath,i,n),o=R("POST",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}banGroupUsers(t,e,r,s={}){if(e==null)throw new Error("'groupId' is a required parameter but is null or undefined.");const i="/v2/group/{groupId}/ban".replace("{groupId}",encodeURIComponent(String(e))),n=new Map;n.set("user_ids",r);let a="";const u=this.buildFullUrl(this.basePath,i,n),o=R("POST",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}demoteGroupUsers(t,e,r,s={}){if(e==null)throw new Error("'groupId' is a required parameter but is null or undefined.");const i="/v2/group/{groupId}/demote".replace("{groupId}",encodeURIComponent(String(e))),n=new Map;n.set("user_ids",r);let a="";const u=this.buildFullUrl(this.basePath,i,n),o=R("POST",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}joinGroup(t,e,r={}){if(e==null)throw new Error("'groupId' is a required parameter but is null or undefined.");const s="/v2/group/{groupId}/join".replace("{groupId}",encodeURIComponent(String(e))),i=new Map;let n="";const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}kickGroupUsers(t,e,r,s={}){if(e==null)throw new Error("'groupId' is a required parameter but is null or undefined.");const i="/v2/group/{groupId}/kick".replace("{groupId}",encodeURIComponent(String(e))),n=new Map;n.set("user_ids",r);let a="";const u=this.buildFullUrl(this.basePath,i,n),o=R("POST",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}leaveGroup(t,e,r={}){if(e==null)throw new Error("'groupId' is a required parameter but is null or undefined.");const s="/v2/group/{groupId}/leave".replace("{groupId}",encodeURIComponent(String(e))),i=new Map;let n="";const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}promoteGroupUsers(t,e,r,s={}){if(e==null)throw new Error("'groupId' is a required parameter but is null or undefined.");const i="/v2/group/{groupId}/promote".replace("{groupId}",encodeURIComponent(String(e))),n=new Map;n.set("user_ids",r);let a="";const u=this.buildFullUrl(this.basePath,i,n),o=R("POST",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}listGroupUsers(t,e,r,s,i,n={}){if(e==null)throw new Error("'groupId' is a required parameter but is null or undefined.");const a="/v2/group/{groupId}/user".replace("{groupId}",encodeURIComponent(String(e))),u=new Map;u.set("limit",r),u.set("state",s),u.set("cursor",i);let o="";const c=this.buildFullUrl(this.basePath,a,u),l=R("GET",n,o);return t&&(l.headers.Authorization="Bearer "+t),Promise.race([fetch(c,l).then(d=>{if(d.status==204)return d;if(d.status>=200&&d.status<300)return d.json();throw d}),new Promise((d,m)=>setTimeout(m,this.timeoutMs,"Request timed out."))])}validatePurchaseApple(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/iap/purchase/apple",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}validatePurchaseFacebookInstant(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/iap/purchase/facebookinstant",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}validatePurchaseGoogle(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/iap/purchase/google",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}validatePurchaseHuawei(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/iap/purchase/huawei",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}listSubscriptions(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/iap/subscription",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}validateSubscriptionApple(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/iap/subscription/apple",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}validateSubscriptionGoogle(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/iap/subscription/google",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}getSubscription(t,e,r={}){if(e==null)throw new Error("'productId' is a required parameter but is null or undefined.");const s="/v2/iap/subscription/{productId}".replace("{productId}",encodeURIComponent(String(e))),i=new Map;let n="";const a=this.buildFullUrl(this.basePath,s,i),u=R("GET",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}deleteLeaderboardRecord(t,e,r={}){if(e==null)throw new Error("'leaderboardId' is a required parameter but is null or undefined.");const s="/v2/leaderboard/{leaderboardId}".replace("{leaderboardId}",encodeURIComponent(String(e))),i=new Map;let n="";const a=this.buildFullUrl(this.basePath,s,i),u=R("DELETE",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}listLeaderboardRecords(t,e,r,s,i,n,a={}){if(e==null)throw new Error("'leaderboardId' is a required parameter but is null or undefined.");const u="/v2/leaderboard/{leaderboardId}".replace("{leaderboardId}",encodeURIComponent(String(e))),o=new Map;o.set("owner_ids",r),o.set("limit",s),o.set("cursor",i),o.set("expiry",n);let c="";const l=this.buildFullUrl(this.basePath,u,o),d=R("GET",a,c);return t&&(d.headers.Authorization="Bearer "+t),Promise.race([fetch(l,d).then(m=>{if(m.status==204)return m;if(m.status>=200&&m.status<300)return m.json();throw m}),new Promise((m,g)=>setTimeout(g,this.timeoutMs,"Request timed out."))])}writeLeaderboardRecord(t,e,r,s={}){if(e==null)throw new Error("'leaderboardId' is a required parameter but is null or undefined.");if(r==null)throw new Error("'record' is a required parameter but is null or undefined.");const i="/v2/leaderboard/{leaderboardId}".replace("{leaderboardId}",encodeURIComponent(String(e))),n=new Map;let a="";a=JSON.stringify(r||{});const u=this.buildFullUrl(this.basePath,i,n),o=R("POST",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}listLeaderboardRecordsAroundOwner(t,e,r,s,i,n,a={}){if(e==null)throw new Error("'leaderboardId' is a required parameter but is null or undefined.");if(r==null)throw new Error("'ownerId' is a required parameter but is null or undefined.");const u="/v2/leaderboard/{leaderboardId}/owner/{ownerId}".replace("{leaderboardId}",encodeURIComponent(String(e))).replace("{ownerId}",encodeURIComponent(String(r))),o=new Map;o.set("limit",s),o.set("expiry",i),o.set("cursor",n);let c="";const l=this.buildFullUrl(this.basePath,u,o),d=R("GET",a,c);return t&&(d.headers.Authorization="Bearer "+t),Promise.race([fetch(l,d).then(m=>{if(m.status==204)return m;if(m.status>=200&&m.status<300)return m.json();throw m}),new Promise((m,g)=>setTimeout(g,this.timeoutMs,"Request timed out."))])}listMatches(t,e,r,s,i,n,a,u={}){const o="/v2/match",c=new Map;c.set("limit",e),c.set("authoritative",r),c.set("label",s),c.set("min_size",i),c.set("max_size",n),c.set("query",a);let l="";const d=this.buildFullUrl(this.basePath,o,c),m=R("GET",u,l);return t&&(m.headers.Authorization="Bearer "+t),Promise.race([fetch(d,m).then(g=>{if(g.status==204)return g;if(g.status>=200&&g.status<300)return g.json();throw g}),new Promise((g,_)=>setTimeout(_,this.timeoutMs,"Request timed out."))])}deleteNotifications(t,e,r={}){const s="/v2/notification",i=new Map;i.set("ids",e);let n="";const a=this.buildFullUrl(this.basePath,s,i),u=R("DELETE",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}listNotifications(t,e,r,s={}){const i="/v2/notification",n=new Map;n.set("limit",e),n.set("cacheable_cursor",r);let a="";const u=this.buildFullUrl(this.basePath,i,n),o=R("GET",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}rpcFunc2(t,e,r,s,i={}){if(e==null)throw new Error("'id' is a required parameter but is null or undefined.");const n="/v2/rpc/{id}".replace("{id}",encodeURIComponent(String(e))),a=new Map;a.set("payload",r),a.set("http_key",s);let u="";const o=this.buildFullUrl(this.basePath,n,a),c=R("GET",i,u);return t&&(c.headers.Authorization="Bearer "+t),Promise.race([fetch(o,c).then(l=>{if(l.status==204)return l;if(l.status>=200&&l.status<300)return l.json();throw l}),new Promise((l,d)=>setTimeout(d,this.timeoutMs,"Request timed out."))])}rpcFunc(t,e,r,s,i={}){if(e==null)throw new Error("'id' is a required parameter but is null or undefined.");if(r==null)throw new Error("'body' is a required parameter but is null or undefined.");const n="/v2/rpc/{id}".replace("{id}",encodeURIComponent(String(e))),a=new Map;a.set("http_key",s);let u="";u=JSON.stringify(r||{});const o=this.buildFullUrl(this.basePath,n,a),c=R("POST",i,u);return t&&(c.headers.Authorization="Bearer "+t),Promise.race([fetch(o,c).then(l=>{if(l.status==204)return l;if(l.status>=200&&l.status<300)return l.json();throw l}),new Promise((l,d)=>setTimeout(d,this.timeoutMs,"Request timed out."))])}sessionLogout(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/session/logout",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}readStorageObjects(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/storage",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}writeStorageObjects(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/storage",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("PUT",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}deleteStorageObjects(t,e,r={}){if(e==null)throw new Error("'body' is a required parameter but is null or undefined.");const s="/v2/storage/delete",i=new Map;let n="";n=JSON.stringify(e||{});const a=this.buildFullUrl(this.basePath,s,i),u=R("PUT",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}listStorageObjects(t,e,r,s,i,n={}){if(e==null)throw new Error("'collection' is a required parameter but is null or undefined.");const a="/v2/storage/{collection}".replace("{collection}",encodeURIComponent(String(e))),u=new Map;u.set("user_id",r),u.set("limit",s),u.set("cursor",i);let o="";const c=this.buildFullUrl(this.basePath,a,u),l=R("GET",n,o);return t&&(l.headers.Authorization="Bearer "+t),Promise.race([fetch(c,l).then(d=>{if(d.status==204)return d;if(d.status>=200&&d.status<300)return d.json();throw d}),new Promise((d,m)=>setTimeout(m,this.timeoutMs,"Request timed out."))])}listStorageObjects2(t,e,r,s,i,n={}){if(e==null)throw new Error("'collection' is a required parameter but is null or undefined.");if(r==null)throw new Error("'userId' is a required parameter but is null or undefined.");const a="/v2/storage/{collection}/{userId}".replace("{collection}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(r))),u=new Map;u.set("limit",s),u.set("cursor",i);let o="";const c=this.buildFullUrl(this.basePath,a,u),l=R("GET",n,o);return t&&(l.headers.Authorization="Bearer "+t),Promise.race([fetch(c,l).then(d=>{if(d.status==204)return d;if(d.status>=200&&d.status<300)return d.json();throw d}),new Promise((d,m)=>setTimeout(m,this.timeoutMs,"Request timed out."))])}listTournaments(t,e,r,s,i,n,a,u={}){const o="/v2/tournament",c=new Map;c.set("category_start",e),c.set("category_end",r),c.set("start_time",s),c.set("end_time",i),c.set("limit",n),c.set("cursor",a);let l="";const d=this.buildFullUrl(this.basePath,o,c),m=R("GET",u,l);return t&&(m.headers.Authorization="Bearer "+t),Promise.race([fetch(d,m).then(g=>{if(g.status==204)return g;if(g.status>=200&&g.status<300)return g.json();throw g}),new Promise((g,_)=>setTimeout(_,this.timeoutMs,"Request timed out."))])}deleteTournamentRecord(t,e,r={}){if(e==null)throw new Error("'tournamentId' is a required parameter but is null or undefined.");const s="/v2/tournament/{tournamentId}".replace("{tournamentId}",encodeURIComponent(String(e))),i=new Map;let n="";const a=this.buildFullUrl(this.basePath,s,i),u=R("DELETE",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}listTournamentRecords(t,e,r,s,i,n,a={}){if(e==null)throw new Error("'tournamentId' is a required parameter but is null or undefined.");const u="/v2/tournament/{tournamentId}".replace("{tournamentId}",encodeURIComponent(String(e))),o=new Map;o.set("owner_ids",r),o.set("limit",s),o.set("cursor",i),o.set("expiry",n);let c="";const l=this.buildFullUrl(this.basePath,u,o),d=R("GET",a,c);return t&&(d.headers.Authorization="Bearer "+t),Promise.race([fetch(l,d).then(m=>{if(m.status==204)return m;if(m.status>=200&&m.status<300)return m.json();throw m}),new Promise((m,g)=>setTimeout(g,this.timeoutMs,"Request timed out."))])}writeTournamentRecord2(t,e,r,s={}){if(e==null)throw new Error("'tournamentId' is a required parameter but is null or undefined.");if(r==null)throw new Error("'record' is a required parameter but is null or undefined.");const i="/v2/tournament/{tournamentId}".replace("{tournamentId}",encodeURIComponent(String(e))),n=new Map;let a="";a=JSON.stringify(r||{});const u=this.buildFullUrl(this.basePath,i,n),o=R("POST",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}writeTournamentRecord(t,e,r,s={}){if(e==null)throw new Error("'tournamentId' is a required parameter but is null or undefined.");if(r==null)throw new Error("'record' is a required parameter but is null or undefined.");const i="/v2/tournament/{tournamentId}".replace("{tournamentId}",encodeURIComponent(String(e))),n=new Map;let a="";a=JSON.stringify(r||{});const u=this.buildFullUrl(this.basePath,i,n),o=R("PUT",s,a);return t&&(o.headers.Authorization="Bearer "+t),Promise.race([fetch(u,o).then(c=>{if(c.status==204)return c;if(c.status>=200&&c.status<300)return c.json();throw c}),new Promise((c,l)=>setTimeout(l,this.timeoutMs,"Request timed out."))])}joinTournament(t,e,r={}){if(e==null)throw new Error("'tournamentId' is a required parameter but is null or undefined.");const s="/v2/tournament/{tournamentId}/join".replace("{tournamentId}",encodeURIComponent(String(e))),i=new Map;let n="";const a=this.buildFullUrl(this.basePath,s,i),u=R("POST",r,n);return t&&(u.headers.Authorization="Bearer "+t),Promise.race([fetch(a,u).then(o=>{if(o.status==204)return o;if(o.status>=200&&o.status<300)return o.json();throw o}),new Promise((o,c)=>setTimeout(c,this.timeoutMs,"Request timed out."))])}listTournamentRecordsAroundOwner(t,e,r,s,i,n,a={}){if(e==null)throw new Error("'tournamentId' is a required parameter but is null or undefined.");if(r==null)throw new Error("'ownerId' is a required parameter but is null or undefined.");const u="/v2/tournament/{tournamentId}/owner/{ownerId}".replace("{tournamentId}",encodeURIComponent(String(e))).replace("{ownerId}",encodeURIComponent(String(r))),o=new Map;o.set("limit",s),o.set("expiry",i),o.set("cursor",n);let c="";const l=this.buildFullUrl(this.basePath,u,o),d=R("GET",a,c);return t&&(d.headers.Authorization="Bearer "+t),Promise.race([fetch(l,d).then(m=>{if(m.status==204)return m;if(m.status>=200&&m.status<300)return m.json();throw m}),new Promise((m,g)=>setTimeout(g,this.timeoutMs,"Request timed out."))])}getUsers(t,e,r,s,i={}){const n="/v2/user",a=new Map;a.set("ids",e),a.set("usernames",r),a.set("facebook_ids",s);let u="";const o=this.buildFullUrl(this.basePath,n,a),c=R("GET",i,u);return t&&(c.headers.Authorization="Bearer "+t),Promise.race([fetch(o,c).then(l=>{if(l.status==204)return l;if(l.status>=200&&l.status<300)return l.json();throw l}),new Promise((l,d)=>setTimeout(d,this.timeoutMs,"Request timed out."))])}listUserGroups(t,e,r,s,i,n={}){if(e==null)throw new Error("'userId' is a required parameter but is null or undefined.");const a="/v2/user/{userId}/group".replace("{userId}",encodeURIComponent(String(e))),u=new Map;u.set("limit",r),u.set("state",s),u.set("cursor",i);let o="";const c=this.buildFullUrl(this.basePath,a,u),l=R("GET",n,o);return t&&(l.headers.Authorization="Bearer "+t),Promise.race([fetch(c,l).then(d=>{if(d.status==204)return d;if(d.status>=200&&d.status<300)return d.json();throw d}),new Promise((d,m)=>setTimeout(m,this.timeoutMs,"Request timed out."))])}buildFullUrl(t,e,r){let s=t+e+"?";for(let[i,n]of r)n instanceof Array?s+=n.reduce((a,u)=>a+encodeURIComponent(i)+"="+encodeURIComponent(u)+"&",""):n!=null&&(s+=encodeURIComponent(i)+"="+encodeURIComponent(n)+"&");return s}},Ce=class{constructor(t,e,r){this.created=r,this.token=t,this.refresh_token=e,this.created_at=Math.floor(new Date().getTime()/1e3),this.update(t,e)}isexpired(t){return this.expires_at-t<0}isrefreshexpired(t){return this.refresh_expires_at-t<0}update(t,e){const r=t.split(".");if(r.length!=3)throw"jwt is not valid.";const s=JSON.parse(Jr(r[1])),i=Math.floor(parseInt(s.exp));if(e){const n=e.split(".");if(n.length!=3)throw"refresh jwt is not valid.";const a=JSON.parse(Jr(n[1])),u=Math.floor(parseInt(a.exp));this.refresh_expires_at=u,this.refresh_token=e}this.token=t,this.expires_at=i,this.username=s.usn,this.user_id=s.uid,this.vars=s.vrs}static restore(t,e){return new Ce(t,e,!1)}},Pt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Qt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(Yt=0;Yt<Pt.length;Yt++)Qt[Pt.charCodeAt(Yt)]=Yt;var Yt,oa=function(t){var e=new Uint8Array(t),r,s=e.length,i="";for(r=0;r<s;r+=3)i+=Pt[e[r]>>2],i+=Pt[(e[r]&3)<<4|e[r+1]>>4],i+=Pt[(e[r+1]&15)<<2|e[r+2]>>6],i+=Pt[e[r+2]&63];return s%3===2?i=i.substring(0,i.length-1)+"=":s%3===1&&(i=i.substring(0,i.length-2)+"=="),i},aa=function(t){var e=t.length*.75,r=t.length,s,i=0,n,a,u,o;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);var c=new ArrayBuffer(e),l=new Uint8Array(c);for(s=0;s<r;s+=4)n=Qt[t.charCodeAt(s)],a=Qt[t.charCodeAt(s+1)],u=Qt[t.charCodeAt(s+2)],o=Qt[t.charCodeAt(s+3)],l[i++]=n<<2|a>>4,l[i++]=(a&15)<<4|u>>2,l[i++]=(u&3)<<6|o&63;return c},ua=class{get onClose(){return this._socket.onclose}set onClose(t){this._socket.onclose=t}get onError(){return this._socket.onerror}set onError(t){this._socket.onerror=t}get onMessage(){return this._socket.onmessage}set onMessage(t){t?this._socket.onmessage=e=>{const r=JSON.parse(e.data);r.match_data&&r.match_data.data?r.match_data.data=new Uint8Array(aa(r.match_data.data)):r.party_data&&r.party_data.data&&(r.party_data.data=new Uint8Array(aa(r.party_data.data))),t(r)}:t=null}get onOpen(){return this._socket.onopen}set onOpen(t){this._socket.onopen=t}isOpen(){var t;return((t=this._socket)==null?void 0:t.readyState)==WebSocket.OPEN}connect(t,e,r,s,i){const n=`${t}${e}:${r}/ws?lang=en&status=${encodeURIComponent(s.toString())}&token=${encodeURIComponent(i)}`;this._socket=new WebSocket(n)}close(){this._socket.close(),this._socket=void 0}send(t){if(t.match_data_send){t.match_data_send.op_code=t.match_data_send.op_code.toString();let e=t.match_data_send.data;e&&e instanceof Uint8Array?t.match_data_send.data=oa(e.buffer):e&&(t.match_data_send.data=Vr(e))}else if(t.party_data_send){t.party_data_send.op_code=t.party_data_send.op_code.toString();let e=t.party_data_send.data;e&&e instanceof Uint8Array?t.party_data_send.data=oa(e.buffer):e&&(t.party_data_send.data=Vr(e))}this._socket.send(JSON.stringify(t))}},Zt=class{constructor(t,e,r=!1,s=!1,i=new ua,n=Zt.DefaultSendTimeoutMs){this.host=t,this.port=e,this.useSSL=r,this.verbose=s,this.adapter=i,this.sendTimeoutMs=n,this.cIds={},this.nextCid=1,this._heartbeatTimeoutMs=Zt.DefaultHeartbeatTimeoutMs}generatecid(){const t=this.nextCid.toString();return++this.nextCid,t}connect(t,e=!1,r=Zt.DefaultConnectTimeoutMs){if(this.adapter.isOpen())return Promise.resolve(t);const s=this.useSSL?"wss://":"ws://";return this.adapter.connect(s,this.host,this.port,e,t.token),this.adapter.onClose=i=>{this.ondisconnect(i)},this.adapter.onError=i=>{this.onerror(i)},this.adapter.onMessage=i=>{if(this.verbose&&window&&window.console&&console.log("Response: %o",JSON.stringify(i)),!i.cid)i.notifications?i.notifications.notifications.forEach(n=>{n.content=n.content?JSON.parse(n.content):void 0,this.onnotification(n)}):i.match_data?(i.match_data.op_code=parseInt(i.match_data.op_code),this.onmatchdata(i.match_data)):i.match_presence_event?this.onmatchpresence(i.match_presence_event):i.matchmaker_ticket?this.onmatchmakerticket(i.matchmaker_ticket):i.matchmaker_matched?this.onmatchmakermatched(i.matchmaker_matched):i.status_presence_event?this.onstatuspresence(i.status_presence_event):i.stream_presence_event?this.onstreampresence(i.stream_presence_event):i.stream_data?this.onstreamdata(i.stream_data):i.channel_message?(i.channel_message.content=JSON.parse(i.channel_message.content),this.onchannelmessage(i.channel_message)):i.channel_presence_event?this.onchannelpresence(i.channel_presence_event):i.party_data?(i.party_data.op_code=parseInt(i.party_data.op_code),this.onpartydata(i.party_data)):i.party_close?this.onpartyclose(i.party_close):i.party_join_request?this.onpartyjoinrequest(i.party_join_request):i.party_leader?this.onpartyleader(i.party_leader):i.party_matchmaker_ticket?this.onpartymatchmakerticket(i.party_matchmaker_ticket):i.party_presence_event?this.onpartypresence(i.party_presence_event):i.party?this.onparty(i.party):this.verbose&&window&&window.console&&console.log("Unrecognized message received: %o",i);else{const n=this.cIds[i.cid];if(!n){this.verbose&&window&&window.console&&console.error("No promise executor for message: %o",i);return}delete this.cIds[i.cid],i.error?n.reject(i.error):n.resolve(i)}},new Promise((i,n)=>{this.adapter.onOpen=a=>{this.verbose&&window&&window.console&&console.log(a),this.pingPong(),i(t)},this.adapter.onError=a=>{n(a),this.adapter.close()},setTimeout(()=>{n("The socket timed out when trying to connect.")},r)})}disconnect(t=!0){this.adapter.isOpen()&&this.adapter.close(),t&&this.ondisconnect({})}setHeartbeatTimeoutMs(t){this._heartbeatTimeoutMs=t}getHeartbeatTimeoutMs(){return this._heartbeatTimeoutMs}ondisconnect(t){this.verbose&&window&&window.console&&console.log(t)}onerror(t){this.verbose&&window&&window.console&&console.log(t)}onchannelmessage(t){this.verbose&&window&&window.console&&console.log(t)}onchannelpresence(t){this.verbose&&window&&window.console&&console.log(t)}onnotification(t){this.verbose&&window&&window.console&&console.log(t)}onmatchdata(t){this.verbose&&window&&window.console&&console.log(t)}onmatchpresence(t){this.verbose&&window&&window.console&&console.log(t)}onmatchmakerticket(t){this.verbose&&window&&window.console&&console.log(t)}onmatchmakermatched(t){this.verbose&&window&&window.console&&console.log(t)}onparty(t){this.verbose&&window&&window.console&&console.log(t)}onpartyclose(t){this.verbose&&window&&window.console&&console.log("Party closed: "+t)}onpartyjoinrequest(t){this.verbose&&window&&window.console&&console.log(t)}onpartydata(t){this.verbose&&window&&window.console&&console.log(t)}onpartyleader(t){this.verbose&&window&&window.console&&console.log(t)}onpartymatchmakerticket(t){this.verbose&&window&&window.console&&console.log(t)}onpartypresence(t){this.verbose&&window&&window.console&&console.log(t)}onstatuspresence(t){this.verbose&&window&&window.console&&console.log(t)}onstreampresence(t){this.verbose&&window&&window.console&&console.log(t)}onstreamdata(t){this.verbose&&window&&window.console&&console.log(t)}onheartbeattimeout(){this.verbose&&window&&window.console&&console.log("Heartbeat timeout.")}send(t,e=Zt.DefaultSendTimeoutMs){const r=t;return new Promise((s,i)=>{if(!this.adapter.isOpen())i("Socket connection has not been established yet.");else if(r.match_data_send)this.adapter.send(r),s();else if(r.party_data_send)this.adapter.send(r),s();else{r.channel_message_send?r.channel_message_send.content=JSON.stringify(r.channel_message_send.content):r.channel_message_update&&(r.channel_message_update.content=JSON.stringify(r.channel_message_update.content));const n=this.generatecid();this.cIds[n]={resolve:s,reject:i},setTimeout(()=>{i("The socket timed out while waiting for a response.")},e),r.cid=n,this.adapter.send(r)}if(this.verbose&&window&&window.console){const n=Lr({},r);n.match_data_send&&n.match_data_send.data?n.match_data_send.data=na(n.match_data_send.data):n.party_data_send&&n.party_data_send.data&&(n.party_data_send.data=na(n.party_data_send.data)),console.log("Sent message: %o",JSON.stringify(n))}})}acceptPartyMember(t,e){return this.send({party_accept:{party_id:t,presence:e}})}addMatchmaker(t,e,r,s,i){return k(this,null,function*(){return(yield this.send({matchmaker_add:{min_count:e,max_count:r,query:t,string_properties:s,numeric_properties:i}})).matchmaker_ticket})}addMatchmakerParty(t,e,r,s,i,n){return k(this,null,function*(){return(yield this.send({party_matchmaker_add:{party_id:t,min_count:r,max_count:s,query:e,string_properties:i,numeric_properties:n}})).party_matchmaker_ticket})}closeParty(t){return k(this,null,function*(){return yield this.send({party_close:{party_id:t}})})}createMatch(t){return k(this,null,function*(){return(yield this.send({match_create:{name:t}})).match})}createParty(t,e){return k(this,null,function*(){return(yield this.send({party_create:{open:t,max_size:e}})).party})}followUsers(t){return k(this,null,function*(){return(yield this.send({status_follow:{user_ids:t}})).status})}joinChat(t,e,r,s){return k(this,null,function*(){return(yield this.send({channel_join:{target:t,type:e,persistence:r,hidden:s}})).channel})}joinMatch(t,e,r){return k(this,null,function*(){const s={match_join:{metadata:r}};return e?s.match_join.token=e:s.match_join.match_id=t,(yield this.send(s)).match})}joinParty(t){return k(this,null,function*(){return yield this.send({party_join:{party_id:t}})})}leaveChat(t){return this.send({channel_leave:{channel_id:t}})}leaveMatch(t){return this.send({match_leave:{match_id:t}})}leaveParty(t){return this.send({party_leave:{party_id:t}})}listPartyJoinRequests(t){return k(this,null,function*(){return(yield this.send({party_join_request_list:{party_id:t}})).party_join_request})}promotePartyMember(t,e){return k(this,null,function*(){return(yield this.send({party_promote:{party_id:t,presence:e}})).party_leader})}removeChatMessage(t,e){return k(this,null,function*(){return(yield this.send({channel_message_remove:{channel_id:t,message_id:e}})).channel_message_ack})}removeMatchmaker(t){return this.send({matchmaker_remove:{ticket:t}})}removeMatchmakerParty(t,e){return this.send({party_matchmaker_remove:{party_id:t,ticket:e}})}removePartyMember(t,e){return k(this,null,function*(){return this.send({party_remove:{party_id:t,presence:e}})})}rpc(t,e,r){return k(this,null,function*(){return(yield this.send({rpc:{id:t,payload:e,http_key:r}})).rpc})}sendMatchState(t,e,r,s,i){return k(this,null,function*(){return this.send({match_data_send:{match_id:t,op_code:e,data:r,presences:s??[],reliable:i}})})}sendPartyData(t,e,r){return this.send({party_data_send:{party_id:t,op_code:e,data:r}})}unfollowUsers(t){return this.send({status_unfollow:{user_ids:t}})}updateChatMessage(t,e,r){return k(this,null,function*(){return(yield this.send({channel_message_update:{channel_id:t,message_id:e,content:r}})).channel_message_ack})}updateStatus(t){return this.send({status_update:{status:t}})}writeChatMessage(t,e){return k(this,null,function*(){return(yield this.send({channel_message_send:{channel_id:t,content:e}})).channel_message_ack})}pingPong(){return k(this,null,function*(){if(this.adapter.isOpen()){try{yield this.send({ping:{}},this._heartbeatTimeoutMs)}catch{this.adapter.isOpen()&&(window&&window.console&&console.error("Server unreachable from heartbeat."),this.onheartbeattimeout(),this.adapter.close());return}setTimeout(()=>this.pingPong(),this._heartbeatTimeoutMs)}})}},er=Zt;er.DefaultHeartbeatTimeoutMs=1e4,er.DefaultSendTimeoutMs=1e4,er.DefaultConnectTimeoutMs=3e4;var Zf="127.0.0.1",em="7350",tm="defaultkey",rm=7e3,sm=5*60*1e3,im=class{constructor(t=tm,e=Zf,r=em,s=!1,i=rm,n=!0){this.serverkey=t,this.host=e,this.port=r,this.useSSL=s,this.timeout=i,this.autoRefreshSession=n,this.expiredTimespanMs=sm;const u=`${s?"https://":"http://"}${e}:${r}`;this.apiClient=new Yf(t,u,i)}addGroupUsers(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.addGroupUsers(t.token,e,r).then(s=>s!==void 0)})}addFriends(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.addFriends(t.token,e,r).then(s=>s!==void 0)})}authenticateApple(t,e,r){return k(this,arguments,function*(s,i,n,a={},u={}){const o={token:s,vars:a};return this.apiClient.authenticateApple(this.serverkey,"",o,i,n,u).then(c=>new Ce(c.token||"",c.refresh_token||"",c.created||!1))})}authenticateCustom(t,e,r,s={},i={}){const n={id:t,vars:s};return this.apiClient.authenticateCustom(this.serverkey,"",n,e,r,i).then(a=>new Ce(a.token||"",a.refresh_token||"",a.created||!1))}authenticateDevice(t,e,r,s){const i={id:t,vars:s};return this.apiClient.authenticateDevice(this.serverkey,"",i,e,r).then(n=>new Ce(n.token||"",n.refresh_token||"",n.created||!1))}authenticateEmail(t,e,r,s,i){const n={email:t,password:e,vars:i};return this.apiClient.authenticateEmail(this.serverkey,"",n,r,s).then(a=>new Ce(a.token||"",a.refresh_token||"",a.created||!1))}authenticateFacebookInstantGame(t,e,r,s,i={}){const n={signed_player_info:t,vars:s};return this.apiClient.authenticateFacebookInstantGame(this.serverkey,"",{signed_player_info:n.signed_player_info,vars:n.vars},e,r,i).then(a=>new Ce(a.token||"",a.refresh_token||"",a.created||!1))}authenticateFacebook(t,e,r,s,i,n={}){const a={token:t,vars:i};return this.apiClient.authenticateFacebook(this.serverkey,"",a,e,r,s,n).then(u=>new Ce(u.token||"",u.refresh_token||"",u.created||!1))}authenticateGoogle(t,e,r,s){return k(this,arguments,function*(i,n,a,u,o={}){const c={token:i,vars:u},l=yield this.apiClient.authenticateGoogle(this.serverkey,"",c,n,a,o);return new Ce(l.token||"",l.refresh_token||"",l.created||!1)})}authenticateGameCenter(t,e,r,s,i,n,a,u,o){return k(this,arguments,function*(c,l,d,m,g,_,w,y,f,v={}){const E={bundle_id:c,player_id:l,public_key_url:d,salt:m,signature:g,timestamp_seconds:_,vars:f},$=yield this.apiClient.authenticateGameCenter(this.serverkey,"",E,y,w,v);return new Ce($.token||"",$.refresh_token||"",$.created||!1)})}authenticateSteam(t,e,r,s,i){return k(this,null,function*(){const n={token:t,vars:i,sync:s};return this.apiClient.authenticateSteam(this.serverkey,"",n,e,r).then(a=>new Ce(a.token||"",a.refresh_token||"",a.created||!1))})}banGroupUsers(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.banGroupUsers(t.token,e,r).then(s=>s!==void 0)})}blockFriends(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.blockFriends(t.token,e,r).then(s=>Promise.resolve(s!=null))})}createGroup(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.createGroup(t.token,e).then(r=>Promise.resolve({avatar_url:r.avatar_url,create_time:r.create_time,creator_id:r.creator_id,description:r.description,edge_count:r.edge_count?Number(r.edge_count):0,id:r.id,lang_tag:r.lang_tag,max_count:r.max_count?Number(r.max_count):0,metadata:r.metadata?JSON.parse(r.metadata):void 0,name:r.name,open:r.open,update_time:r.update_time}))})}createSocket(t=!1,e=!1,r=new ua,s=er.DefaultSendTimeoutMs){return new er(this.host,this.port,t,e,r,s)}deleteAccount(t){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.deleteAccount(t.token).then(e=>e!==void 0)})}deleteFriends(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.deleteFriends(t.token,e,r).then(s=>s!==void 0)})}deleteGroup(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.deleteGroup(t.token,e).then(r=>r!==void 0)})}deleteNotifications(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.deleteNotifications(t.token,e).then(r=>Promise.resolve(r!=null))})}deleteStorageObjects(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.deleteStorageObjects(t.token,e).then(r=>Promise.resolve(r!=null))})}deleteTournamentRecord(t,e){return k(this,null,function*(){return this.apiClient.deleteTournamentRecord(t.token,e)})}demoteGroupUsers(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.demoteGroupUsers(t.token,e,r).then(s=>Promise.resolve(s!=null))})}emitEvent(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.event(t.token,e).then(r=>Promise.resolve(r!=null))})}getAccount(t){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.getAccount(t.token)})}getSubscription(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.getSubscription(t.token,e)})}importFacebookFriends(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.importFacebookFriends(t.token,e).then(r=>r!==void 0)})}importSteamFriends(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.importSteamFriends(t.token,e,r).then(s=>s!==void 0)})}getUsers(t,e,r,s){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.getUsers(t.token,e,r,s).then(i=>{var n={users:[]};return i.users==null||i.users.forEach(a=>{n.users.push({avatar_url:a.avatar_url,create_time:a.create_time,display_name:a.display_name,edge_count:a.edge_count?Number(a.edge_count):0,facebook_id:a.facebook_id,gamecenter_id:a.gamecenter_id,google_id:a.google_id,id:a.id,lang_tag:a.lang_tag,location:a.location,online:a.online,steam_id:a.steam_id,timezone:a.timezone,update_time:a.update_time,username:a.username,metadata:a.metadata?JSON.parse(a.metadata):void 0})}),Promise.resolve(n)})})}joinGroup(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.joinGroup(t.token,e,{}).then(r=>r!==void 0)})}joinTournament(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.joinTournament(t.token,e,{}).then(r=>r!==void 0)})}kickGroupUsers(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.kickGroupUsers(t.token,e,r).then(s=>Promise.resolve(s!=null))})}leaveGroup(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.leaveGroup(t.token,e,{}).then(r=>r!==void 0)})}listChannelMessages(t,e,r,s,i){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listChannelMessages(t.token,e,r,s,i).then(n=>{var a={messages:[],next_cursor:n.next_cursor,prev_cursor:n.prev_cursor,cacheable_cursor:n.cacheable_cursor};return n.messages==null||n.messages.forEach(u=>{a.messages.push({channel_id:u.channel_id,code:u.code?Number(u.code):0,create_time:u.create_time,message_id:u.message_id,persistent:u.persistent,sender_id:u.sender_id,update_time:u.update_time,username:u.username,content:u.content?JSON.parse(u.content):void 0,group_id:u.group_id,room_name:u.room_name,user_id_one:u.user_id_one,user_id_two:u.user_id_two})}),Promise.resolve(a)})})}listGroupUsers(t,e,r,s,i){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listGroupUsers(t.token,e,s,r,i).then(n=>{var a={group_users:[],cursor:n.cursor};return n.group_users==null||n.group_users.forEach(u=>{a.group_users.push({user:{avatar_url:u.user.avatar_url,create_time:u.user.create_time,display_name:u.user.display_name,edge_count:u.user.edge_count?Number(u.user.edge_count):0,facebook_id:u.user.facebook_id,gamecenter_id:u.user.gamecenter_id,google_id:u.user.google_id,id:u.user.id,lang_tag:u.user.lang_tag,location:u.user.location,online:u.user.online,steam_id:u.user.steam_id,timezone:u.user.timezone,update_time:u.user.update_time,username:u.user.username,metadata:u.user.metadata?JSON.parse(u.user.metadata):void 0},state:u.state?Number(u.state):0})}),Promise.resolve(a)})})}listUserGroups(t,e,r,s,i){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listUserGroups(t.token,e,r,s,i).then(n=>{var a={user_groups:[],cursor:n.cursor};return n.user_groups==null||n.user_groups.forEach(u=>{a.user_groups.push({group:{avatar_url:u.group.avatar_url,create_time:u.group.create_time,creator_id:u.group.creator_id,description:u.group.description,edge_count:u.group.edge_count?Number(u.group.edge_count):0,id:u.group.id,lang_tag:u.group.lang_tag,max_count:u.group.max_count,metadata:u.group.metadata?JSON.parse(u.group.metadata):void 0,name:u.group.name,open:u.group.open,update_time:u.group.update_time},state:u.state?Number(u.state):0})}),Promise.resolve(a)})})}listGroups(t,e,r,s){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listGroups(t.token,e,r,s).then(i=>{var n={groups:[]};return i.groups==null||(n.cursor=i.cursor,i.groups.forEach(a=>{n.groups.push({avatar_url:a.avatar_url,create_time:a.create_time,creator_id:a.creator_id,description:a.description,edge_count:a.edge_count?Number(a.edge_count):0,id:a.id,lang_tag:a.lang_tag,max_count:a.max_count,metadata:a.metadata?JSON.parse(a.metadata):void 0,name:a.name,open:a.open,update_time:a.update_time})})),Promise.resolve(n)})})}linkApple(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.linkApple(t.token,e).then(r=>r!==void 0)})}linkCustom(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.linkCustom(t.token,e).then(r=>r!==void 0)})}linkDevice(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.linkDevice(t.token,e).then(r=>r!==void 0)})}linkEmail(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.linkEmail(t.token,e).then(r=>r!==void 0)})}linkFacebook(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.linkFacebook(t.token,e).then(r=>r!==void 0)})}linkFacebookInstantGame(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.linkFacebookInstantGame(t.token,e).then(r=>r!==void 0)})}linkGoogle(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.linkGoogle(t.token,e).then(r=>r!==void 0)})}linkGameCenter(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.linkGameCenter(t.token,e).then(r=>r!==void 0)})}linkSteam(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.linkSteam(t.token,e).then(r=>r!==void 0)})}listFriends(t,e,r,s){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listFriends(t.token,r,e,s).then(i=>{var n={friends:[],cursor:i.cursor};return i.friends==null||i.friends.forEach(a=>{n.friends.push({user:{avatar_url:a.user.avatar_url,create_time:a.user.create_time,display_name:a.user.display_name,edge_count:a.user.edge_count?Number(a.user.edge_count):0,facebook_id:a.user.facebook_id,gamecenter_id:a.user.gamecenter_id,google_id:a.user.google_id,id:a.user.id,lang_tag:a.user.lang_tag,location:a.user.location,online:a.user.online,steam_id:a.user.steam_id,timezone:a.user.timezone,update_time:a.user.update_time,username:a.user.username,metadata:a.user.metadata?JSON.parse(a.user.metadata):void 0,facebook_instant_game_id:a.user.facebook_instant_game_id},state:a.state})}),Promise.resolve(n)})})}listFriendsOfFriends(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listFriendsOfFriends(t.token,e,r).then(s=>{var i={friends_of_friends:[],cursor:s.cursor};return s.friends_of_friends==null||s.friends_of_friends.forEach(n=>{i.friends_of_friends.push({referrer:n.referrer,user:{avatar_url:n.user.avatar_url,create_time:n.user.create_time,display_name:n.user.display_name,edge_count:n.user.edge_count?Number(n.user.edge_count):0,facebook_id:n.user.facebook_id,gamecenter_id:n.user.gamecenter_id,google_id:n.user.google_id,id:n.user.id,lang_tag:n.user.lang_tag,location:n.user.location,online:n.user.online,steam_id:n.user.steam_id,timezone:n.user.timezone,update_time:n.user.update_time,username:n.user.username,metadata:n.user.metadata?JSON.parse(n.user.metadata):void 0,facebook_instant_game_id:n.user.facebook_instant_game_id}})}),Promise.resolve(i)})})}listLeaderboardRecords(t,e,r,s,i,n){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listLeaderboardRecords(t.token,e,r,s,i,n).then(a=>{var u={next_cursor:a.next_cursor,prev_cursor:a.prev_cursor,rank_count:a.rank_count?Number(a.rank_count):0,owner_records:[],records:[]};return a.owner_records!=null&&a.owner_records.forEach(o=>{u.owner_records.push({expiry_time:o.expiry_time,leaderboard_id:o.leaderboard_id,metadata:o.metadata?JSON.parse(o.metadata):void 0,num_score:o.num_score?Number(o.num_score):0,owner_id:o.owner_id,rank:o.rank?Number(o.rank):0,score:o.score?Number(o.score):0,subscore:o.subscore?Number(o.subscore):0,update_time:o.update_time,username:o.username,max_num_score:o.max_num_score?Number(o.max_num_score):0})}),a.records!=null&&a.records.forEach(o=>{u.records.push({expiry_time:o.expiry_time,leaderboard_id:o.leaderboard_id,metadata:o.metadata?JSON.parse(o.metadata):void 0,num_score:o.num_score?Number(o.num_score):0,owner_id:o.owner_id,rank:o.rank?Number(o.rank):0,score:o.score?Number(o.score):0,subscore:o.subscore?Number(o.subscore):0,update_time:o.update_time,username:o.username,max_num_score:o.max_num_score?Number(o.max_num_score):0})}),Promise.resolve(u)})})}listLeaderboardRecordsAroundOwner(t,e,r,s,i,n){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listLeaderboardRecordsAroundOwner(t.token,e,r,s,i,n).then(a=>{var u={next_cursor:a.next_cursor,prev_cursor:a.prev_cursor,rank_count:a.rank_count?Number(a.rank_count):0,owner_records:[],records:[]};return a.owner_records!=null&&a.owner_records.forEach(o=>{u.owner_records.push({expiry_time:o.expiry_time,leaderboard_id:o.leaderboard_id,metadata:o.metadata?JSON.parse(o.metadata):void 0,num_score:o.num_score?Number(o.num_score):0,owner_id:o.owner_id,rank:o.rank?Number(o.rank):0,score:o.score?Number(o.score):0,subscore:o.subscore?Number(o.subscore):0,update_time:o.update_time,username:o.username,max_num_score:o.max_num_score?Number(o.max_num_score):0})}),a.records!=null&&a.records.forEach(o=>{u.records.push({expiry_time:o.expiry_time,leaderboard_id:o.leaderboard_id,metadata:o.metadata?JSON.parse(o.metadata):void 0,num_score:o.num_score?Number(o.num_score):0,owner_id:o.owner_id,rank:o.rank?Number(o.rank):0,score:o.score?Number(o.score):0,subscore:o.subscore?Number(o.subscore):0,update_time:o.update_time,username:o.username,max_num_score:o.max_num_score?Number(o.max_num_score):0})}),Promise.resolve(u)})})}listMatches(t,e,r,s,i,n,a){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listMatches(t.token,e,r,s,i,n,a)})}listNotifications(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listNotifications(t.token,e,r).then(s=>{var i={cacheable_cursor:s.cacheable_cursor,notifications:[]};return s.notifications==null||s.notifications.forEach(n=>{i.notifications.push({code:n.code?Number(n.code):0,create_time:n.create_time,id:n.id,persistent:n.persistent,sender_id:n.sender_id,subject:n.subject,content:n.content?JSON.parse(n.content):void 0})}),Promise.resolve(i)})})}listStorageObjects(t,e,r,s,i){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listStorageObjects(t.token,e,r,s,i).then(n=>{var a={objects:[],cursor:n.cursor};return n.objects==null||n.objects.forEach(u=>{a.objects.push({collection:u.collection,key:u.key,permission_read:u.permission_read?Number(u.permission_read):0,permission_write:u.permission_write?Number(u.permission_write):0,value:u.value?JSON.parse(u.value):void 0,version:u.version,user_id:u.user_id,create_time:u.create_time,update_time:u.update_time})}),Promise.resolve(a)})})}listTournaments(t,e,r,s,i,n,a){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listTournaments(t.token,e,r,s,i,n,a).then(u=>{var o={cursor:u.cursor,tournaments:[]};return u.tournaments!=null&&u.tournaments.forEach(c=>{o.tournaments.push({id:c.id,title:c.title,description:c.description,duration:c.duration?Number(c.duration):0,category:c.category?Number(c.category):0,sort_order:c.sort_order?Number(c.sort_order):0,size:c.size?Number(c.size):0,max_size:c.max_size?Number(c.max_size):0,max_num_score:c.max_num_score?Number(c.max_num_score):0,can_enter:c.can_enter,end_active:c.end_active?Number(c.end_active):0,next_reset:c.next_reset?Number(c.next_reset):0,metadata:c.metadata?JSON.parse(c.metadata):void 0,create_time:c.create_time,start_time:c.start_time,end_time:c.end_time,start_active:c.start_active,authoritative:c.authoritative})}),Promise.resolve(o)})})}listSubscriptions(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listSubscriptions(t.token,{cursor:e,limit:r})})}listTournamentRecords(t,e,r,s,i,n){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listTournamentRecords(t.token,e,r,s,i,n).then(a=>{var u={next_cursor:a.next_cursor,prev_cursor:a.prev_cursor,owner_records:[],records:[]};return a.owner_records!=null&&a.owner_records.forEach(o=>{u.owner_records.push({expiry_time:o.expiry_time,leaderboard_id:o.leaderboard_id,metadata:o.metadata?JSON.parse(o.metadata):void 0,num_score:o.num_score?Number(o.num_score):0,owner_id:o.owner_id,rank:o.rank?Number(o.rank):0,score:o.score?Number(o.score):0,subscore:o.subscore?Number(o.subscore):0,update_time:o.update_time,username:o.username,max_num_score:o.max_num_score?Number(o.max_num_score):0})}),a.records!=null&&a.records.forEach(o=>{u.records.push({expiry_time:o.expiry_time,leaderboard_id:o.leaderboard_id,metadata:o.metadata?JSON.parse(o.metadata):void 0,num_score:o.num_score?Number(o.num_score):0,owner_id:o.owner_id,rank:o.rank?Number(o.rank):0,score:o.score?Number(o.score):0,subscore:o.subscore?Number(o.subscore):0,update_time:o.update_time,username:o.username,max_num_score:o.max_num_score?Number(o.max_num_score):0})}),Promise.resolve(u)})})}listTournamentRecordsAroundOwner(t,e,r,s,i,n){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.listTournamentRecordsAroundOwner(t.token,e,r,s,i,n).then(a=>{var u={next_cursor:a.next_cursor,prev_cursor:a.prev_cursor,owner_records:[],records:[]};return a.owner_records!=null&&a.owner_records.forEach(o=>{u.owner_records.push({expiry_time:o.expiry_time,leaderboard_id:o.leaderboard_id,metadata:o.metadata?JSON.parse(o.metadata):void 0,num_score:o.num_score?Number(o.num_score):0,owner_id:o.owner_id,rank:o.rank?Number(o.rank):0,score:o.score?Number(o.score):0,subscore:o.subscore?Number(o.subscore):0,update_time:o.update_time,username:o.username,max_num_score:o.max_num_score?Number(o.max_num_score):0})}),a.records!=null&&a.records.forEach(o=>{u.records.push({expiry_time:o.expiry_time,leaderboard_id:o.leaderboard_id,metadata:o.metadata?JSON.parse(o.metadata):void 0,num_score:o.num_score?Number(o.num_score):0,owner_id:o.owner_id,rank:o.rank?Number(o.rank):0,score:o.score?Number(o.score):0,subscore:o.subscore?Number(o.subscore):0,update_time:o.update_time,username:o.username,max_num_score:o.max_num_score?Number(o.max_num_score):0})}),Promise.resolve(u)})})}promoteGroupUsers(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.promoteGroupUsers(t.token,e,r)})}readStorageObjects(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.readStorageObjects(t.token,e).then(r=>{var s={objects:[]};return r.objects==null||r.objects.forEach(i=>{s.objects.push({collection:i.collection,key:i.key,permission_read:i.permission_read?Number(i.permission_read):0,permission_write:i.permission_write?Number(i.permission_write):0,value:i.value?JSON.parse(i.value):void 0,version:i.version,user_id:i.user_id,create_time:i.create_time,update_time:i.update_time})}),Promise.resolve(s)})})}rpc(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.rpcFunc(t.token,e,JSON.stringify(r)).then(s=>Promise.resolve({id:s.id,payload:s.payload?JSON.parse(s.payload):void 0}))})}rpcHttpKey(t,e,r){return k(this,null,function*(){return this.apiClient.rpcFunc2("",e,r&&JSON.stringify(r)||"",t).then(s=>Promise.resolve({id:s.id,payload:s.payload?JSON.parse(s.payload):void 0})).catch(s=>{throw s})})}sessionLogout(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.sessionLogout(t.token,{refresh_token:r,token:e}).then(s=>s!==void 0)})}sessionRefresh(t){return k(this,arguments,function*(e,r={}){if(!e)return console.error("Cannot refresh a null session."),e;e.created&&e.expires_at-e.created_at<70&&console.warn("Session lifetime too short, please set '--session.token_expiry_sec' option. See the documentation for more info: https://heroiclabs.com/docs/nakama/getting-started/configuration/#session"),e.created&&e.refresh_expires_at-e.created_at<3700&&console.warn("Session refresh lifetime too short, please set '--session.refresh_token_expiry_sec' option. See the documentation for more info: https://heroiclabs.com/docs/nakama/getting-started/configuration/#session");const s=yield this.apiClient.sessionRefresh(this.serverkey,"",{token:e.refresh_token,vars:r});return e.update(s.token,s.refresh_token),e})}unlinkApple(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.unlinkApple(t.token,e).then(r=>r!==void 0)})}unlinkCustom(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.unlinkCustom(t.token,e).then(r=>r!==void 0)})}unlinkDevice(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.unlinkDevice(t.token,e).then(r=>r!==void 0)})}unlinkEmail(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.unlinkEmail(t.token,e).then(r=>r!==void 0)})}unlinkFacebook(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.unlinkFacebook(t.token,e).then(r=>r!==void 0)})}unlinkFacebookInstantGame(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.unlinkFacebookInstantGame(t.token,e).then(r=>r!==void 0)})}unlinkGoogle(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.unlinkGoogle(t.token,e).then(r=>r!==void 0)})}unlinkGameCenter(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.unlinkGameCenter(t.token,e).then(r=>r!==void 0)})}unlinkSteam(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.unlinkSteam(t.token,e).then(r=>r!==void 0)})}updateAccount(t,e){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.updateAccount(t.token,e).then(r=>r!==void 0)})}updateGroup(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.updateGroup(t.token,e,r).then(s=>s!==void 0)})}validatePurchaseApple(t,e,r=!0){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.validatePurchaseApple(t.token,{receipt:e,persist:r})})}validatePurchaseFacebookInstant(t,e,r=!0){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.validatePurchaseFacebookInstant(t.token,{signed_request:e,persist:r})})}validatePurchaseGoogle(t,e,r=!0){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.validatePurchaseGoogle(t.token,{purchase:e,persist:r})})}validatePurchaseHuawei(t,e,r,s=!0){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.validatePurchaseHuawei(t.token,{purchase:e,signature:r,persist:s})})}validateSubscriptionApple(t,e,r=!0){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.validateSubscriptionApple(t.token,{receipt:e,persist:r})})}validateSubscriptionGoogle(t,e,r=!0){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.validateSubscriptionGoogle(t.token,{receipt:e,persist:r})})}writeLeaderboardRecord(t,e,r){return k(this,null,function*(){return this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t)),this.apiClient.writeLeaderboardRecord(t.token,e,{metadata:r.metadata?JSON.stringify(r.metadata):void 0,score:r.score,subscore:r.subscore}).then(s=>Promise.resolve({expiry_time:s.expiry_time,leaderboard_id:s.leaderboard_id,metadata:s.metadata?JSON.parse(s.metadata):void 0,num_score:s.num_score?Number(s.num_score):0,owner_id:s.owner_id,score:s.score?Number(s.score):0,subscore:s.subscore?Number(s.subscore):0,update_time:s.update_time,username:s.username,max_num_score:s.max_num_score?Number(s.max_num_score):0,rank:s.rank?Number(s.rank):0}))})}writeStorageObjects(t,e){return k(this,null,function*(){this.autoRefreshSession&&t.refresh_token&&t.isexpired((Date.now()+this.expiredTimespanMs)/1e3)&&(yield this.sessionRefresh(t));var r={objects:[]};return e.forEach(s=>{r.objects.push({collection:s.collection,key:s.key,permission_read:s.permission_read,permission_write:s.permission_write,value:JSON.stringify(s.value),version:s.version})}),this.apiClient.writeStorageObjects(t.token,r)})}writeTournamentRecord(t,e,r){return k(this,null,function*(){return this.apiClient.writeTournamentRecord(t.token,e,{metadata:r.metadata?JSON.stringify(r.metadata):void 0,score:r.score,subscore:r.subscore}).then(s=>Promise.resolve({expiry_time:s.expiry_time,leaderboard_id:s.leaderboard_id,metadata:s.metadata?JSON.parse(s.metadata):void 0,num_score:s.num_score?Number(s.num_score):0,owner_id:s.owner_id,score:s.score?Number(s.score):0,subscore:s.subscore?Number(s.subscore):0,update_time:s.update_time,username:s.username,max_num_score:s.max_num_score?Number(s.max_num_score):0,rank:s.rank?Number(s.rank):0}))})}};class nm{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}}const om={DEV:{key:"qvFJkEXaToglyz4C",host:"platform-dev1.gamebackend.arkadiumhosted.com"},QA:{key:"ya7yJpwqPI2XtwhI",host:"platform-qa1.gamebackend.arkadiumhosted.com"},PROD:{key:"QWAhSP6sjb02y9uq",host:"platform-prod1.gamebackend.arkadiumhosted.com"}};class am{constructor(e,r){this.host=e,this.auth=r,this._ctx={client:null,session:null,socket:null},this._socketListeners=[],this.wasEagleSubscribed=!1,this.env=se.DEV,this.gameId="",this._isConnected=!1,this._gameCtx={client:null,session:null,socket:null,gameId:""},this.RPC_GET_USER_BY_EAGLE_ID="eagle::get_user_by_eagle_uuid"}init(e){this.env=e,this.isSupported()&&this.subscribeToEagleAuthChanges()}isSupported(){const e=bt.Instance.config.nakama;return e.isEnabled&&e.envs.includes(this.env)&&(!e.debugMode||e.debugMode&&we())}isUserAuthorized(){return!!this._ctx.session}getNakamaClient(){if(!this._ctx.client){const e=om[this.env===se.STAGING?"QA":this.env];this._ctx.client=new im(e.key,e.host,"443",!0)}return this._ctx.client}async subscribeToEagleAuthChanges(){this.wasEagleSubscribed||(this.wasEagleSubscribed=!0,this.auth.onAuthStatusChange(async e=>{try{e?await this.onEagleLogin():await this.onEagleLogout()}catch(r){console.error(r)}}))}async getNakamaVars(){const e=await this.host.getGameId(),r=await this.host.getArenaName();return{GameId:e,PlatformId:r}}async initNakamaSession(){var e;if(this.userSessionDeferred)return this.userSessionDeferred.promise;this.userSessionDeferred=new nm;try{const r=await this.initNakamaSessionViaEagle();return this.userSessionDeferred.resolve(r),delete this.userSessionDeferred,this._ctx.session=r,r}catch(r){throw(e=this.userSessionDeferred)==null||e.reject(r),delete this.userSessionDeferred,r}}async initNakamaSessionViaEagle(){if(await this.auth.isUserAuthorized()){const r=await this.auth.getToken();if(r)return await this.getNakamaClient().authenticateCustom(r,!0,void 0,await this.getNakamaVars())}throw new Error("Unable to initialize session. User is not logged in.")}async getGameContext(){const e=await this.host.getGameId();return this._gameCtx.gameId===e?this._gameCtx:(this._gameCtx.gameId=e,this._gameCtx.client=this.getNakamaClient(),this._gameCtx.session=await this.initNakamaSessionViaEagle(),this._gameCtx)}async onEagleLogin(){try{await this.initNakamaSession(),console.log("[Nakama] Logged in")}catch{}}async onEagleLogout(){var e,r;this._ctx.session&&(await((e=this._ctx.client)==null?void 0:e.sessionLogout(this._ctx.session,this._ctx.session.token,this._ctx.session.refresh_token)),this._ctx.session=null),this._ctx.socket&&((r=this._ctx.socket)==null||r.disconnect(!0),this._ctx.socket=null),console.log("[Nakama] Logged out")}async getAccount(){const{client:e,session:r}=this.getContext();return!e||!r?null:e.getAccount(r)}async isNakamaUserLinkedToEagle(){const{client:e,session:r}=this.getContext();return!e||!r?!1:!!(await e.getAccount(r)).custom_id}getContext(){return this._ctx}async rpcGetNkUserByEagleId(e){const r=this.getContext();if(!(!r.session||!r.client))try{const s=await r.client.rpc(r.session,this.RPC_GET_USER_BY_EAGLE_ID,{EagleUserId:e});if(s)return s.payload}catch(s){throw new Error("[User] error getting nk user by eagle id"+s)}}async createSocket(){if(!this._ctx.session||!this._ctx.client)throw new Error("[Auth] no active session found");try{if(this._isConnected)return;this._ctx.socket=this._ctx.client.createSocket(!0),this._ctx.session=await this._ctx.socket.connect(this._ctx.session,!0),this._ctx.socket.ondisconnect=this.onSocketDisconnect.bind(this),this.onSocketConnect()}catch(e){throw new Error("[Auth] socket creation failed"+e)}}subscribeSocketListener(e){this._socketListeners.push(e)}onSocketConnect(){this._isConnected=!0;for(const e of this._socketListeners)e(!0)}onSocketDisconnect(){this._isConnected=!1;for(const e of this._socketListeners)e(!1)}}let ca;class Br{constructor(e){e.subscribeSocketListener(this.onSocketConnectionChanged.bind(this)),this._ctx=e.getContext(),ca=e}isSupported(){var e,r;return!!((e=this._ctx)!=null&&e.session&&((r=this._ctx)!=null&&r.client))}async createSocket(){await ca.createSocket()}}const la=-1,um=-2,cm=-3;var Kr=(t=>(t.All="all",t.ChatInvite="chat_invite",t.FriendRequest="friend_request",t.FriendRequestAccepted="friend_request_accepted",t))(Kr||{});const lm={[la]:"chat_invite",[um]:"friend_request",[cm]:"friend_request_accepted"};class dm extends Br{constructor(e){super(e),this._notifications=[],this._notificationListeners=new Map,this._notificationCursor=""}async getNotifications({fromCache:e=!1,limit:r=10}={}){var s;if(!this._ctx.session||!this._ctx.client)throw new Error("[Notifications] error retrieving notifications list, no session found");if(e)return this._notifications;try{const i=await this._ctx.client.listNotifications(this._ctx.session,r,this._notificationCursor),n=((s=i.notifications)==null?void 0:s.map(a=>this.mapNakamaNotificationToNotification(a)))??[];return this._notificationCursor=i.cacheable_cursor,this.addNotificationsToList(n),this._notifications}catch(i){throw new Error("[Notifications] error retrieving notifications list"+i)}}async deleteNotification(e){if(!this._ctx.session||!this._ctx.client)throw new Error("[Notifications] error retrieving notifications list, no session found");if(!this._notifications.find(i=>i.id===e))throw new Error(`[Notifications] notification id ${e} not found in the current list`);const s=[e];try{const i=await this._ctx.client.deleteNotifications(this._ctx.session,s);return i&&this.removeNotificationFromList(e),i}catch(i){throw new Error(`[Notifications] error deleting notification id ${e}: ${i}`)}}addNotificationToList(e){this._notifications.find(r=>r.id===e.id)||this._notifications.push(e)}addNotificationsToList(e){e.forEach(r=>this.addNotificationToList(r))}removeNotificationFromList(e){const r=this._notifications.findIndex(s=>s.id===e);r!==-1&&this._notifications.splice(r,1)[0]}mapNakamaNotificationToNotification(e){return{type:lm[e.code??la],content:e.content,id:e.id,senderId:e.sender_id,subject:e.subject,createTime:e.create_time}}onNotificationReceived(e){var s,i;if(!e)return;const r=this.mapNakamaNotificationToNotification(e);this.addNotificationToList(r),(s=this._notificationListeners.get("all"))==null||s.forEach(n=>n(r)),(i=this._notificationListeners.get(r.type))==null||i.forEach(n=>n(r))}subscribeNotificationListener(e){return this.subscribeNotificationTypeListener(e,"all")}subscribeNotificationTypeListener(e,r){var s;return this.createSocket(),this._notificationListeners.has(r)||this._notificationListeners.set(r,[]),(s=this._notificationListeners.get(r))==null||s.push(e),()=>{var n;const i=(n=this._notificationListeners.get(r))==null?void 0:n.filter(a=>a!==e);this._notificationListeners.set(r,i)}}onSocketConnectionChanged(e){this._ctx.socket&&(e?this._ctx.socket.onnotification=this.onNotificationReceived.bind(this):(this._ctx.socket.onnotification=()=>{},this._notificationListeners.clear()))}}let da;const hm=0,fm=1,mm=2,pm=3,gm={[hm]:"friends",[fm]:"request_sent",[mm]:"request_received",[pm]:"blocked"};class ym extends Br{constructor(e,r,s){super(e),this._auth=r,this._notificationsService=s,this._friendStatus=new Map,this._notificationListenerRemovers=[],da=e}compressUUID(e){if(e.length!==36)throw new Error("[Friends] invalid uuid");const r=e.replace(/-/g,""),s=new Uint8Array(r.match(/.{1,2}/g).map(a=>parseInt(a,16)));let i=btoa(String.fromCharCode(...s)).replace(/\+/g,"-").replace(/\//g,"_"),n=i.indexOf("=");return n!==-1&&(i=i.slice(0,n)),i}decompressUUID(e){let r=e.replace(/-/g,"+").replace(/_/g,"/");for(;r.length%4;)r+="=";const i=[...new Uint8Array([...atob(r)].map(n=>n.charCodeAt(0)))].map(n=>n.toString(16).padStart(2,"0")).join("");return`${i.substring(0,8)}-${i.substring(8,12)}-${i.substring(12,16)}-${i.substring(16,20)}-${i.substring(20)}`}async getFriendlyId(){const e=await this._auth.getUserId();return this.compressUUID(e)}getFriendlyIdWithEagleId(e){return this.compressUUID(e)}async sendFriendRequestWithFriendlyId(e){const r=this.decompressUUID(e);await this.sendFriendRequestWithUserId(r)}async sendFriendRequestWithUserId(e){const r=await da.rpcGetNkUserByEagleId(e);if(r)await this.sendFriendRequest(r.UserId);else throw new Error("[Friends] unable to fetch user with id: "+e+".")}async sendFriendRequest(e){const r=[e];if(!this._ctx.session||!this._ctx.client)throw new Error("[Friends] no active session found");if(e.trim()==="")throw new Error("[Friends] invalid nakama id");try{await this._ctx.client.addFriends(this._ctx.session,r)}catch(s){throw new Error(`[Friends] unable to send friend request: ${s}`)}}async acceptFriendRequest(e){await this.sendFriendRequest(e)}async rejectFriendRequest(e){await this.removeFriend(e)}async cancelFriendRequest(e){await this.removeFriend(e)}async removeFriend(e){if(!this._ctx.session||!this._ctx.client)throw new Error("[Friends] no active session found");if(e.trim()==="")throw new Error("[Friends] invalid nakama id");try{const r=[e];await this._ctx.client.deleteFriends(this._ctx.session,r)}catch(r){throw new Error(`[Friends] unable to delete friend ${e}. Error: ${r}`)}}async getFriends(){var r,s;if(!this._ctx.session||!this._ctx.client)throw new Error("[Friends] no active session found");let e=[];try{const i=await this._ctx.client.listFriends(this._ctx.session);return!i.friends||((r=i.friends)==null?void 0:r.length)===0||(e=(s=i.friends)==null?void 0:s.map(n=>{var u,o,c,l,d,m,g,_,w;const a=(u=n.user)!=null&&u.id?this._friendStatus[(o=n.user)==null?void 0:o.id]:void 0;return{avatarUrl:(c=n.user)!=null&&c.avatar_url?Jt((l=n.user)==null?void 0:l.avatar_url,"png"):void 0,displayName:((d=n.user)==null?void 0:d.display_name)??((m=n.user)==null?void 0:m.username),id:(g=n.user)==null?void 0:g.id,online:((_=n.user)==null?void 0:_.online)??!1,username:(w=n.user)==null?void 0:w.username,friendshipState:gm[n.state??-1],status:a}})),e}catch(i){throw new Error(`[Friends] couldn't retrieve friends list: ${i}`)}}async getOnlineFriends(){return(await this.getFriends()).filter(r=>r.online)}async isFriend(e){return!!(await this.getFriends()).find(s=>s.id===e&&s.friendshipState==="friends")}async followFriends(){if(!this._ctx.socket)throw new Error("[Friends] no socket found");const e=await this.getFriends();if(!e||e.length===0)return;const r=e.map(s=>s.id);try{const s=await this._ctx.socket.followUsers(r);s!=null&&s.presences&&s.presences.forEach(i=>{this.updateFriendStatus(i.user_id,i.status)})}catch(s){throw new Error("[Friends] error following users"+s)}}async unfollowFriends(){if(!this._ctx.socket)throw new Error("[Friends] no socket found");const e=await this.getFriends();if(!e||e.length===0)return;const r=e.map(s=>s.id);try{await this._ctx.socket.unfollowUsers(r),this._friendStatus.clear()}catch(s){throw new Error("[Friends] error unfollowing users"+s)}}async onStatusPresenceChanged(e){var s,i,n;if(e==null)return;let r=await this.getOnlineFriends();if(e.leaves!=null){const a=e.leaves.map(u=>(this._friendStatus.delete(u.user_id),{id:u.user_id,online:!1,username:u.username}));(s=this._friendsLeftListener)==null||s.call(this,a)}if(e.joins!=null){r=r.map(u=>{const o=e.joins.find(c=>c.user_id===u.id);return o?(this.updateFriendStatus(o.user_id,o.status),{...u,status:this._friendStatus[o.user_id]}):u});const a=r.filter(u=>e.joins.find(o=>o.user_id===u.id));(i=this._friendsJoinedListener)==null||i.call(this,a)}(n=this._friendsOnlineListener)==null||n.call(this,r)}onSocketConnectionChanged(e){this._ctx.socket&&(e?(this._ctx.socket.onstatuspresence=this.onStatusPresenceChanged.bind(this),this.followFriends()):(this._ctx.socket.onstatuspresence=()=>{},this._friendsOnlineListener=void 0,this._friendsJoinedListener=void 0,this._friendsLeftListener=void 0,this._notificationListenerRemovers.forEach(r=>r())))}subscribeFriendRequestNotificationListener(e){const r=this._notificationsService.subscribeNotificationTypeListener(e,Kr.FriendRequest);this._notificationListenerRemovers.push(r)}subscribeFriendRequestAcceptedNotificationListener(e){const r=this._notificationsService.subscribeNotificationTypeListener(e,Kr.FriendRequestAccepted);this._notificationListenerRemovers.push(r)}subscribeFriendsOnlineListener(e){this.createSocket(),this._friendsOnlineListener=e}subscribeFriendsJoinedListener(e){this.createSocket(),this._friendsJoinedListener=e}subscribeFriendsLeftListener(e){this.createSocket(),this._friendsLeftListener=e}async blockFriend(e){if(!this._ctx.session||!this._ctx.client)throw new Error("[Friends] no active session found.");const r=[e];return await this._ctx.client.blockFriends(this._ctx.session,r)}updateFriendStatus(e,r){try{const s=r?JSON.parse(r):void 0;this._friendStatus[e]=s}catch{this._friendStatus[e]=r}}async updateStatus(e){this._ctx.socket||await this.createSocket();try{this._userStatus=e;const r=e?JSON.stringify(e):void 0;await this._ctx.socket.updateStatus(r)}catch(r){throw new Error(`[Friends] unable to update status: ${r}`)}}async setOnlineStatus(){await this.updateStatus({type:"online"})}async setOfflineStatus(){await this.updateStatus()}async setGameStatus(e,r,s){await this.updateStatus({type:"in_game",gameId:e,gameName:r,customMessage:s})}async setCustomStatus(e){await this.updateStatus({type:"custom",message:e})}getStatus(){return this._userStatus}getFormattedStatus(e){if(!e)return"Offline";switch(e.type){case"online":return"Online";case"offline":return"Offline";case"in_game":return e.customMessage?`Playing ${e.gameName}: ${e.customMessage}`:`Playing ${e.gameName}`;case"custom":return e.message;default:return"Unknown"}}getGameIdFromStatus(e){if(e&&e.type==="in_game")return e.gameId}}const _m={public:1,direct:2},Hr="message_state_update";class vm extends Br{constructor(e,r,s){super(e),this._notificationsService=r,this._friendsService=s,this._chatList=new Map,this._autoJoinChat=!0,this._chatMessagesCursor="",this._messageStatesCache=new Map,this._delayBeforeProcessing=200}setAutoJoinChat(e){this._autoJoinChat=e}getJoinedChats(){return[...this._chatList.values()]}async getChatMessages({chatId:e,fromCache:r=!1,limit:s=10}){var i,n;if(!this._ctx.session||!this._ctx.client)throw new Error("[Chat] error retrieving messages, no session found");if(!this._chatList.has(e))throw new Error("[Chat] error retrieving messages, chat not joined.");if(r)return this._chatList.get(e).messages;try{const a=[];for(;a.length<s;){const u=await this._ctx.client.listChannelMessages(this._ctx.session,e,s-a.length,!1,this._chatMessagesCursor);if(!((i=u.messages)!=null&&i.length)||(this._chatMessagesCursor=u.cacheable_cursor,u.messages.forEach(o=>{const c=o.content;if((c==null?void 0:c.type)===Hr)this.cacheMessageState(c);else{const l=this.mapNakamaChannelMessageToChatMessage(o);a.push(l),this.applyCachedStateUpdates(l)}}),u.messages.length<s-a.length))break}return this.addChatMessages(e,a),this._chatList.get(e).messages}catch(a){if(!(a instanceof Response))throw new Error("[Chat] error retrieving notifications list"+a);const c=await a.json();if(c.code===3&&((n=c.message)!=null&&n.includes("Cursor is invalid or expired")))return this._chatList.get(e).messages;throw new Error(`[Chat] error retrieving notifications list: ${JSON.stringify(a)}`)}}async joinDirectChat(e){return this.joinChat(e,"direct")}async joinChat(e,r){if(await this.createSocket(),!this._ctx.socket)throw new Error("[Chat] error joining chat. No socket found.");if(r==="direct"&&!await this._friendsService.isFriend(e))throw new Error("[Chat] error joining chat. User is not a friend.");try{const i=await this._ctx.socket.joinChat(e,_m[r],!0,!1),n=this._chatList.get(i.id)??{id:i.id,name:i.room_name??e,type:r,target:e,presences:[],messages:[]};return this._chatList.set(n.id,n),this.addChatPresences(n.id,i.presences),this.addChatPresence(n.id,i.self),n}catch(s){throw new Error("[Chat] failed to join chat with target: "+e+" error: "+s)}}async sendMessageWithFriendId(e,r){let s=Array.from(this._chatList.values()).find(i=>i.target===e);if(!s){if(!this._autoJoinChat)throw new Error("[Chat] error sending message. User needs to join the chat first");s=await this.joinDirectChat(e)}await this.sendMessageWithChatId(s.id,r)}async sendMessageWithChatId(e,r){if(!this._ctx.socket||!this._ctx.session)throw new Error("[Chat] error sending message. No socket found");const s=this._ctx.session.user_id,i=this._ctx.session.username;try{const a={id:(await this._ctx.socket.writeChatMessage(e,r)).message_id,chatId:e,content:r,senderId:s,username:i,createTime:new Date().toISOString(),states:new Map};a.states.set(s,{chatId:e,state:"sent",userId:s,username:i,timestamp:new Date().toISOString()}),this.addChatMessage(e,a,!0)}catch(n){throw new Error("[Chat] error sending message. "+n)}}async leaveChat(e){if(!this._ctx.socket)throw new Error("[Chat] error leaving chat. No socket found");await this._ctx.socket.leaveChat(e),this._chatList.delete(e)}removeChatPresence(e,r){const s=this._chatList.get(e);if(s){const i=s.presences.findIndex(n=>n.userId===r);i!==-1&&s.presences.splice(i,1)}}addChatPresences(e,r){r&&r.forEach(s=>this.addChatPresence(e,s))}addChatPresence(e,r){if(!r)return;const s=this._chatList.get(e);!s||s.presences.some(n=>n.userId===r.user_id)||s.presences.push({chatId:e,userId:r.user_id,sessionId:r.session_id,username:r.username})}addChatMessage(e,r,s=!1){this.addChatMessages(e,[r],s)}addChatMessages(e,r,s=!1){const i=this._chatList.get(e),n=r.filter(u=>{const o=u.content;return!(o!=null&&o.type)||o.type!==Hr}),a=new Set(n);for(let u=i.messages.length-1;u>=0;u--)a.has(i.messages[u])&&i.messages.splice(u,1);s?i.messages.unshift(...n):i.messages.push(...n)}async handleJoinChatInvitation(e){//! Chat invitations probably should go to a queue
if(await new Promise(r=>setTimeout(r,this._delayBeforeProcessing)),this._autoJoinChat)try{const r=await this.joinDirectChat(e);console.log("[Chat] accepted join chat from user :"+e,r)}catch(r){console.log("[Chat] error accepting join chat invitation",r)}}mapNakamaChannelMessageToChatMessage(e){return{id:e.message_id,chatId:e.channel_id,content:e.content,senderId:e.sender_id,username:e.username,createTime:e.create_time,updateTime:e.update_time,states:new Map}}onChannelPresenceChanged(e){var i;const r=e.channel_id;//!if the channel does not exist, means this event was trigger by the user himself so we ignore it
const s=this._chatList.get(r);s&&(e.leaves&&e.leaves.forEach(n=>{var u;const a={chatId:r,userId:n.user_id,sessionId:n.session_id,username:n.username};this.removeChatPresence(r,n.user_id),(u=this._chatLeaverListener)==null||u.call(this,a)}),e.joins&&e.joins.forEach(n=>{var u;const a={chatId:r,userId:n.user_id,sessionId:n.session_id,username:n.username};this.addChatPresence(r,n),(u=this._chatJoinerListener)==null||u.call(this,a)}),(i=this._chatPresencesListener)==null||i.call(this,s.presences))}subscribeChatPresenceListener(e){this.createSocket(),this._chatPresencesListener=e}removeChatPresenceListener(){this._chatPresencesListener=void 0}getStatePriority(e){switch(e){case"sent":return 0;case"delivered":return 1;case"read":return 2;default:return-1}}getHighestPriorityState(e){let r,s=-1;return e.forEach(i=>{const n=this.getStatePriority(i.state);n>s&&(s=n,r=i)}),r}updateMessageStates(e,r){const s=e.states.get(r.userId),i=this.getStatePriority(r.state),n=s?this.getStatePriority(s.state):-1;i>n&&e.states.set(r.userId,r)}cacheMessageState(e){let r=this._messageStatesCache.get(e.chatId);r||(r=new Map,this._messageStatesCache.set(e.chatId,r));let s=r.get(e.userId);s||(s=new Map,r.set(e.userId,s)),s.set(e.state,e)}applyCachedStateUpdates(e){const r=this._messageStatesCache.get(e.chatId);!r||!e.createTime||r.forEach(s=>{const i=[];if(s.forEach(n=>{e.createTime<=n.timestamp&&i.push(n)}),i.length>0){const n=this.getHighestPriorityState(i);n&&this.updateMessageStates(e,n)}})}onChannelMessageChanged(e){var n,a;const r=e.channel_id;if(!r||!this._chatList.has(r))return;const s=e.content;if((s==null?void 0:s.type)===Hr){const u=s;this.cacheMessageState(u);const o=this._chatList.get(r);o&&(o.messages.forEach(c=>{c.createTime&&c.createTime<=u.timestamp&&this.updateMessageStates(c,u)}),(n=this._messageStateListener)==null||n.call(this,u));return}const i=this.mapNakamaChannelMessageToChatMessage(e);this.addChatMessage(r,i,!0),this.applyCachedStateUpdates(i),(a=this._chatMessageListener)==null||a.call(this,i)}subscribeChatMessageListener(e){this.createSocket(),this._chatMessageListener=e}removeChatMessageListener(){this._chatMessageListener=void 0}onChatInviteNotification(e){var r;e.senderId&&(this.handleJoinChatInvitation(e.senderId),(r=this._chatInviteListener)==null||r.call(this,e))}subscribeChatInviteListener(e){this.createSocket(),this._chatInviteListener=e}removeChatInviteListener(){this._chatInviteListener=void 0}subscribeChatJoinerListener(e){this.createSocket(),this._chatJoinerListener=e}removeChatJoinerListener(){this._chatJoinerListener=void 0}subscribeChatLeaverListener(e){this.createSocket(),this._chatLeaverListener=e}removeChatLeaverListener(){this._chatLeaverListener=void 0}async sendMessageState(e,r){var c;if(!this._ctx.socket||!this._ctx.session)throw new Error("[Chat] error updating message state. No socket found");const s=this._chatList.get(e);if(!s)throw new Error("[Chat] error updating message state. Chat not found");const i=s.messages[0];if(!i)throw new Error("[Chat] error updating message state. No message found");const n=this._ctx.session.user_id;if(!n)throw new Error("[Chat] error updating message state. No user ID found");const a=(c=i.states.get(n))==null?void 0:c.state;if(a){const l=this.getStatePriority(a);if(this.getStatePriority(r)<=l)return}const u=new Date().toISOString(),o={chatId:e,state:r,timestamp:u,userId:n,username:this._ctx.session.username||""};await this._ctx.socket.writeChatMessage(e,{type:Hr,...o}),this.updateMessageStates(i,o)}async markMessageAsDelivered(e){await this.sendMessageState(e,"delivered")}async markMessageAsRead(e){await this.sendMessageState(e,"read")}subscribeMessageStateListener(e){this.createSocket(),this._messageStateListener=e}removeMessageStateListener(){this._messageStateListener=void 0}onSocketConnectionChanged(e){var r;this._ctx.socket&&(e?(this._ctx.socket.onchannelpresence=this.onChannelPresenceChanged.bind(this),this._ctx.socket.onchannelmessage=this.onChannelMessageChanged.bind(this),this._notificationListenerRemover=this._notificationsService.subscribeNotificationTypeListener(this.onChatInviteNotification.bind(this),Kr.ChatInvite)):(this._ctx.socket.onchannelpresence=()=>{},this._ctx.socket.onchannelmessage=()=>{},(r=this._notificationListenerRemover)==null||r.call(this),this._chatPresencesListener=void 0,this._chatMessageListener=void 0,this._chatInviteListener=void 0,this._chatJoinerListener=void 0,this._chatLeaverListener=void 0,this._messageStateListener=void 0,this._messageStatesCache.clear()))}}const de=[];for(let t=0;t<256;++t)de.push((t+256).toString(16).slice(1));function wm(t,e=0){return(de[t[e+0]]+de[t[e+1]]+de[t[e+2]]+de[t[e+3]]+"-"+de[t[e+4]]+de[t[e+5]]+"-"+de[t[e+6]]+de[t[e+7]]+"-"+de[t[e+8]]+de[t[e+9]]+"-"+de[t[e+10]]+de[t[e+11]]+de[t[e+12]]+de[t[e+13]]+de[t[e+14]]+de[t[e+15]]).toLowerCase()}let Ti;const bm=new Uint8Array(16);function Sm(){if(!Ti){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ti=crypto.getRandomValues.bind(crypto)}return Ti(bm)}const ha={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Pm(t,e,r){var i;if(ha.randomUUID&&!e&&!t)return ha.randomUUID();t=t||{};const s=t.random??((i=t.rng)==null?void 0:i.call(t))??Sm();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,wm(s)}const fa="arkadium-anonymous-user-token";class Em{constructor(e,r,s){this.host=e,this.auth=r,this.persistence=s,this.isInited=!1,this.ratingsEndpoint="https://eagle-virtual-item-api-dev.arkadiumhosted.com/application",this.arenaDomain="arkadium.com",this._isSupported=!0}async init(e){e===se.STAGING&&(e=se.PROD),this.arenaDomain=await this.host.getArenaName(),this.isInited=!0}async isSupported(){return this._isSupported}async upvoteGame(e,r,s){await this.postUserRating(1,e,r,s)}async downvoteGame(e,r,s){await this.postUserRating(-1,e,r,s)}async removeGameVote(e,r,s){await this.postUserRating(0,e,r,s)}async getUserInfo(){const e=await this.auth.isUserAuthorized();let r;if(e)try{r=await this.auth.getToken()}catch{}return r||(r=await this.persistence.getLocalStorageItem(fa)??void 0,r||(r=Pm(),await this.persistence.setLocalStorageItem(fa,r))),{isAuthed:e,token:r}}async postUserRating(e,r,s,i){if(!this.isInited||!this._isSupported)throw new Error("Ratings service is unavailable!");const{isAuthed:n,token:a}=await this.getUserInfo(),u=r??await this.host.getGameId(),o=`${this.ratingsEndpoint}/${this.arenaDomain}/game/${u}/vote`,c=new Headers({"Content-Type":"application/json"});n&&c.append("Authorization",`Bearer ${a}`),s&&c.append("recaptcha",s),i&&c.append("recaptcha-mode",i);const l={method:"POST",headers:c,body:JSON.stringify({vote:e,...!n&&{anonymousUserUid:a}})};await Ht(o,l)}async getUserRating(e){if(!this.isInited||!this._isSupported)throw new Error("Ratings service is unavailable!");const{isAuthed:r,token:s}=await this.getUserInfo(),i=e??await this.host.getGameId(),n=r?`${this.ratingsEndpoint}/${this.arenaDomain}/game/${i}/vote`:`${this.ratingsEndpoint}/${this.arenaDomain}/game/${i}/vote?anonymousUserUid=${s}`,a={method:"GET",headers:{"Content-Type":"application/json",...r&&{Authorization:`Bearer ${s}`}}},u=await Ht(n,a);return{vote:u.vote,gameId:u.gameKey}}async getGameRating(e){if(!this.isInited||!this._isSupported)throw new Error("Ratings service is unavailable!");const{isAuthed:r,token:s}=await this.getUserInfo(),i=e??await this.host.getGameId(),n=`${this.ratingsEndpoint}/${this.arenaDomain}/game/${i}/rating`,a={method:"GET",headers:{"Content-Type":"application/json",...r&&{Authorization:`Bearer ${s}`}}},u=await Ht(n,a);return{upVotes:u.upVotes,downVotes:u.downVotes,totalVotes:u.totalVotes,gameId:i}}}let Wr;const xe="Tournaments";class Tm extends Br{constructor(e,r){super(e),this.RPC_GET_TOURNAMENT_LIST_BY_CONTEXT="rpc_id_get_tournament_list_by_context",this.RPC_JOIN_TOURNAMENT="rpc_id_join_tournament",this.RPC_SUBMIT_SCORE_TO_TOURNAMENT="rpc_id_submit_score_to_tournament",Wr=e,r.rpcSubscriber.addToRegistry(xe,"getTournaments",this,this.getTournaments),r.rpcSubscriber.addToRegistry(xe,"hasJoinedTournament",this,this.hasJoinedTournament),r.rpcSubscriber.addToRegistry(xe,"joinTournament",this,this.joinTournament),r.rpcSubscriber.addToRegistry(xe,"canSubmitScoreToTournament",this,this.canSubmitScoreToTournament),r.rpcSubscriber.addToRegistry(xe,"submitTournamentScore",this,this.submitTournamentScore),r.rpcSubscriber.addToRegistry(xe,"getTopTournamentEntries",this,this.getTopTournamentEntries),r.rpcSubscriber.addToRegistry(xe,"getTournamentUserEntry",this,this.getTournamentUserEntry),r.rpcSubscriber.addToRegistry(xe,"getTournamentUsersEntries",this,this.getTournamentUsersEntries),r.rpcSubscriber.addToRegistry(xe,"getTournamentEntriesAroundUser",this,this.getTournamentEntriesAroundUser)}onSocketConnectionChanged(e){}async getTournaments(){const e=await Wr.getGameContext();if(!e.session||!e.client)throw new Error("[Tournaments] error retrieving tournaments, no session found");let r=[];try{const s=await e.client.rpc(e.session,this.RPC_GET_TOURNAMENT_LIST_BY_CONTEXT,{});if(s)r=s.payload.Tournaments;else throw new Error("[Tournaments] error retrieving tournaments, no response from server")}catch(s){throw new Error("[Tournaments] error retrieving tournaments, "+s)}return r.map(s=>{var i,n,a;return{id:s.id??"",title:s.title??"",description:s.description??"",duration:s.duration??0,category:s.category??0,sortOrder:s.sort_order??0,size:s.size??0,maxSize:s.max_size??0,maxNumScore:s.max_num_score??0,canEnter:s.can_enter??!1,nextReset:s.next_reset??0,metadata:s.metadata??{},createTime:((i=s.create_time)==null?void 0:i.seconds)??0,startTime:((n=s.start_time)==null?void 0:n.seconds)??0,endTime:((a=s.end_time)==null?void 0:a.seconds)??0,startActive:s.start_active??0,endActive:s.end_active??0}})??[]}async hasJoinedTournament(e){if(!this._ctx.session||!this._ctx.client)throw new Error("[Tournaments] error checking if user has joined tournament, no session found");return await this.getTournamentUserEntry(e)!==null}async joinTournament(e){const r=await Wr.getGameContext();if(!r.session||!r.client)throw new Error("[Tournaments] error joining tournament, no session found");try{const s=await r.client.rpc(r.session,this.RPC_JOIN_TOURNAMENT,{TournamentId:e});if(s)return s.payload.Success;throw new Error("[Tournaments] error joining tournament, no response from server")}catch(s){throw new Error("[Tournaments] error joining tournament, "+s)}}async canSubmitScoreToTournament(e){if(!this._ctx.session||!this._ctx.client)throw new Error("[Tournaments] error checking if can submit score to tournament, no session found");const r=await this.getTournamentUserEntry(e);return r?r.numScore<r.maxNumScore:!1}async submitTournamentScore(e){const r=await Wr.getGameContext();if(!r.session||!r.client)throw new Error("[Tournaments] error submitting tournament score, no session found");const s={TournamentId:e.tournamentId,Score:e.score,...e.subscore!==void 0&&{Subscore:e.subscore},...e.metadata!==void 0&&{Metadata:e.metadata}};try{const i=await r.client.rpc(r.session,this.RPC_SUBMIT_SCORE_TO_TOURNAMENT,s);if(i)return i.payload.Success;throw new Error("[Tournaments] error submitting tournament, no response from server")}catch(i){throw new Error("[Tournaments] error submitting score, "+i)}}async getTopTournamentEntries(e,r){var i;if(!this._ctx.session||!this._ctx.client)throw new Error("[Tournaments] error getting top tournament entries, no session found");return((i=(await this._ctx.client.listTournamentRecords(this._ctx.session,e,[],r)).records)==null?void 0:i.map(this.mapNakamaTournamentEntryToTournamentEntry))??[]}async getTournamentUserEntry(e){var s,i,n;if(!this._ctx.session||!this._ctx.client)throw new Error("[Tournaments] error getting tournament user entry, no session found");const r=await this._ctx.client.listTournamentRecords(this._ctx.session,e,[this._ctx.session.user_id]);return(s=r.owner_records)!=null&&s.length&&r.owner_records.length>0?(n=(i=r.owner_records)==null?void 0:i.map(this.mapNakamaTournamentEntryToTournamentEntry))==null?void 0:n[0]:null}async getTournamentUsersEntries(e,r){var i;if(!this._ctx.session||!this._ctx.client)throw new Error("[Tournaments] error getting tournament users entries, no session found");if(!r||r.length===0)throw new Error("[Tournaments] error getting tournament users entries, no user ids provided");return((i=(await this._ctx.client.listTournamentRecords(this._ctx.session,e,r)).owner_records)==null?void 0:i.map(this.mapNakamaTournamentEntryToTournamentEntry))??[]}async getTournamentEntriesAroundUser(e,r=10){var i;if(!this._ctx.session||!this._ctx.client)throw new Error("[Tournaments] error getting tournament entries around user, no session found");return((i=(await this._ctx.client.listTournamentRecordsAroundOwner(this._ctx.session,e,this._ctx.session.user_id,r)).records)==null?void 0:i.map(this.mapNakamaTournamentEntryToTournamentEntry))??[]}mapNakamaTournamentEntryToTournamentEntry(e){return{ownerId:e.owner_id??"",rank:e.rank??0,score:e.score??0,...e.subscore!==void 0&&{subscore:e.subscore},username:e.username??"",numScore:e.num_score??0,maxNumScore:e.max_num_score??0,...e.metadata!==void 0&&{metadata:e.metadata}}}}const ki="Recorder";class km{constructor(e){this.rpcProvider=e}async startCapturing(){await this.rpcProvider.rpcPublisher.sendMessage({module:ki,func:"startCapturing",payload:[]})}async stopCapturing(){await this.rpcProvider.rpcPublisher.sendMessage({module:ki,func:"stopCapturing",payload:[]})}async playCommands(e){await this.rpcProvider.rpcPublisher.sendMessage({module:ki,func:"playCommands",payload:[e],executionTimeLimitMs:-1})}}let Et;class ma{constructor(e,r,s,i,n,a,u,o,c,l,d,m,g,_,w,y,f,v){this.backendApi=e,this.host=r,this.lifecycle=s,this.ads=i,this.auth=n,this.analytics=a,this.timeoutTester=u,this.persistence=o,this.wallet=c,this.debug=l,this.supportV1=d,this.leaderboard=m,this.friends=g,this.notifications=_,this.chats=w,this.ratings=y,this.tournaments=f,this.recorder=v,this.currentEnv=se.DEV,this.currentTarget=null,this.version=Dr,this.envDiscoverListener=E=>{var I;E.data==="arkadium:sdk:discover:env"&&((I=this.currentTarget)==null||I.postMessage(`arkadium:sdk:discover:env:result:${this.currentEnv}`,"*"))},this.gamePingSender=new Kh,this.gamePingListener=new Bh,this.$pingNotification=this.gamePingListener.$ping}setEnv(e){this.currentEnv=e}async initialize(e,r,s=null){this.analytics.clearProviders(),await bt.Instance.init(this.host),await this.backendApi.init(e,r,s),await this.auth.init(),await this.ratings.init(e),this.backendApi.getBackendType()===Zr.EAGLE&&await this.wallet.init(e),await this.leaderboard.init(e),Et.init(e)}updateWinReference(e){Be.Instance.rpcPublisher.init(e),Be.Instance.rpcSubscriber.init(e),this.currentTarget=e,window.removeEventListener("message",this.envDiscoverListener),window.addEventListener("message",this.envDiscoverListener)}debugMode(e){this.debug.setDebugMode(e)}ping(){return this.gamePingSender.ping()}dispose(){Be.Instance.rpcSubscriber.unsubscribe(),Be.Instance.rpcPublisher.unsubscribe(),this.currentTarget=null,window.removeEventListener("message",this.envDiscoverListener)}setMockUserConfig({isEnabled:e,mockUser:r}){Nh(e),Mh(r)}}const _e=class _e{static onGameSDKLoaded(e,r,s=se.PROD){r({sdkVersion:Dr})}static dispose(){_e.sdk&&_e.sdk.dispose()}static async getInstance(e,r=!1){if(_e.sdk)return _e.sdk;const s=Be.Instance,i=Ir.Instance,n=new hh(s,i),a=new qa(n),u=new qh(a,n,s),o=new ph(s,n),c=new Jh(n,s,i,e);Et=new am(n,u);const l=new dm(Et),d=new ym(Et,u,l),m=new Xh(s,i);return _e.sdk=new ma(a,n,o,new Sh(s,u,o,n),u,c,new Wh(s),m,new mf(a,o,s),i,new wf(s,a,n),new Sf(s,n,u,o),d,l,new vm(Et,l,d),new Em(n,u,m),new Tm(Et,s),new km(s)),_e.sdk.setEnv(e),r||await _e.sdk.initialize(e,!1),(e===se.DEV||i.isDebugMode())&&console.log("SDK Version - Arena: ",_e.version),_e.sdk}};_e.version=Dr,_e.ApiEnv=se,_e.sdk=null;let tr=_e;globalThis.__ArenaApi__=globalThis.__ArenaApi__||tr,globalThis.ArkadiumArenaSDK=globalThis.ArkadiumArenaSDK||tr,Ge.ApiEnv=se,Ge.ArenaApi=tr,Ge.ArkadiumArenaSdk=ma,Object.defineProperty(Ge,Symbol.toStringTag,{value:"Module"})});
